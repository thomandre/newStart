
﻿(function($,w){$.ajaxSetup({global:false,contentType:"application/json; charset=utf-8",dataType:"json"});this.Hrd={};this.Hrd._config={};Hrd.Class=function(){};Hrd.pattern=(function(){return{isString:function(value){return typeof value==='string';},isArray:function(value){return value.constructor==Array;},isFilemap:function(value){if(this.isObject(value)&&!this.isString(value)){for(var key in value){if(!this.isString(key))return false;if(!this.isArray(value[key]))return false;}}else{return false;}
return true;},isNumber:function(value){return Object.prototype.toString.call(value)==='[object Number]';},isObject:function(value){return Object.prototype.toString.call(value)==='[object Object]';},isClass:function(value){return(typeof(value)=="function"&&typeof(value.prototype)=="object")?true:false;},isFunction:function(value){return Object.prototype.toString.apply(value)==='[object Function]';},isBoolean:function(value){return Object.prototype.toString.apply(value)==='[object Boolean]';},isURI:function(value){var regex=new RegExp('(ftp|http|https)','ig');return value.match(regex)?true:false;}}})();Hrd.Class.prototype={_config:{},_isIpad:(navigator.userAgent.match(/iPad/i)!=null)?true:false,_isTouch:(Modernizr.touch)?true:false,call:Hrd.call};Hrd.trafic={};Hrd.apply=function(object,config,defaults){if(defaults){Hrd.apply(object,defaults);}
if(object&&config&&typeof config==='object'){for(var i in config){object[i]=config[i];}}
return object;};Hrd.call=function(){var action=arguments[0],data=(arguments.length>2)?arguments[1]:{},callback=(arguments.length>2)?arguments[2]:arguments[1],type=(arguments.length>3)?arguments[3]:"POST";var opt={url:action,data:JSON.stringify(data),success:$.proxy(this,callback),type:type};var options=$.extend(Hrd._config.ajaxOptions,opt);$.ajax(opt);}
Hrd.apply(Hrd.Class,{extend:function(object){Hrd.constructing=true;var proto=new this(),superclass=this.prototype;delete Hrd.constructing;Hrd.apply(proto,object);var Class=proto.constructor=function(){if(!Hrd.constructing&&this.init){this.init.apply(this,arguments);}
if(this.ready)$(document).on('ready',$.proxy(this.ready,this));};proto.superclass=superclass;Hrd.apply(Class,{prototype:proto,constructor:Class,ancestor:this,extend:this.extend});return Class;}});Hrd.apply(Hrd,{namespace:(function(){return Hrd.apply(Hrd,{register:function(namespace,scope,object){var namespaces=namespace.split('.');for(var i=0;i<namespaces.length;i++){var namespace=namespaces[i];if(!this.exists(namespace,scope)){scope[namespace]=object;}
scope=scope[namespace];}
return scope;},exists:function(namespace,scope){return(!scope||typeof scope[namespace]==="undefined")?false:true;}})})(),define:function(namespace,object){return this.namespace.register(namespace,window,object);},extend:function(object){return Hrd.Class.extend(object);},preloader:(function(){var queue=[],images=[],total=0,curr=0;var config={cache:true,parallel:true};var time={start:0,end:0}
return{onComplete:function(ui){console.log('onComplete')},images:function(){return images;},reset:function(){queue=[],images=[],total=0,curr=0,ldr;return this;},queue:function(element){if(Hrd.pattern.isString(element)){queue.push(element)}else{$.each(element,function(i,elt){queue.push(elt);});}
return this;},finish:function(event,index,image){curr++;$('.knob').val(Math.round(curr*100/total)).change();if(curr==total){time.end=new Date().getTime();this.onComplete.apply(this,[{time:((time.end-time.start)/1000).toPrecision(2)}])}},preload:function(callback){this.onComplete=callback||this.onComplete;time.start=new Date().getTime();total=i=queue.length;if(document.all&&document.compatMode&&!document.getElementsByClassName){}else{$(".knob").knob();}
while(i--){var image=new Image();var elt=config.cache?queue.shift():(queue.shift()+'?u='+(new Date().getTime()))
var src=Hrd.pattern.isString(elt)?elt:$(elt).attr('src');image.onload=$.proxy(this.finish,this,i,image);image.onerror=$.proxy(this.finish,this,i,image);image.onabort=$.proxy(this.finish,this,i,image);image.src=src;images.push({index:i,image:image,size:{width:0,height:0}});}}}})()});})(jQuery,window);Hrd.define('Harrods',Hrd.extend({init:function(config){Hrd.apply(Hrd._config,config);Hrd.apply(this._config,config);this.boostrap();},boostrap:function(){this._scene=new Harrods.Scene();this._tools=new Harrods.Tools();if($('.story').length>0){this._home=new Harrods.Home();}
if($("[ID$='lnkLogInRegistered']").length>0){this._login=new Harrods.Login();}
if($("[ID$='btnRegister']").length>0){this._register=new Harrods.Register();}
if($(".account_p").length>0){this._account=new Harrods.MyAccount();}
if($("[ID$='add_new_address']").length>0){this._address=new Harrods.Address();}
if($("[ID$='add_new_card']").length>0){this._payment=new Harrods.Payment();}
if($(".miniharrodsp").length>0){this._miniharrods=new Harrods.MiniHarrods();}
if($("#comp_submit_bt").length>0){this._competitionform=new Harrods.Competition();}
if($(".boutiques_2012").length>0||$(".wedding_boutique").length>0||$(".wine-world").length>0||$('.boutiques').length>0){this._boutiques=new Harrods.Boutiques();}
if($(".fashion_week").length>0){this._fashionweek=new Harrods.FashionWeek();}
if(typeof sli_search_page!="undefined"){this._search=new Harrods.Search();}
this._datepicker=new Harrods.DatePicker();this._favorites=new Harrods.Favorites();this._product=new Harrods.Product();this._productList=new Harrods.ProductList();this._basket=new Harrods.Basket();this._footerpages=new Harrods.FooterPages();},isuser:function(){return true}}));var WEBROOT=document.domain,SERVICES_ROOT=WEBROOT+"/UIServices/Mobile",PROTOCOL=window.parent.document.location.protocol+"//",S7="//harrods.scene7.com/is/image/Harrods/";$(document).ready(function(){var hrds=new Harrods({service:SERVICES_ROOT});});Harrods.Templates={toolmodal:'<div class="toolmodal"><div class="close"><img src="/public/img/close.png" /></div></div>',result_modal:'<div class="signup_modal"><div class="close"><img src="/public/img/close.png" /></div><div class="signup_modal_in"><p class="result_title"></p><p class="result_message"></p></div></div>',add_this_html:'<div class="addthis_toolbox addthis_default_style "><a class="addthis_counter addthis_pill_style"></a></div>',swatch_modal:'<div class="swatch_modal"><div class="swatch_modal_in"><div class="swatch_color"></div><div class="swatch_info"><p class="swatch_name f_left"></p><p class="swatch_price f_right"></p></div></div></div>',tooltip_modal:'<div class="tooltip_modal"><div class="tooltip_modal_in"></div></div>'};Harrods.Regex={email:/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/,password:/^.*(?=.{6,})(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*$/,postcode:/^([Gg][Ii][Rr]0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))){0,1}[0-9][A-Za-z]{2})$/,reward:/^7042[0-9]{12}$/,space:/\s/}
Harrods.Mixins={getQueryString:function(qitem){var qs=location.search.replace('?','').split('&'),val="";for(var i=0;i<qs.length;i++){if(qs[i].split('=')[0]==qitem){val=qs[i].split('=')[1];}}
return val;},gLoader:function(theparent){var loadingCover=$("<div class='loadingCover'></div>"),loadingBg=$("<div class='loadingBg'></div>")
loadingCover.height(theparent.height()).width(theparent.width()+10);loadingBg.height(theparent.height()).width(theparent.width()+10);theparent.prepend(loadingBg).prepend(loadingCover);},removeGLoader:function(){$(".loadingCover, .loadingBg").remove();},pad:function(str,max){return str.length<max?pad("0"+str,max):str;},encodeUrl:function(string){return escape(this._utf8_encode(string));},decodeUrl:function(string){return this._utf8_decode(unescape(string));},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}};!function($){$.fn.accordions=function(){return this.each(function(){var $this=this,$dt=$(this).children("dt"),$dd=$dt.next('dd'),$isopen=$dt.hasClass("open")
if($isopen==true){$dd.show();var minHeight=80,actualHeight=$dd.find('.nano').height();if(actualHeight<minHeight){$dd.find('.nano').css({'height':minHeight}).nanoScroller();$dd.find('.nano .slider').css({'height':minHeight});};}
$dt.bind('click',onDtClick);function onDtClick(evt){$dd.slideToggle();$(evt.target).toggleClass('open');if($(evt.target).hasClass('open')){if($dd.find('.nano').length>0){var nanoid=$dd.find('.nano').attr('id'),th=$dd.find('.nano table').outerHeight()
if($dd.find('.nano').find('table').length>0&&th>=250){$('#'+nanoid+'.nano').height(250).nanoScroller()}else if($dd.find('.nano').find('table').length>0&&th<250){$('#'+nanoid+'.nano').height(th)}else{$('#'+nanoid+'.nano').nanoScroller();}}}}})}}(window.jQuery);Hrd.define('Harrods.Address',Hrd.extend({_loader:'<img src="/new_images/zoomloader.gif" class="small_loader" alt="Loading ..." />',_new_address:{},_addressId:"",init:function(config){Hrd.apply(this._config,config);$(".add_address, .add_new_c .add_new").on('click',$.proxy(this.addAddress,this));$('.c_addresses_list li div .address_actions .edit_address').on('click',$.proxy(this.editAddress,this));$("#add_new_address").on('click',$.proxy(this.saveAddress,this));$('.remove_address').on('click',$.proxy(this.removeAddress,this));$('.selectAddressLink').on('click',$.proxy(this.setMainAddress,this));},setMainAddress:function(e){var $this=$(e.target),addressId,_self=this;e.preventDefault();addressId=$this.parent().parent().attr('rel');$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/SetDefaultContactAddress",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"addressId":addressId}),success:function(data){_self.changeMainAddress(data,$this),_self}});},changeMainAddress:function(response,parent){var isvalid=response.d.isValid,selectaddressbt=$(".main_address .selectAddressLink");if(isvalid.length>0){console.log("error");}else{selectaddressbt.parent().show();selectaddressbt.show();$(".main_address").removeClass("main_address");parent.parent().parent().addClass("main_address");parent.hide();}},addAddress:function(e){e.preventDefault();var _self=this;if($('.add_address_from_c').is(':hidden')){$.ajax({type:"GET",url:'/UIServices/Common/SiteService.svc/renderuc?path=/UserControls/Common/AddressForm.ascx&bustcache='+(new Date()).getTime(),dataType:'html',success:function(data){$.proxy(_self.onGetBlankAddressForm(data),_self)}});};},onGetBlankAddressForm:function(data){var _self=this;$('#delivery_address_f').html(data).find("[ID$='divFindAddress']").hide();$("[ID$='txtCountryName']").val('GB');$("[ID$='UserTitle']").val('MRS');this.setAddressFieldLayout('GB',1);$("[ID$='txtCountryName']").on('change',$.proxy(this.drpInsightCountryList,_self));$("#btnFindAddress").on('click',$.proxy(this.findAddress,_self));$('.cancel_add_address').on('click',$.proxy(this.cancelAddAddress,_self));$("[ID$='ddAddressList']").on('change',$.proxy(this.ddAddressList,this));$('.add_address_from_c').slideDown();},saveAddress:function(e){e.preventDefault();var _self=this,here=$(".add_address_from_c"),invalid="false";$(".add_address_from_c li, .add_address_from_c ul").removeClass("error");$(".error_c").remove();this._new_address.CountryCode=here.find("[ID$='txtCountryName']").val();this._new_address.CountryName=$("option:selected",".add_address_from_c [ID$='txtCountryName']").text();this._new_address.UserTitle=here.find("[ID$='txtUserTitle']").val();if(this._new_address.UserTitle=="Please Select"){invalid="true";here.find(".txtUserTitle").before('<li class="error_c"><p class="error">Please select a title</p></li>').addClass('error');}
this._new_address.FirstName=here.find("[ID$='txtFirstName']").val();if(this._new_address.FirstName==""){invalid="true";here.find(".txtFirstName").before('<li class="error_c"><p class="error">Please enter a first name</p></li>').addClass('error');}
this._new_address.LastName=here.find("[ID$='txtLastName']").val();if(this._new_address.LastName==""){invalid="true";here.find(".txtLastName").before('<li class="error_c"><p class="error">Please enter a last name</p></li>').addClass('error');}
this._new_address.TelephoneNumberCountryCode=here.find("[ID$='TelephoneNumberCountryCode']").val();this._new_address.TelephoneNumber=here.find("[ID$='txtTelephoneNumber']").val();this._new_address.TelephoneNumber1CountryCode=here.find("[ID$='TelephoneNumber1CountryCode']").val();this._new_address.TelephoneNumber1=here.find("[ID$='txtTelephoneNumber1']").val();if(this._new_address.TelephoneNumber==""){if(this._new_address.TelephoneNumber1==""){invalid="true";here.find(".txtTelephoneNumber1").before('<li class="error_c"><p class="error">Please enter at least one telephone number</p></li>').addClass('error');}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._new_address.TelephoneNumber1)||this._new_address.TelephoneNumber1.length<6){invalid="true";here.find(".txtTelephoneNumber1").before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._new_address.TelephoneNumber1!=""&&this._new_address.TelephoneNumber1CountryCode==""){invalid="true";here.find(".txtTelephoneNumber1").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._new_address.TelephoneNumber)||this._new_address.TelephoneNumber.length<6){invalid="true";here.find(".txtTelephoneNumber").before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._new_address.TelephoneNumber!=""&&this._new_address.TelephoneNumberCountryCode==""){invalid="true";here.find(".txtTelephoneNumber").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
if(this._new_address.TelephoneNumber1==""){if(this._new_address.TelephoneNumber==""){invalid="true";here.find(".txtTelephoneNumber").before('<li class="error_c"><p class="error">Please enter at least one telephone number</p></li>').addClass('error');}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._new_address.TelephoneNumber)||this._new_address.TelephoneNumber.length<6){invalid="true";here.find(".txtTelephoneNumber").before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._new_address.TelephoneNumber!=""&&this._new_address.TelephoneNumberCountryCode==""){invalid="true";here.find(".txtTelephoneNumber").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._new_address.TelephoneNumber1)||this._new_address.TelephoneNumber1.length<6){invalid="true";here.find(".txtTelephoneNumber1").before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._new_address.TelephoneNumber1!=""&&this._new_address.TelephoneNumber1CountryCode==""){invalid="true";here.find(".txtTelephoneNumber1").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
this._new_address.Email=$("#txtEmail").val();var emailReg=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;if(this._new_address.Email==""){invalid="true";here.find(".txtEmail").before('<li class="error_c"><p class="error">Please enter an Email address</p></li>').addClass('error');}else if(!emailReg.test(this._new_address.Email)){invalid="true";here.find(".txtEmail").before('<li class="error_c"><p class="error">Please enter a valid email</p></li>').addClass('error');}
this._new_address.IsDefaultContactAddress=$("#chkDefaultContactAddress:checked").val()=='on';this._new_address.CompanyName=here.find("[ID$='txtCompanyName']").val();this._new_address.AddressLine1=here.find("[ID$='txtAddressLine1']").val();if(this._new_address.AddressLine1==""){invalid="true";here.find(".txtAddressLine1").before('<li class="error_c"><p class="error">Please enter an address line 1</p></li>').addClass('error');}
this._new_address.AddressLine2=here.find("[ID$='txtAddressLine2']").val();this._new_address.City=here.find("[ID$='txtCity']").val();if(this._new_address.City==""){invalid="true";here.find(".txtCity").before('<li class="error_c"><p class="error">Please enter a town/city</p></li>').addClass('error');}
if(this._new_address.CountryCode=="GB"){this._new_address.RegionName=here.find("[ID$='txtRegionName']").val();this._new_address.RegionCode="";if(this._new_address.RegionName==""){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a county</p></li>').addClass('error');};}else if(this._new_address.CountryCode=="US"){this._new_address.RegionName=here.find("[ID$='txtRegionNameUs'] option:selected").text();this._new_address.RegionCode=here.find("[ID$='txtRegionNameUs'] option:selected").val();if(this._new_address.RegionName==""||this._new_address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a state/region</p></li>').addClass('error');};}else if(this._new_address.CountryCode=="CA"){this._new_address.RegionName=here.find("[ID$='txtRegionNameCa'] option:selected").text();this._new_address.RegionCode=here.find("[ID$='txtRegionNameCa'] option:selected").val();if(this._new_address.RegionName==""||this._new_address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a province</p></li>').addClass('error');};}else if(this._new_address.CountryCode=="JP"){this._new_address.RegionName=here.find("[ID$='txtRegionNameJp'] option:selected").text();this._new_address.RegionCode=here.find("[ID$='txtRegionNameJp'] option:selected").val();if(this._new_address.RegionName==""||this._new_address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a prefecture</p></li>').addClass('error');};}else if(this._new_address.CountryCode=="AU"){this._new_address.RegionName=here.find("[ID$='txtRegionNameAu'] option:selected").text();this._new_address.RegionCode=here.find("[ID$='txtRegionNameAu'] option:selected").val();if(this._new_address.RegionName==""||this._new_address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a state/region</p></li>').addClass('error');};}else{this._new_address.RegionName=here.find("[ID$='txtRegionName']").val();this._new_address.RegionCode="";if(this._new_address.RegionName==""){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a state/region</p></li>').addClass('error');};};this._new_address.Postcode=here.find("[ID$='txtPostcode']").val();if(this._new_address.CountryCode=="GB"||this._new_address.CountryCode=="US"||this._new_address.CountryCode=="AU"){if(this._new_address.Postcode==""){invalid="true";here.find(".txtPostcode").before('<li class="error_c"><p class="error">Please enter a postcode</p></li>').addClass('error');}}
this._new_address.Id=here.find("[ID$='Id']").val();if(invalid=="false"){this.addLoader($(".right_column"));$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/SaveAddress",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"address":this._new_address}),success:function(data){$.proxy(_self.onSaveAddress(data),_self)}});}},onSaveAddress:function(response){var _self=this,isvalid=response.d.isValid,addressback=response.d.entityData;$(".loadingCover, .loadingBg").remove();if(isvalid&&addressback!=null){$('.add_new_address_h').text('Add new address');var addressId=addressback.Id.replace(/{|}/ig,""),addressFullName=addressback.UserTitle+" "+addressback.FirstName+" "+addressback.LastName,addressLine1=addressback.AddressLine1,addressCounty=addressback.RegionName,addressPostcode=addressback.Postcode,addressCountry=addressback.CountryName,blnInCheckout=($('body').hasClass('one_page_checkout')),isMainContactAddress=addressback.IsDefaultContactAddress,addressbox=$("[rel$='"+addressId+"']"),addresshtml="<strong>"+addressFullName+"</strong><br/>"+addressLine1+"<br/>"+addressCounty+"<br/>"+addressPostcode+"<br/>"+addressCountry+"<br/>";if(addressbox.length>0){addressbox.children('.address_prev').children('.address_cont').html(addresshtml);var relid=$('div[rel$='+addressId+']');if(!blnInCheckout&&isMainContactAddress){$('.address_box').removeClass('main_address');$('.address_box').find("[id$='BtnSelectAddress'], .selectAddressLink").show();addressbox.addClass('main_address');addressbox.find("[id$='BtnSelectAddress']").hide();}
if(!blnInCheckout&&!isMainContactAddress){addressbox.removeClass('main_address');addressbox.find("[ID$='divBtnSelectAddress']").css("display","block").html("</p><a href='#' class='green_button_l selectAddressLink' style='margin-right:7px'>Set contact address <span>&raquo;</span></a></div>");}
addressbox.find('.red_button_l').remove();if(addressbox.hasClass('error_address')==true){addressbox.removeClass('error_address');addressbox.find("[id$='BtnFixAddress']").append("</p><a href='#' class='green_button_l selectAddressLink' style='margin-right:7px'>Set contact address <span>&raquo;</span></a></div>");}
if(!blnInCheckout&&relid.find('.green_button_l').length==0){addressbox.children('.address_prev').children('.address_cont').append("</p><span id='divBtnSelectAddress'><a href='#' class='green_button_l selectAddressLink' style='margin-right:7px'>Set contact address</a></span></div>");}}else{var line=[];if($("#multi_shipping").is(":checked")==false){if(isMainContactAddress){line[1]="<li><div id='AddressItem' class='main_address' rel='"+addressId+"'>";}else{line[1]="<li><div id='AddressItem' rel='"+addressId+"'>";}
line[2]="<p class='address_actions'><span style='float:left;color:red;'>Saved</span><a href='#' class='edit_address'>edit</a> | <a class='remove_address' href='#'>remove</a></p><p class='address_prev'>";line[3]="<span ='address_cont'><strong>"+addressFullName+"</strong><br/>";line[4]=addressLine1+"<br/>";line[5]=addressCounty+"<br/>";line[6]=addressPostcode+"<br/>";line[7]=addressCountry+"<br/></span>";if($('body').hasClass('one_page_checkout')){line[8]="</p><a href='#' class='ship_to_address'>ship to this address</a></div></li>";}else{if(isMainContactAddress){line[8]="</p><span id='divBtnSelectAddress' style='display:none'><a href='#' class='green_button_l selectAddressLink' style='margin-right:7px;display:none'>Set contact address</a></span></div></li>";}else{line[8]="</p><span id='divBtnSelectAddress'><a href='#' class='green_button_l selectAddressLink' style='margin-right:7px'>Set contact address &raquo;</a></span></div></li>";}}
var html=line.join("");$('.c_addresses_list li:first').before(html);$('.addresses_dropdown').each(function(){$(this).parents('.actions_list_address').find('dt span').text('Select delivery address');$(this).append('<li><a href="#" rel="'+addressId+'">'+addressLine1+'</a></li>')});}else{line[1]="<li style='height: 132px;'><div id='AddressItem' rel='"+addressId+"' style='height: 122px;'>";line[2]="<p class='address_actions'><span style='float:left;color:red;'>Saved</span><a href='#' class='edit_address'>edit</a> | <a class='remove_address' href='#'>remove</a></p><p class='address_prev'>";line[3]="<span ='address_cont'><strong>"+addressFullName+"</strong><br/>";line[4]=addressLine1+"<br/>";line[5]=addressCounty+"<br/>";line[6]=addressPostcode+"<br/>";line[7]=addressCountry+"<br/></span>";line[8]="</p><a href='#' style='display:none' class='ship_to_address'>ship to this address</a></div></li>";var html=line.join("");$('.c_addresses_list li:first').before(html);$('.addresses_dropdown').each(function(){$(this).parents('.actions_list_address').find('dt span').text('Select delivery address');$(this).append('<li><a href="#" rel="'+addressId+'">'+addressLine1+'</a></li>');});}}
$("[ID$='AddressChoice']").append('<option value="'+response.d.entityData.Id+'">'+response.d.entityData.AddressLine1+'</option>');$(".loadingCover, .loadingBg").remove();$('#ErrorAdd').empty().hide();$('.add_address_from_c').slideToggle();$('#delivery_address_f').empty();}
else{var errMsg=response.d.errorMessage;if(response.d.errors!=null){$.each(response.d.errors,function(key,val){errMsg=errMsg+'<br />'+val.Value;});}
$('#ErrorAdd').html("<div class='checkout_top_error'><ul><li>"+errMsg+"</li></ul></div>");$('#ErrorAdd, #ErrorAdd .checkout_top_error').show();}},editAddress:function(e){e.preventDefault();var $this=$(e.target),_self=this,parentdiv=$this.parent('.address_actions').parent('div');if(parentdiv.hasClass('selected_address')){parentdiv.removeClass('selected_address').find('.ship_to_address').fadeIn();$('.actions_list_delivery dd ul').empty();}
this._addressId=$this.parent('p').parent('div').attr('rel');this.addLoader($(".right_column"));$.ajax({type:"GET",url:'/UIServices/Common/SiteService.svc/renderuc?path=/UserControls/Common/AddressForm.ascx&bustcache='+(new Date()).getTime(),dataType:'html',success:function(data){$.proxy(_self.onGetAddressForm(data),_self)}});},onGetAddressForm:function(data){var _self=this,deladdressf=$('#delivery_address_f');deladdressf.html(data).find("[ID$='divFindAddress']").hide();$('.add_new_address_h').text('Edit address');$('.cancel_add_address').on('click',$.proxy(this.cancelAddAddress,_self));$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/GetAddress",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"addressId":this._addressId}),success:function(data){$.proxy(_self.onGetAddress(data),_self)}});},onGetAddress:function(response){$(".loadingCover, .loadingBg").remove();if(response.d.isValid&&null!=response.d.entityData){this.setAddressFieldLayout(response.d.entityData.CountryCode,1);$.each(response.d.entityData,function(key,value){if(key=='IsDefaultContactAddress'&&value){var defaultContactAddressCheckbox=$("#delivery_address_f [ID$='chkDefaultContactAddress']");defaultContactAddressCheckbox.attr('checked',true);}
if(key=='TelephoneNumberCountryCode'){var telephoneNumberCountryCodeDropdown=$("#delivery_address_f [ID$='TelephoneNumberCountryCode']");telephoneNumberCountryCodeDropdown.val(value);}
if(key=='TelephoneNumber1CountryCode'){var telephoneNumber1CountryCodeDropdown=$("#delivery_address_f [ID$='TelephoneNumber1CountryCode']");telephoneNumber1CountryCodeDropdown.val(value);}
if($("#delivery_address_f [ID$='txt"+key+"']")&&value!=null){if(key=='UserTitle'){$("#delivery_address_f [ID$='txt"+key+"']").val(value.toUpperCase());}
else if(key=='CountryName'){}
else if(key=='RegionName'&&response.d.entityData.CountryCode=='US'){$("#delivery_address_f [ID$='txt"+key+"Us']").val(response.d.entityData.RegionCode);$('#ukCounty, #auCounty,#caCounty,#jpCounty').hide();$('#usCounty').show();}else if(key=='RegionName'&&response.d.entityData.CountryCode=='CA'){$("#delivery_address_f [ID$='txt"+key+"Ca']").val(response.d.entityData.RegionCode);$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();}else if(key=='RegionName'&&response.d.entityData.CountryCode=='JP'){$("#delivery_address_f [ID$='txt"+key+"Jp']").val(response.d.entityData.RegionCode);$('#ukCounty, #auCounty,#caCounty,#usCounty').hide();$('#jpCounty').show();}else if(key=='RegionName'&&response.d.entityData.CountryCode=='AU'){$("#delivery_address_f [ID$='txt"+key+"Au']").val(response.d.entityData.RegionCode);$('#ukCounty, #usCounty,#caCounty,#jpCounty').hide();$('#auCounty').show();}
else if(response.d.entityData.CountryCode=='GB'){$('#ukCounty').children('label').text('County*');$("#delivery_address_f [ID$='txt"+key+"']").val(value);$('#auCounty, #usCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();}else{$("#delivery_address_f [ID$='txt"+key+"']").val(value);};}});if($('.add_address_from_c').is(':hidden')){$('.add_address_from_c').slideToggle();};if($(document.activeElement).hasClass('fixAddressLink')==true){$('.save_to_addresses').click();}}},addLoader:function(theparent){var loadingCover=$("<div class='loadingCover'></div>"),loadingBg=$("<div class='loadingBg'></div>")
loadingCover.height(theparent.height()).width(theparent.width()+10)
loadingBg.height(theparent.height()).width(theparent.width()+10)
theparent.prepend(loadingBg).prepend(loadingCover);},listHightlight:function(){$('.login_f li input, .unsigned_f li input, .to_from li input, .to_from li select').focus(function(){if($(this).attr('id')!='payment_startdate_year'&&$(this).attr('id')!='payment_expirydate_year'){$('.login_f li, .unsigned_f li, .to_from li').removeClass('active');$(this).parent('li').addClass('active');}});},setAddressFieldLayout:function(countryCode,full){$('.txtAddressLine1, .txtAddressLine2, .txtCity, .txtCounty, .txtPostcode').show();$('.txtAddressLine1').children('label').text('Address line 1: *');$('.txtCity').children('label').text('Town/City');$('.txtCounty').children('label').text('State/Region');$('.txtPostCode').children('label').text('Postcode/Zipcode');$("#btnFindAddress, #btnLookupUSAddress").hide();if(countryCode=='GB'){$('.txtCountry').find('select').val('GB');$("[ID$='TelephoneNumberCountryCode'], [ID$='TelephoneNumber1CountryCode']").val("+44");$('#usCounty, #auCounty, #caCounty, #jpCounty').hide();$('.txtCity').children('label').text('City: *');$('.txtPostcode').children('label').text('Postcode: *');$("#ukCounty, #btnFindAddress").show();if(full=="0"){$('.txtAddressLine1').children('label').text('House number');$('.txtAddressLine2, .txtCity, .txtCounty').hide();}}
else if(countryCode=='US'){$('#ukCounty, #auCounty,#caCounty,#jpCounty, #btnLookupUSAddress').hide();$('#usCounty').show();$('.txtCity').children('label').text('City');$('.txtPostcode').children('label').text('Zipcode');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='CA'){$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();$('.txtCity').children('label').text('City/Municipality');$('.txtPostcode').children('label').text('Postal code');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='AU'){$('#ukCounty, #caCounty,#usCounty,#jpCounty').hide();$('#auCounty').show();$('.txtCity').children('label').text('Suburb');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='JP'){$('#ukCounty, #auCounty,#usCounty,#caCounty').hide();$('#jpCounty').show();$('.txtCity').children('label').text('City/District');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}
else{$('#usCounty, #auCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();$('.txtCity').children('label').text('Town');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}},findAddress:function(){var countryCode=$("[ID$='txtCountryName']").val();var houseNumber=$("[ID$='txtInsightAddressLine1']").val();var postCode=$("[ID$='txtPostcode']").val().toLowerCase();var _self=this
$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/FindAddress",data:JSON.stringify({"countryCode":countryCode,"houseNumber":houseNumber,"postCode":postCode}),success:function(data){$.proxy(_self.onFindAddress(data),_self)}});},drpInsightCountryList:function(evt){var $this=$(evt.target),rootthis=$this.parents('.txtCountry').siblings('.txtCounty');this.setAddressFieldLayout($this.val(),1);},cancelAddAddress:function(evt){var $this=$(evt.target);$this.parent('div').parent('div').slideUp();$('#delivery_address_f').empty();$('.add_new_address_h').text('Add new address');return false;},onFindAddress:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){$('.small_loader').remove();if(response.d.entityData.addressCount==1){this.onSelectAddress(response);}else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$('#divFindAddress').slideDown("slow");}}else{$('.txtPostcode').before('<li class="error_c"><p class="error">'+response.d.errorMessage+'</p></li>').addClass('error');$('.small_loader').remove();}},onSelectAddress:function(response){if(response.d.isValid&&null!=response.d.entityData){$('.small_loader').remove();if(response.d.entityData.addressCount==1){$.each(response.d.entityData.addressMaster,function(key,value){if($("[ID$='txt"+key+"']")&&value!=null){if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='US'){$("[ID$='txt"+key+"Us']").val(value);$('#ukCounty, #auCounty,#caCounty,#jpCounty').hide();$('#usCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='CA'){$("[ID$='txt"+key+"Ca']").val(value);$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='JP'){$("[ID$='txt"+key+"Jp']").val(value);$('#ukCounty, #auCounty,#caCounty,#usCounty').hide();$('#jpCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='AU'){$("[ID$='txt"+key+"Au']").val(value);$('#ukCounty, #usCounty,#caCounty,#jpCounty').hide();$('#auCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='GB'){$('#ukCounty').children('label').text('County');$("[ID$='txtInsightCounty']").val(value);$('#auCounty, #usCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();}else{$("[ID$='txtInsight"+key+"']").val(value);};}});this.setAddressFieldLayout(response.d.entityData.addressMaster.CountryName,1);$("[ID$='Short'], #Options1, #Options3, [ID$='divFindAddress']").hide();}
else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$("[ID$='divFindAddress']").slideDown("slow");}}
else{$('#ErrorAddBill').append('<p class="error">'+response.d.errorMessage+'</p>').show();$('.small_loader').remove();}
if(response.d.isValid&&null!=response.d.entityData){}
else{$('#ErrorAddBill').html(response.d.errorMessage).show();}
return false;},ddAddressList:function(){if($("[ID$='ddAddressList']").is(":visible")){var error_div=$('#ErrorAdd');this.selectAddress(error_div);}},selectAddress:function(){var _self=this;var countryCode=$("[ID$='txtCountryName']").val();var searchStatus=$("[ID$='SearchStatus']").val();var ambiguityId=$('#divFindAddress select')[0].selectedIndex-1;$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/SelectAddress",data:JSON.stringify({"countryCode":countryCode,"searchStatus":searchStatus,"ambiguityId":ambiguityId}),success:function(data){$.proxy(_self.onSelectAddress(data),_self)}});},onSelectAddress:function(response){if(response.d.isValid&&null!=response.d.entityData){$('.small_loader').remove();if(response.d.entityData.addressCount==1){$.each(response.d.entityData.addressMaster,function(key,value){if($("[ID$='txt"+key+"']")&&value!=null){if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='US'){$("[ID$='txt"+key+"Us']").val(value);$('#ukCounty, #auCounty,#caCounty,#jpCounty').hide();$('#usCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='CA'){$("[ID$='txt"+key+"Ca']").val(value);$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='JP'){$("[ID$='txt"+key+"Jp']").val(value);$('#ukCounty, #auCounty,#caCounty,#usCounty').hide();$('#jpCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='AU'){$("[ID$='txt"+key+"Au']").val(value);$('#ukCounty, #usCounty,#caCounty,#jpCounty').hide();$('#auCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='GB'){$('#ukCounty').children('label').text('County');$("[ID$='txtRegionName']").val(value);$('#auCounty, #usCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();}else{$("[ID$='txt"+key+"']").val(value);};}});this.setAddressFieldLayout(response.d.entityData.addressMaster.CountryName,1);$("[ID$='Short'], #Options1, #Options3, [ID$='divFindAddress']").hide();}
else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$("[ID$='divFindAddress']").slideDown("slow");}}
else{$('#ErrorAddBill').append('<p class="error">'+response.d.errorMessage+'</p>').show();$('.small_loader').remove();}
if(response.d.isValid&&null!=response.d.entityData){}
else{$('#ErrorAddBill').html(response.d.errorMessage).show();}
return false;},removeAddress:function(evt){var $this=$(evt.target),_self=this;this._addressId=$this.parent('p').parent('div').attr('rel');this.addLoader($(".right_column"));$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/RemoveAddress",data:JSON.stringify({"addressId":this._addressId}),dataType:'json',success:function(data){$.proxy(_self.onRemoveAddress(data),_self)}});return false;},onRemoveAddress:function(response){Harrods.Mixins.removeGLoader();var isvalid=response.d.isValid,addressid=response.d.entityData.replace(/{|}/ig,"");if(isvalid==true){$("[rel$='"+addressid+"']").parent('li').fadeOut('slow').remove();$('.addresses_dropdown li').each(function(){if($(this).children('a').attr('rel')==addressid){$(this).remove();}});$("[ID$='AddressChoice']").find("[rel$='"+response.d.entityData+"']").remove();if($(".checkout_onepage").length>0){$.each(userInfo.CreditCards.items,function(i,item){if(item.BillingAddressId==response.d.entityData){item.BillingAddressId=null;item.BillingAddress=null;}})}}}}));Hrd.define('Harrods.Basket',Hrd.extend
({init:function(){var _self=this;var url=window.location.href;this.ssl=(url.split("//")[0]==="https:")?true:false;if(url.indexOf("login")!=-1){localStorage.removeItem("basketprev");}
if(this._isTouch){$('body').on('click','#topnav .bag-tn.inuse',$.proxy(this.onBagOver,this));$('body').on('click','#topnav .bag-tn.close-bag',$.proxy(this.hideBasketPreview,this));$('.yourbag-hide').on('click',function(){$("#topnav .bag-tn.close-bag").trigger("click");});$('html').addClass('isTouch');}else{$('body').on('mouseover','#topnav .bag-tn.inuse',$.proxy(this.onBagOver,this));$('body').on('mouseover','.yourbag-hide',$.proxy(this.hideBasketPreview,this));}
$('body').on('click','.minibag a.arrow',$.proxy(this.contentScroll,this));$('body').on('click','.minibag .product a.remove-item',$.proxy(this.removeItem,this));$('body').on("click",'.add_to_bag',$.proxy(this.addToBag,this,false))
$('body').on("click",'#update_bag',$.proxy(this.addToBag,this,true))
$('body').on("click",'.closeWrapper',$.proxy(this.hideBasketPreview,this))
$('body').on("click",'.error-msg .close-btn',$.proxy(this.hideErrorMsg,this))
$('body').on("click",'.update-item',$.proxy(this.clearLocalStorage,this))
$('body').on("click",'.remove-item',$.proxy(this.clearLocalStorage,this))
$('body').on({'Harrods.Basket.AddToBag':$.proxy(this.addToBag,this)});$('body').on({'Harrods.Basket.getBasketPreview':$.proxy(this.getBasketPreview,this)});$('body').on('change','#ddlCountries',$.proxy(this.updateFormAction,this,'#delivery-charge'));$('body').on('change','#ddlShippingMethod',$.proxy(this.updateFormAction,this,'#delivery-charge'));this.scrollToHash();if($('.enter-code input').val()!=''){$('.enter-code label').hide();}
$('body').on("click",'#shopping-bag .enter-code label',$.proxy(this.focusPromoField,this))
$('body').on("focus",'#shopping-bag .enter-code input',$.proxy(this.focusPromoField,this))
$('body').on("blur",'#shopping-bag .enter-code input',$.proxy(this.blurPromoField,this))
$('body').on("mouseover",'#shopping-bag .order-delivery .help-tooltip',$.proxy(this.showDeliveryTooltip,this))
$('body').on("mouseout",'#shopping-bag .order-delivery .help-tooltip',$.proxy(this.hideDeliveryTooltip,this))
$('body').on("click",'#shopping-bag .fav_it',$.proxy(this.addToFaves,this))
$('body').on("change",'#shopping-bag .qty-dropdown',$.proxy(this.updateQty,this))
if($('#shopping-bag').length>0){$("#shopping-bag .product").each(function(){var q=$(this).find('.product-qty input.quantity').val();if(q<=9){$(this).find('.edit-quantity').hide();$(this).find('.update-item').hide();var maxinstock=$(this).find('.product-qty input.quantity').data('maxinstock');if(maxinstock!=undefined){var str='<select class="qty-dropdown">';for(var i=1;i<=maxinstock;i++){str+='<option value="'+i+'">'+i+'</option>';}
str+='</select>';$(this).find('.product-qty').prepend(str);}
else{$(this).find('.product-qty').prepend('<select class="qty-dropdown"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10+</option></select>');}
$(this).find('.qty-dropdown').val(q);}});}
$('#shopping-bag .product-qty').show();if($('.bag-tn').text().indexOf('(0)')===-1){$('.bag-tn').addClass('inuse');}},prevAddedAlert:function(btn,url){var html="";html+="<div class='alert' id='delivery-overlay'>";html+="<div class='lightbox-alert'><h3>Header</h3><p>Duis vitae erat lacus. Nunc in rhoncus lorem. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse purus ipsum, mollis ac ultrices a, scelerisque non nibh.</p>";html+="<a href='"+url+"'>"+btn+"</a>";html+="</div>";html+="</div>";$('body').append(html);},scrollToHash:function(){var h=window.location.hash;if($(h).length>0){$('html, body').animate({scrollTop:($(h).offset().top)-15},1500);}},updateQty:function(evt){var $this=$(evt.target);var q=$this.val();$this.parent().find('input.quantity').val(q);if(q=='10'){$this.hide();$this.parent().find('.edit-quantity input.quantity').removeClass('hidden');$this.parent().find('.edit-quantity').show();$this.parent().find('.update-item').show();}
else{location.href=$this.closest('.product-qty').find('.update-item').attr('href');localStorage.removeItem("basketprev");}},clearLocalStorage:function(evt){localStorage.removeItem("basketprev");},showDeliveryTooltip:function(evt,$this){var _this=this;$('body').append('<div id="delivery-overlay"></div>');$('#delivery-overlay').show();var $t=$(evt.target);if(!$t.hasClass('on')){$t.append('<span id="delivery-tooltip">'+$t.attr("data-help-text")+'<a class="close">x</a></span>');$t.addClass('on');$("#delivery-overlay").on("click",function(e){_this.hideDeliveryTooltip();});$(".tooltip .close").on("click",function(e){_this.hideDeliveryTooltip();});}},hideDeliveryTooltip:function(){$('#delivery-overlay').remove();$('#delivery-tooltip').remove();$('.help-tooltip').removeClass('on');},focusPromoField:function(){$('.enter-code label').hide();$('.enter-code input')[0].focus();$('.enter-code div').removeClass('error');$('.PromoCodeMessage p.error').empty();},blurPromoField:function(evt){var $this=$(evt.target);if($this.val()==''){$('.enter-code label').show();}},addToFaves:function(evt){evt.preventDefault();var $this=$(evt.target);$this.addClass('added');$this.text('Added to Favourites');},onBagOver:function(evt){if(!this.ssl){if(!window.localStorage){$.proxy(this.getBasketPreview,this)}else{if(localStorage.getItem("basketprev")!=null&&(typeof sli_search_page=="undefined")){$.proxy(this.showBasketPreview(localStorage.getItem("basketprev")),this);}else{$.proxy(this.getBasketPreview(),this);}}
if(this._isTouch){evt.preventDefault();$('#topnav .bag-tn').text('Close').addClass('close-bag');}else{$(".yourbag-hide").addClass('active');}}else{this.getBasketPreview();}},getBasketPreview:function(){if(typeof sli_search_page!="undefined"){var uId=sli_custid;$.ajax({type:"GET",cache:false,url:"/UIServices/ExternalService.svc/GetBasketPreviewForUser",data:{id:uId},success:$.proxy(this.onGetBasketPreview,this)});}
else{$.ajax({type:"GET",cache:false,url:PROTOCOL+SERVICES_ROOT+"/BasketService.svc/GetBasketPreview",data:{},success:$.proxy(this.onGetBasketPreview,this)});}},onGetBasketPreview:function(response){if(response.IsValid){localStorage.removeItem("basketprev");localStorage.setItem("basketprev",response.entityData);this.showBasketPreview(response.entityData);}},showBasketPreview:function(html){if($(".bag-tn").text()!="Your\xA0Bag\xA0(0)"&&!$(".bag-tn").hasClass("close-bag")){if(this._isTouch){$("#topnav .bag-tn").text("Close").addClass("close-bag");}
$(".bag-tn").addClass("active");setTimeout(function(){$(".yourbag-hide").addClass('active');},1500);$(".load-in").html(html).stop(true,true).fadeIn(700,"easeOutExpo");}},hideBasketPreview:function(){var itemcount=$('.item-qty').text().split(" ")[0];if(this._isTouch&&$('.bag-tn').text().indexOf('(0)')===-1){$('.bag-tn').removeClass('close-bag').text('Your\xA0Bag\xA0('+itemcount+')');}
$(".load-in").stop(true,true).fadeOut(500,"easeOutExpo");$('.bag-tn').removeClass("active");$(".yourbag-hide").removeClass("active");this.scrollpos=0;},addToBag:function(updateBag,evt){evt.preventDefault();var $this=$(evt.target),_self=this,prod_id,var_id,prod_qt=$this.parents('.add_to_bag_f').find('#quantity').val(),giftCardVal,prodQu,availableStock=0;if($this.parents('.add_to_bag_f').find('.fav_it').attr("data-prodid")==000000009999995000){giftCardVal=$("#price").val();if(giftCardVal==""){alert('Please enter a value.');return false;}
else if(parseInt(giftCardVal)<10||parseInt(giftCardVal)>500){alert('Please enter a correct value.');return false;}
else if($('.add_to_bag_f').find("#tandc").is(":checked")==false){alert('Please check that gift cards are non-refundable.');return false;}
prod_id='000000009999995000';prodQu=1;}
else{giftCardVal="";prodQu=prod_qt;}
this.isGiftCard=giftCardVal.length>0?true:false;this.prodQu=prodQu;if($('#colour').length>1&&$('#colour').data('pid')==null){alert('please select color');return false;}
else if($('#colour').length>0&&$('#colour').data('pid')!=null){prod_id=$('#colour option:selected').data('pid')
if(prod_id==undefined){prod_id=$('#colour').data('pid');}
availableStock=$this.parents('.add_to_bag_f').find('#colour').attr("data-quan");}
else{if(!this.isGiftCard){prod_id=$this.parents('.add_to_bag_f').find('.fav_it').data("prodid");}
availableStock=$('#colour').attr("data-quan");}
if($('#size').length>0){$option=$('#size option:selected');$shape=$option.attr('data-shape');$shapesize=$option.attr('data-shapesize');if($shape!=undefined&&$shapesize!=undefined){var_id='';}
else{var_id=$option.val();}
var selectedSize=$('#size option:selected').data('pid');prod_id=(prod_id==undefined||prod_id!=selectedSize)?selectedSize:prod_id;availableStock=$('#size option:selected').attr('data-quan');}
else{var_id="";}
if($('#quantity').data('instock')!=null){availableStock=$('#quantity').data('instock');}
if(availableStock!=undefined){if(parseInt(prodQu)>parseInt(availableStock)){alert('Unfortunately there is insufficient stock - please reduce your chosen quantity');return false;}}
if(prod_id==undefined||prod_id.toString().length==0){prod_id=$this.parents('.add_to_bag_f').find('.fav_it').data("prodid");}
if(updateBag==undefined||!updateBag){$.ajax
({type:"GET",cache:false,url:PROTOCOL+SERVICES_ROOT+"/BasketService.svc/AddProductToBag",data:{pid:prod_id,qnt:prod_qt,varId:var_id,catPath:"",gcVal:giftCardVal},success:function(data){_self.onAddToBag(data,$this);}});}
else{var lineItemId=$('#lineItemId').val();$.ajax
({type:"GET",cache:false,url:PROTOCOL+SERVICES_ROOT+"/BasketService.svc/UpdateBag",data:{pid:prod_id,qnt:prod_qt,varId:var_id,catPath:"",gcVal:giftCardVal,lineId:lineItemId},success:function(data){_self.onAddToBag(data,$this);_self.bagChanged();}});}},onAddToBag:function(data,element){element.removeClass('adding_to_bag')
var itemIn=data.entityData.f.ItemCount,isvalid=data.IsValid,subTotal,thesize;if(isvalid==true){if(this.isGiftCard)
subTotal=$("#gift_c_value").val();else
subTotal=($("#quantity").val())*(parseFloat($(".price").text().replace(/£/,'')));if($("#size").length>0){thesize=$("#size option:selected").text();}else{thesize="none";}
if(element.parents('.product_preview').length>0){var pid=element.parents('.add_to_bag_f').find('.fav_it').attr("data-prodid");$('.products_row').find('li[data-type="'+pid+'"]').find('.quick_shop').prepend("<a href='/shoppingbag'  class='added_to_bag hbt white_bt'>Added To Bag</a>");$('.products_row').find('li[data-type="'+pid+'"]').find('.quick_shop .openQuickShop').remove();$('.img_modal_pop').fadeTo(500,0,function(){$('.img_modal_pop').empty();$('.img_modal_pop').remove();});}
if($("#shopping-bag").length>0){location.reload();}
$('.bag-tn').text('Your\xA0Bag\xA0('+data.entityData.f.ItemCount+')').addClass('inuse');this.getBasketPreview();s.linkTrackVars='events,products,eVar10';if(itemIn==1){s.linkTrackEvents='scAdd,event23,scOpen';}else if((itemIn!=1)&&(itemIn==this.prodQu)){s.linkTrackEvents='scAdd,event23,scOpen';}else{s.linkTrackEvents='scAdd,event23';}
s.products=';'+window.prodId+';;;'+'event23='+subTotal+';evar10='+thesize;s.events='scAdd,event23';s.scdiv=s.c_r('scdiv');if(s.getValOnce('event37'+s.scdiv,'event37'+s.scdiv))
s.events=s.apl(s.events,'event37',',',1);var scpurchdiv=s.apl(s.c_r('scpurchdiv'),s.products.replace(/\;/,'')+'::'+s.scdiv,',',1);s.c_w('scpurchdiv',scpurchdiv,0);s.tl(this,'o','add to bag');$('.bag-tn').addClass('inuse');if(!$('.bag-tn')[0].hasAttribute('href')){$('.bag-tn').attr('href','/newcheckoutcart.aspx');}}
else{if(data.Errors.indexOf("removed from your basket")!=-1){window.location="/newcheckoutcart.aspx"}
else{var msg=data.Errors+'\r\n\nClick OK to continue.';if(confirm(msg))location.href="/newcheckoutcart.aspx";}}},bagChanged:function(){localStorage.removeItem("basketprev");},removeItem:function(e){e.preventDefault();var $this=$(e.target),lineId=$this.parent().find('.lineId').text(),_self=this;$.ajax({type:"GET",cache:false,url:"/UIServices/Mobile/BasketService.svc/RemoveLineItem",data:{lineId:lineId},success:function(data){_self.onRemoveItem(data,$this);}});},onRemoveItem:function(data,$this){var _this=this;if(data.IsValid===true){$('#topnav').find('.basketQty').text('Your\xA0Bag\xA0('+data.entityData.f.basketitemcount+')');if(data.entityData.f.basketitemcount===0){$('.load-in').fadeOut(function(){$('.bag-tn').removeClass('inuse active close-bag').removeAttr('href');$('.yourbag-hide').removeClass('active');});}else{$this.parent().fadeOut(function(){_this.getBasketPreview();});}}else{console.log("isValid false");}},scrollpos:0,contentScroll:function(e){var $etarget=$(e.target);e.preventDefault();if($etarget.hasClass('active')){if($etarget.hasClass('up')){this.scrollpos--;this.updateScroll(this.scrollpos);}else{this.scrollpos++;this.updateScroll(this.scrollpos);}}},getScrollItemHeight:function(){var itemheight=[];$('.minibag ul.products li').each(function(){itemheight.push($(this).outerHeight());});return itemheight;},updateScroll:function(pos){var itemsheight=0,scrollitem=this.getScrollItemHeight(),scrollitempos=0,rest=0,$btup=$('.minibag .up.arrow'),$btdown=$('.minibag .down.arrow'),i=0,j=0,k=pos,lastindex;while(i<pos){scrollitempos+=scrollitem[i];i++;}
while(k<scrollitem.length){rest+=scrollitem[k];k++;}
while(j<scrollitem.length){itemsheight+=scrollitem[j];j++;}
lastindex=(rest<240)?pos:scrollitem.length;if(pos===lastindex){$('.minibag .content').animate({'top':-(itemsheight-280)});}else{$('.minibag .content').animate({'top':-(scrollitempos-5)});}
if(pos===0){$btup.removeClass('active');$btdown.addClass('active');}else if(pos===lastindex){$btup.addClass('active');$btdown.removeClass('active');}else{$btup.addClass('active');$btdown.addClass('active');}},hideErrorMsg:function(e){var $this=$(e.target),$errormsg=$this.parent();$errormsg.fadeOut(500,function(){$(this).removeClass('show');});},updateFormAction:function(update,e){var currAction;if($('#aspnetForm').length>0){currAction=$('#aspnetForm').attr('action');$('#aspnetForm').attr('action',currAction+update);}}}));!function($){var Carousel=function(element,options){this.$element=$(element)
this.slides=$(element).find('.slides')
this.$left_bt='<a href="#" class="c_controls cleft">left</a>'
this.$right_bt='<a href="#" class="c_controls cright">right</a>'
this.$top_bt='<a href="#" class="c_controls ctop">top</a>'
this.$bottom_bt='<a href="#" class="c_controls cbottom">bottom</a>'
this.options=$.extend({},options)
this.init();this.sliding=false;}
Carousel.prototype={init:function(){var self=this;this.interval=this.options.interval
if(this.options.moving=='v'){this.vSet();this.clip_height=this.options.clip_height}else{this.clip_width=this.options.clip_width
this.hSet();}
$('.cleft').on('click',$.proxy(this.slideLeft,this));$('.cright').on('click',$.proxy(this.slideRight,this));$('.ctop').on('click',$.proxy(this.slideTop,this));$('.cbottom').on('click',$.proxy(this.slideBottom,this));$('body').keyup(function(e){var k=e.which;if(k===37){$('.cleft').trigger('click')}
else if(k===38){$('.ctop').trigger('click')}
else if(k===39){$('.cright').trigger('click')}
else if(k===40){$('.cbottom').trigger('click')}});},vSet:function(){this.ul_height=(this.slides.find('ul li').outerHeight()*this.slides.find('ul li').size())+20,this.item_height=this.clip_height,this.top_value=this.item_height*(-1);this.slides.find('ul li:first').before(this.slides.find('ul li:last'));this.slides.find('ul').stop().animate({'top':top_value,'height':this.ul_height});this.$element.append(this.$top_bt,this.$bottom_bt)},hSet:function(){this.ul_width=(this.clip_width*this.slides.find('ul li').size())+20,this.item_width=this.clip_width,this.left_value=this.item_width*(-1);this.slides.find('ul li:first').before(this.slides.find('ul li:last'));this.slides.find('ul').css({'left':this.left_value,'width':this.ul_width});this.$element.append(this.$left_bt,this.$right_bt)
$('.cleft, .cright').css({'top':(this.slides.find('ul li').outerHeight()/2-($('.cleft').height()/2))})},slideRight:function(evt){if(this.sliding==false){var _self=this,slides=$(evt.target).siblings('.slides')
_self.left_indent=parseInt(slides.find('ul').css('left'))-_self.item_width;_self.sliding=true;slides.find('ul').stop().animate({'left':_self.left_indent},_self.interval,function(){_self.sliding=false;slides.find('ul li:last').after(slides.find('ul li:first'));slides.find('ul').css({'left':_self.left_value},'slow');});}
return false},slideLeft:function(evt){if(this.sliding==false){var _self=this,slides=$(evt.target).siblings('.slides')
_self.left_indent=parseInt(slides.find('ul').css('left'))+_self.item_width;_self.sliding=true;slides.find('ul').stop().animate({'left':_self.left_indent},_self.interval,function(){_self.sliding=false;slides.find('ul li:first').before(slides.find('ul li:last'));slides.find('ul').css({'left':_self.left_value},'slow');});}
return false},slideTop:function(evt){if(this.sliding==false){var _self=this,slides=$(evt.target).siblings('.slides')
_self.top_indent=parseInt(slides.find('ul').css('top'))+_self.item_height;_self.sliding=true;slides.find('ul').stop().animate({'top':_self.top_indent},_self.interval,function(){_self.sliding=false;slides.find('ul li:first').before(slides.find('ul li:last'));slides.find('ul').css({'top':_self.top_value},'slow');});}
return false},slideBottom:function(evt){if(this.sliding==false){var _self=this,slides=$(evt.target).siblings('.slides')
_self.top_indent=parseInt(slides.find('ul').css('top'))-_self.item_height;_self.sliding==true;slides.find('ul').stop().animate({'top':_self.top_indent},_self.interval,function(){_self.sliding==false;slides.find('ul li:first').before(slides.find('ul li:last'));slides.find('ul').css({'top':_self.top_value},'slow');});}
return false}}
$.fn.carousel=function(option){return this.each(function(){var $this=$(this),data=$this.data('carousel'),options=typeof option=='object'&&option
if(!data)$this.data('carousel',(data=new Carousel(this,options)))
else data.init()})
$.fn.carousel.Constructor=Carousel}}(window.jQuery);Hrd.define('Harrods.DatePicker',Hrd.extend({_loader:'<img src="/new_images/zoomloader.gif" class="small_loader" alt="Loading ..." />',init:function(config){this.addDatePikerTransac();if(typeof availableDates!="undefined"){var dpick3ops={formElements:{"req_10_dates":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,enabledDates:{},noDrag:true,callbackFunctions:{"dateset":[callBackOne]}}
for(var k in availableDates){var availdates=availableDates[k];dpick3ops.enabledDates[availdates]=1;}
datePickerController.createDatePicker(dpick3ops);}
$(".fakebt").click(function(){datePickerController.show($(this).children('input').attr('id'));})},addDatePikerTransac:function(){Date.fromUKFormat=function(sUK){var A=sUK.split(/[\\\/]/);A=[A[1],A[0],A[2]];return new Date(Date.parse(A.join('/')));}
var mydate=new Date();var year=mydate.getFullYear();var month=mydate.getMonth()+1;if(month<10){month='0'+month;}
var day=mydate.getDate();if(day<10){day='0'+day;}
var todayis=year+""+month+""+day;mydate.setDate(mydate.getDate()-1);var theyear=mydate.getFullYear();var themonth=mydate.getMonth()+1;if(themonth<10){themonth='0'+themonth;}
var theday=mydate.getDate();if(theday<10){theday='0'+theday;}
var theyesterday=theyear+""+themonth+""+theday;mydate.setMonth(mydate.getMonth()-6)
var theyear2=mydate.getFullYear();var themonth2=mydate.getMonth()+1;if(themonth2<10){themonth2='0'+themonth2;}
var theday2=mydate.getDate();if(theday2<10){theday2='0'+theday2;}
var sixmonthsearly=theyear2+""+themonth2+""+theday2;mydate.setMonth(mydate.getMonth()+4)
var theyear3=mydate.getFullYear();var themonth3=mydate.getMonth()+1;if(themonth3<10){themonth3='0'+themonth3;}
var theday3=mydate.getDate();if(theday3<10){theday3='0'+theday3;}
var twomonthsearly=theyear3+""+themonth3+""+theday3;var dpick1ops={formElements:{"ctl00_ContentPlaceHolder1_txtDateFrom":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:"20070101",rangeHigh:theyesterday,cursorDate:sixmonthsearly}
var dpick2ops={formElements:{"ctl00_ContentPlaceHolder1_txtDateTo":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:"20070101",rangeHigh:theyesterday,cursorDate:theyesterday}
var dpick3ops={formElements:{"ctl00_ContentPlaceHolder1_transDate":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:twomonthsearly,rangeHigh:theyesterday,cursorDate:theyesterday}
var dpick4ops={formElements:{"ctl00_ContentPlaceHolder1_txtDateToIns":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:"20070101",rangeHigh:todayis,cursorDate:todayis}
datePickerController.createDatePicker(dpick1ops);datePickerController.createDatePicker(dpick2ops);datePickerController.createDatePicker(dpick3ops);datePickerController.createDatePicker(dpick4ops);var fromDate=$("[ID$='txtDateFrom']");var dateTo=$("[ID$='txtDateTo']");var dateToIns=$("[ID$='txtDateToIns']");var transDate=$("[ID$='transDate']");if(fromDate.val()==''||fromDate.val()=='222'){fromDate.val(theday2+"/"+themonth2+"/"+theyear2)}
if(dateTo.val()==''||dateTo.val()=='222'){dateTo.val(theday+"/"+themonth+"/"+theyear);}
if(transDate.val()==''||transDate.val()=='222'){transDate.val(theday+"/"+themonth+"/"+theyear);}
if(dateToIns.val()==''||dateToIns.val()=='222'){dateToIns.val(day+"/"+month+"/"+year);}
$("[ID$='btnSearchTransactions']").click(function(){$(".to_from li").removeClass("error");$(".error_c").remove();var isValid=true;var fromDate=$("[ID$='txtDateFrom']");var dateTo=$("[ID$='txtDateTo']");var reDate=/(?:0[1-9]|[12][0-9]|3[01])\/(?:0[1-9]|1[0-2])\/(?:19|20\d{2})/;if(!reDate.test(fromDate.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid from" date</p></li>');}
if(!reDate.test(dateTo.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid to" date</p></li>');}
if(isValid){if(Date.fromUKFormat(fromDate.val())<Date.fromUKFormat("01/01/2007")){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only display transactions from 2007 onwards</p></li>');isValid=false;}
if(Date.fromUKFormat(dateTo.val())>Date.fromUKFormat(theday+"/"+themonth+"/"+theyear)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only display transactions up to yesterday\'s date</p></li>');isValid=false;}
if(Date.fromUKFormat(fromDate.val())>Date.fromUKFormat(dateTo.val())){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, this date range is invalid. Please enter valid dates</p></li>');isValid=false;}}
return isValid;})
$("[ID$='btnSearchIncidents']").click(function(){$(".error_c").remove();var postbackid=$(this).attr('id').replace(/_/g,"$");var isValid=true;var fromDate=$("[ID$='txtDateFrom']");var dateToIns=$("[ID$='txtDateToIns']");var reDate=/(?:0[1-9]|[12][0-9]|3[01])\/(?:0[1-9]|1[0-2])\/(?:19|20\d{2})/;if(!reDate.test(fromDate.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid from" date</p></li>');}
if(!reDate.test(dateToIns.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid to" date</p></li>');}
if(isValid){if(Date.fromUKFormat(fromDate.val())<Date.fromUKFormat("01/01/2007")){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry we can only display Incidents from 2007 onwards</p></li>');isValid=false;}else if(Date.fromUKFormat(dateToIns.val())>Date.fromUKFormat(day+"/"+month+"/"+year)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry we can only display Incidents up to today\'s date</p></li>');isValid=false;}else if(Date.fromUKFormat(fromDate.val())>Date.fromUKFormat(dateToIns.val())){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, this date range is invalid. Please enter valid dates</p></li>');isValid=false;}else{__doPostBack(postbackid,fromDate.val()+'|'+dateToIns.val());}}
return false;})
$("[ID$='btnRequestPoints']").click(function(){$(".to_from li").removeClass("error");$(".error_c").remove();var postbackid=$(this).attr('id').replace(/_/g,"$");var isValid=true;var transDate=$("[ID$='transDate']");var message="";var assistantId=$("[ID$='txtAssistantId']");var reDate=/(?:0[1-9]|[12][0-9]|3[01])\/(?:0[1-9]|1[0-2])\/(?:19|20\d{2})/;if(!reDate.test(transDate.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid from" date</p></li>');}else if(Date.fromUKFormat(transDate.val())<Date.fromUKFormat(theday3+"/"+themonth3+"/"+theyear3)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only add Rewards points for transactions up to two months after the transaction date.</p></li>');isValid=false;}else if(Date.fromUKFormat(transDate.val())>Date.fromUKFormat(theday+"/"+themonth+"/"+theyear)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only add Rewards points on transactions up to yesterday\'s date.  Please try again tomorrow</p></li>');isValid=false;}
if(assistantId.val()==""){isValid=false;message="Assistant number is required";assistantId.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(isNaN(assistantId.val())){isValid=false;message="Assistant number is invalid";assistantId.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
var transactionNumber1=$("[ID$='txtTransNumberPart1']");var tranInvalid="false";if(transactionNumber1.val()==""){isValid=false;tranInvalid="true";message="Transaction number is incomplete";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(isNaN(transactionNumber1.val().toUpperCase().replace(/NT/g,''))){isValid=false;tranInvalid="true";message="Transaction number is invalid";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
if(tranInvalid=="false"){var transactionNumber2=$("[ID$='txtTransNumberPart2']");if(transactionNumber2.val()==""){isValid=false;message="Transaction number is incomplete";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(isNaN(transactionNumber2.val())){isValid=false;message="Transaction number is invalid";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}}
if(isValid==true){__doPostBack(postbackid,transDate.val());}else{return false;}
return false;})
$(".info_hover").hover(function(){$(".retro_points_info").remove();var wrapper=$("<span>");var thealt=$(this).attr("alt");var thistop=($(this).offset().top)-150;var thisleft=516;wrapper.addClass("retro_points_info").text(thealt)
$(this).parents("ul").before(wrapper);$(".retro_points_info").css({top:thistop,left:thisleft}).fadeIn();},function(){$(".retro_points_info").remove();});}}));Hrd.define('Harrods.Favorites',Hrd.extend({init:function(config){Hrd.apply(this._config,config);$(".fav_remove").on({click:$.proxy(this.removeFav,this),mouseover:$.proxy(this.onRemoveFavOver,this),mouseleave:$.proxy(this.onRemoveFavOut,this)})
$(".fav_remove_all").on("click",$.proxy(this.removeAllFav,this))
$('.openQuickShop').on('click',$.proxy(this.openQuickShopPopUp,this))
var tooltip_modal='<div class="tooltip_modal"><div class="tooltip_modal_in"></div></div>'
$('body').append(tooltip_modal);$('body').on("click",'.fav_it',$.proxy(this.addToFav,this))
$('body').on("mouseover",'.fav_it',$.proxy(this.onRemoveFavOver,this))
$('body').on("mouseleave",'.fav_it',$.proxy(this.onRemoveFavOut,this))
$('body').on({'Harrods.Favorites.previewSetup':$.proxy(this.previewSetup,this)});},onSizeChange:function(evt){evt.preventDefault();var _self=this;var $cprice=$('#size option:selected').data('cprice');var $cwasprice=$('#size option:selected').data('cwasprice');var $id=$('#size option:selected').data('pid').toString();$cprice=$cprice.toString().indexOf('.')>0?$cprice.toString():$cprice.toString()+'.00';$cwasprice=$cwasprice.toString().indexOf('.')>0?$cwasprice.toString():$cwasprice.toString()+'.00';if($cwasprice!=null&&$cprice!=null){if(parseFloat($cwasprice.replace('£',''),10)>parseFloat($cprice.replace('£',''),10)){if(!$cprice.match('^£'))
$cprice='£'+$cprice;if(!$cwasprice.match('^£'))
$cwasprice='£'+$cwasprice;$('.prices').html('<span class="was">'+$cwasprice+'</span>'+'<span class="now">Now '+$cprice+'</span>').removeClass('price_changed');}
else{if(!$cprice.match('^£'))
$cprice='£'+$cprice;$('.prices').html('<b>'+$cprice+'</b>').removeClass('price_changed');}}
$('.product_code').text('Product Code '+$id).attr("data-prodid",$id.replace(/(^0+)/,''));var $this=$(evt.target).find("option:selected"),$pid=$this.attr('data-pid'),$shape=$this.attr('data-shape'),$shapesize=$this.attr('data-shapesize'),$colour=$this.attr('data-colour');if($shape!=undefined&&$shapesize!=undefined){$colorswatch=$('.color_c .color_swatch, .color_box .color_swatch');$colorswatch.removeClass('active');$colorswatch.hide();$(".product_preview").find("#colour option").attr('disabled','disabled').hide();$(".product_preview").find("#colour option").removeAttr('selected');$(".product_preview").find("#colour option[data-shapesize='"+$shapesize+"']").show().removeAttr('disabled');$selectedColour=$(".product_preview").find("#colour option[data-pid='"+$pid+"']");if($selectedColour!=undefined&&$selectedColour.length>0){$selectedColour.attr('selected','selected');$colorswatch.filter(function(){return $(this).attr("data-shapesize")===$shapesize;}).show().filter(function(){return $(this).attr("data-prodcode")===$pid;}).addClass('active');}
else{$colorswatch.filter(function(){return $(this).attr("data-shapesize")===$shapesize;}).show().first().addClass('active');}}},onRemoveFavOver:function(evt){var $this=$(evt.target),$top=($this.offset().top-40),$left=($this.offset().left-75),tooltip_modal=$('.tooltip_modal')
if($this.attr('title')!=null){tooltip_modal.find('.tooltip_modal_in').text('').append($this.attr('title'))
tooltip_modal.css({'display':'block',top:$top,left:$left}).stop().animate({opacity:1},'slow')}},onRemoveFavOut:function(evt){$('.tooltip_modal').stop().animate({opacity:0},'slow',function(){$(this).css({'display':'none',top:0,left:0})})},removeAllFav:function(evt){var $this=$(evt.target),_self=this
if(!$this.hasClass('active')){$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UIServices/favourites/FavouritesService.svc/RemoveFavourite",data:{id:'all'},success:function(data){_self.onRemoveAllFav(data,$this)}});}
return false;},onRemoveAllFav:function(data,element){if(data.IsValid==true){window.location.reload();}},removeFav:function(evt){var $this=$(evt.target),prod_id=$this.attr("data-prodid"),_self=this
if(!$this.hasClass('active')){$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UIServices/favourites/FavouritesService.svc/RemoveFavourite",data:{id:prod_id},success:function(data){_self.onRemoveFav(data,$this)}});}
return false;},onRemoveFav:function(data,element){if(data.IsValid==true){window.location.reload();}},addToFav:function(evt){var $this=$(evt.target),_self=this,prod_id=$this.attr("data-prodid")
if(!$this.hasClass('active')){if($this.attr('title')!=null){if(typeof sli_search_page!="undefined"){$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UIServices/ExternalService.svc/AddToFavourites",data:{id:prod_id,uId:sli_custid},success:function(data){_self.onAddToFav(data,$this)}});}
else{$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UIServices/favourites/FavouritesService.svc/AddToFavourites",data:{id:prod_id},success:function(data){_self.onAddToFav(data,$this)}});}}}},onAddToFav:function(data,element){if(data.IsValid==true){element.addClass("active").attr('title','Item Added to Favourites')
$('.hasfavs h3 span').text(window.favourites+1);$('.fav-number').text(window.favourites+1).show();window.favourites=window.favourites+1;if(!$('#fav-tool').hasClass('active_g')){$('#fav-tool').addClass('active_g');}}},previewSetup:function(){$('.add_to_bag_f .color_swatch').on({click:$.proxy(this.onColourChange,this),mouseover:$.proxy(this.onSwatchOver,this),mouseleave:$.proxy(this.onSwatchOut,this)});$('.product_preview').find('.color_c a.active').click();$(".product_preview").find("#colour").on("change",$.proxy(this.onColourDropDownChange,this));$(".product_preview").find('.qplus').on('click',$.proxy(this.qtyPlus,this));$(".product_preview").find('.qminus').on('click',$.proxy(this.qtyMinus,this));$('.img_modal_pop .img_modal_c .close').on("click",$.proxy(this.closePopUp,this));$('#size').on('change',$.proxy(this.onSizeChange,this));},openQuickShopPopUp:function(e){e.preventDefault()
var $this=$(e.target),pId=$this.attr('data-prodid');var optionId=$this.attr('data-prodoptionid');var optionSize=$this.attr('data-prodsize');var lineId=$this.attr('data-lineItemId');var optionShape=$this.attr("data-prodshape");var optionShapeSize=$this.attr("data-prodshapesize");if(optionId!=undefined&&optionId.length==0){optionId=undefined;}
if(optionSize!=undefined&&optionSize.length==0){optionSize=undefined;}
if(optionShape!=undefined&&optionShape.length==0){optionShape=undefined;}
if(optionShapeSize!=undefined&&optionShapeSize.length==0){optionShapeSize=undefined;}
var selectedQty=0;var $qty=$this.parent().parent().find('.product-qty');var qtydropdown=$qty.find('.qty-dropdown').css('display');if(qtydropdown==undefined||qtydropdown=='none'){selectedQty=$qty.find('.edit-quantity .quantity').val();}
else{selectedQty=$qty.find('.qty-dropdown option:selected').val();}
$.ajax({type:"GET",cache:false,url:"/UIServices/CatalogService.svc/GetProductInformation",data:{productId:pId},contentType:"application/json; charset=utf-8",dataType:"json",success:$.proxy(this.onGetProduct,this,optionId,optionSize,lineId,selectedQty,optionShape,optionShapeSize)});},onGetProduct:function(optionId,optionSize,lineId,selectedQty,optionShape,optionShapeSize,response){var container=$('<div>').append($('#quickShop').html());if(response.IsValid){var product=response.entityData;var imageName=optionId==undefined?product.ImageName:optionId.replace(/^0+/g,'');container.find(".brand").text(product.Brand).attr("href",'/product/'+product.UrlDisplayName+'/'+product.ProductId).end().find(".fn").text(product.DisplayName).end().find(".product_code").text('Product Code '+imageName).end().find("#product_img").attr('href','http://s7v1.scene7.com/is/image/Harrods/'+imageName+'?$fullScreen$').end().find(".product_img").attr('src','http://s7v1.scene7.com/is/image/Harrods/'+imageName+'?$productMain$').end().find(".fav_it").attr("data-prodid",optionId==undefined?product.ProductId:optionId).end().find(".view_details").attr("href",'/product/'+product.UrlDisplayName+'/'+(optionId==undefined?product.ProductId:product.ProductId+"?p="+optionId));container.find("#quantity").attr('value',selectedQty);container.append("<input id='lineItemId' type='hidden' value='"+lineId+"' />");container.find(".fn").after($("<p id='prodShape'></p>").css('text-transform','capitalize').html(optionShape==undefined?'':optionShape.toLowerCase()+'s'));if(optionShape=="PILLOWCASE"){container.find('#size_detail label').html("Style");}
var pchanged='0';if(product.PromotionText!=''){container.find(".plp-promo-contr").html("<div class='plp-promotxt'>"+product.PromotionText+"</div>")}
if(((product.StartDiscountPrice<product.StartNormalPrice)&&product.StartDiscountPrice!=0)||((product.EndDiscountPrice<product.EndNormalPrice)&&product.EndDiscountPrice!=0)){pchanged='1';}
else{if(product.StartNormalPrice!=product.EndNormalPrice){pchanged='1';}}
if(product.ProductOptions!=null){for(var i in product.ProductOptions){if(product.ProductOptions.hasOwnProperty(i)){var productOption=product.ProductOptions[i];if(optionSize!==undefined){if(optionId==productOption.ProductId&&optionSize==productOption.Size){$cprice=productOption.Price.toString().indexOf('.')>0?productOption.Price.toString():productOption.Price.toString()+'.00';$cwasprice=productOption.WasPrice.toString().indexOf('.')>0?productOption.WasPrice.toString():productOption.WasPrice.toString()+'.00';break;}}
else if(optionShapeSize!==undefined){if(optionId==productOption.ProductId&&optionShapeSize==productOption.SizeOverride){$cprice=productOption.Price.toString().indexOf('.')>0?productOption.Price.toString():productOption.Price.toString()+'.00';$cwasprice=productOption.WasPrice.toString().indexOf('.')>0?productOption.WasPrice.toString():productOption.WasPrice.toString()+'.00';break;}}
else if(optionSize==undefined&&optionShapeSize==undefined){if(optionId==productOption.ProductId){$cprice=productOption.Price.toString().indexOf('.')>0?productOption.Price.toString():productOption.Price.toString()+'.00';$cwasprice=productOption.WasPrice.toString().indexOf('.')>0?productOption.WasPrice.toString():productOption.WasPrice.toString()+'.00';break;}}}}
if(parseFloat($cwasprice,10)>parseFloat($cprice,10))
container.find('.prices').html('<span class="was">£'+$cwasprice+'</span>'+'<span class="now">Now £'+$cprice+'</span>').removeClass('price_changed');else
container.find('.prices').html('<b>£'+$cprice+'</b>').removeClass('price_changed');}
else{$cprice=product.StartNormalPrice;}
var curProdId=optionId==undefined?product.ProductId:optionId;for(var i in product.ProductOptions){if(product.ProductOptions.hasOwnProperty(i)){var productOption=product.ProductOptions[i];if(productOption.Colour!=""){var option=$('<option></option>');var productOptionShape=productOption.Shape.trim();var productOptionSizeOverride=productOption.SizeOverride.trim();if(productOptionShape.length!=0&&productOptionSizeOverride.length!=0){if(optionShape!=undefined&&productOptionShape==optionShape){option.attr('value',productOption.Colour).attr("data-prodcode",productOption.ProductId).attr('data-pchanged',pchanged).attr("data-pid",productOption.ProductId).text(productOption.Colour);option.attr('data-colour',productOption.Colour).attr('data-shape',productOptionShape).attr('data-shapesize',productOptionSizeOverride);option.attr('data-lineItemId',productOption.LineItemId);if(optionShapeSize!=undefined&&productOptionSizeOverride!=optionShapeSize){option.hide();option.attr('disabled','disabled');}}}
else{if(container.find("#colour option:contains('"+productOption.Colour+"')").length==0){option.attr('value',productOption.Colour).attr("data-prodcode",productOption.ProductId).attr('data-pchanged',pchanged).attr("data-pid",productOption.ProductId).text(productOption.Colour);}}
if(option.val().length>0){if(optionId!=undefined&&productOption.ProductId==optionId){option.attr('selected','selected');}
container.find("#colour").append(option);}
if(i==0){container.find("#colour").attr('data-pid',product.ProductId);}
if(option.val().length>0)
{if(container.find(".color_c a[data-prodcode="+productOption.ProductId+"]").length==0){var link=$('<a></a>');link.attr('class',"color_swatch").attr('href',"http://s7v1.scene7.com/is/image/Harrods/"+productOption.ProductId.replace(/(^0+)/,'')+"-s").attr('prodid',productOption.ProductId.replace(/(^0+)/,'')).attr('data-cprice',productOption.Price).attr('data-prodcode',productOption.ProductId).attr('pchanged',pchanged).attr('cmodelview','1').attr('data-cname',productOption.Colour).attr('data-quan',productOption.Quantity).text('#'+productOption.ProductId.replace(/(^0+)/,''));link.css('background','url('+"http://s7v1.scene7.com/is/image/Harrods/"+productOption.ProductId.replace(/(^0+)/,'')+"-s"+') repeat left top');if(productOptionShape.length!=0&&productOptionSizeOverride.length!=0){link.attr('data-colour',productOption.Colour).attr('data-shape',productOptionShape).attr('data-shapesize',productOptionSizeOverride);if(option.css('display')=='none'){link.css('display','none');}}
else if(container.find(".color_c a").length>4){link.css('display','none');}
if(productOption.ProductId==curProdId){link.addClass('active');}
container.find('.color_c').append(link);}}}
else{container.find('#colour_detail').empty();}}}
var uniqueColours=container.find("#colour option");if(productOptionShape!=undefined&&productOptionSizeOverride!=undefined){if(productOptionShape.length!=0&&productOptionSizeOverride.length!=0){uniqueColours=container.find("#colour option").not("[style='display: none;']").length;}}
if(uniqueColours>5){container.find(".color_c").append("<a title='View more colour options' class='color_more' href='/product/"+product.UrlDisplayName+"/"+product.ProductId+"'>more colours <span>("+(uniqueColours-5)+")</span></a>");}
for(var i in product.ProductOptions){if(product.ProductOptions.hasOwnProperty(i)){var productOption=product.ProductOptions[i];var productOptionShape=productOption.Shape.trim();var productOptionSizeOverride=productOption.SizeOverride.trim();if(productOption.Size!=""){var option=$('<option></option>');option.attr("data-pid",productOption.ProductId).attr("data-cprice",productOption.Price).attr("data-cwasprice",productOption.WasPrice).attr('data-quan',productOption.Quantity).attr('value',productOption.VariantId).text(productOption.Size);if(productOption.Colour!=""&&productOption.Colour!=container.find('#colour').val()){option.hide();option.attr('disabled','disabled');}
else{if(optionSize!=undefined&&productOption.Size==optionSize){option.attr('selected','selected');}}
container.find("#size").append(option);}
else if(productOptionShape.length!=0&&productOptionSizeOverride.length!=0){var option=$('<option></option>');option.attr("data-pid",productOption.ProductId).attr("data-cprice",productOption.Price).attr("data-cwasprice",productOption.WasPrice).attr('data-quan',productOption.Quantity).attr('value',productOption.SizeOverride).text(productOption.SizeOverride);if(optionShape!=undefined&&productOption.Shape.trim()==optionShape){option.attr('data-colour',productOption.Colour).attr('data-shape',productOptionShape).attr('data-shapesize',productOptionSizeOverride);if(productOption.Colour!=""&&productOption.Colour!=container.find('#colour').val()){option.hide();option.attr('disabled','disabled');}
else{if(optionShapeSize!=undefined&&productOption.SizeOverride==optionShapeSize){option.attr('selected','selected');$cprice=productOption.Price.toString().indexOf('.')>0?productOption.Price.toString():productOption.Price.toString()+'.00';$cwasprice=productOption.WasPrice.toString().indexOf('.')>0?productOption.WasPrice.toString():productOption.WasPrice.toString()+'.00';if(parseFloat($cwasprice,10)>parseFloat($cprice,10))
container.find('.prices').html('<span class="was">£'+$cwasprice+'</span>'+'<span class="now">Now £'+$cprice+'</span>').removeClass('price_changed');else
container.find('.prices').html('<b>£'+$cprice+'</b>').removeClass('price_changed');}}
container.find("#size").append(option);}}}}
if(product.ProductOptions.length==1){container.find('#quantity').attr('data-instock',product.ProductOptions[0].Quantity);}
if(container.find("#colour option").length<2){container.find("#colour_detail").hide();}
if(container.find("#size option").length==0){container.find("#size_detail").empty();}
if(container.find("#size option").length==0&&container.find("#colour option").length==0){if(optionId!=undefined){container.find(".add_to_bag_f").find('#add_to_bag').attr("data-prodid",optionId);}
else{container.find(".add_to_bag_f").find('#add_to_bag').attr("data-prodid",product.ProductId);}}
if(product.IsExportable===false){container.append("<span class='uk-only'>UK Delivery Only</div>");}
var li=$('<li>').append($('#sideImage').html());for(var i=0;i<product.AlternativeViewCount;i++){if(i==0){li.find('a').attr('href','http://s7v1.scene7.com/is/image/Harrods/'+product.ImageName+'?$fullScreen$').attr('rel',"useZoom: \'product_img\', smallImage: \'http://s7v1.scene7.com/is/image/Harrods/"+product.ImageName+"?$productMain$\'").find('img').attr('src','http://s7v1.scene7.com/is/image/Harrods/'+product.ImageName+'?$thumbnail$');}
else{li.find('a').attr('href','http://s7v1.scene7.com/is/image/Harrods/'+product.ImageName+'-'+i+'?$fullScreen$').attr('rel',"useZoom: \'product_img\', smallImage: \'http://s7v1.scene7.com/is/image/Harrods/"+product.ImageName+'-'+i+"?$productMain$\'").end().find('img').attr('src','http://s7v1.scene7.com/is/image/Harrods/'+product.ImageName+'-'+i+'?$thumbnail$');}
container.find('.alt_view').append(li.html());}}
var w_w=$(window).outerWidth(),w_h=$(window).outerHeight(),$left=(w_w-720)/2,img_modal=['<div class="img_modal_pop" style="width:',w_w,'px;height:',w_h,'px"><div class="img_modal_bg" style="width:',w_w,'px;height:',w_h,'px"></div><div class="img_modal_c" style="width:680px;height:320px;padding:40px;position:fixed;top:190px;left:',$left,'px"><div class="close"><img src="/public/img/close.png" /></div>',container.html(),'</div></div>'].join('')
$('.img_modal_pop').remove();$('body').append(img_modal);$('.img_modal_pop').fadeIn();$('.cloud-zoom, .cloud-zoom-gallery').CloudZoom();this.previewSetup();},onColourDropDownChange:function(evt){var $this=$(evt.target);var $option=$this.find("option:selected");var $pid=$option.attr('data-pid');var colour_swatch;colour_swatch=$(".add_to_bag_f .color_swatch[data-prodcode='"+$pid+"']");if(colour_swatch.length>0){colour_swatch.click()}},onColourChange:function(evt){evt.preventDefault();var $this=$(evt.target),$cprice=$this.attr('data-cprice'),_self=this,$pid=$this.attr('data-prodcode').toString(),$cname=$this.attr('data-cname'),ismodelview='',$altDiv=$('.alt_view'),priceChanged=$this.attr('pchanged'),$quantity=$this.data('quan'),$id=$this.attr('data-prodid'),$cwasprice=$this.attr('data-cwasprice'),$shape=$this.attr('data-shape'),$shapesize=$this.attr('data-shapesize'),$colour=$this.attr('data-colour');$('.product_code').text('Product Code '+$pid.replace(/(^0+)/,'')).attr("data-prodid",$pid.replace(/(^0+)/,''));var $colorswatch=$('.color_c .color_swatch, .color_box .color_swatch');$colorswatch.removeClass('active');$($this).addClass('active');$(".product_preview").find("#size option").attr('disabled','disabled').hide();if($shape!=undefined&&$shapesize!=undefined){$(".product_preview").find("#size option").removeAttr('selected');$(".product_preview").find("#size option[data-colour='"+$colour+"']").show().removeAttr('disabled');$(".product_preview").find("#size option[data-pid='"+$pid+"']").attr('selected','selected');}
else{var selectedVal=$("#size").val();$(".product_preview").find("#size option").removeAttr('selected');$(".product_preview").find("#size option[data-pid='"+$pid+"']").show().removeAttr('disabled').filter(function(){return $(this).attr('value')===selectedVal;}).attr('selected','selected');}
$("#colour option[data-pid='"+$pid+"']").attr('selected','selected');$pid=$pid.replace(/(^0+)/,'');$('#colour').attr('data-pid',$pid).attr('data-quan',$quantity).data('pid',$pid);var newel=$(".product_preview").find('.product_main_img').clone().find('.product_img').attr('src','http://s7v1.scene7.com/is/image/Harrods/'+$pid+ismodelview+'?$productMain$').end().attr('href','http://s7v1.scene7.com/is/image/Harrods/'+$pid+ismodelview+'?$fullScreen$');$('#wrap').remove();var $altDiv=$(".product_preview").find('.alt_view');$altDiv.find('li').each(function(i,v){if(i==0){rel='http://s7v1.scene7.com/is/image/Harrods/'+$pid+'?$productMain$'
$(this).find('a').attr('href','http://s7v1.scene7.com/is/image/Harrods/'+$pid+'?$fullScreen$').attr('rel',"useZoom: 'product_img', smallImage: '"+rel+"'")
$(this).find('img').attr('src','http://s7v1.scene7.com/is/image/Harrods/'+$pid+'?$thumbnail$')}else{if(!$(this).find('a').hasClass('cloud-360')){rel='http://s7v1.scene7.com/is/image/Harrods/'+$pid+'-'+i+'?$productMain$'
$(this).find('a').attr('href','http://s7v1.scene7.com/is/image/Harrods/'+$pid+'-'+i+'?$fullScreen$').attr('rel',"useZoom: 'product_img', smallImage: '"+rel+"'")
$(this).find('img').attr('src','http://s7v1.scene7.com/is/image/Harrods/'+$pid+'-'+i+'?$thumbnail$')}else{$(this).find('img:first').attr('src','http://s7v1.scene7.com/is/image/Harrods/'+$pid+'?$thumbnail$')}}})
if($cwasprice!=null&&$cprice!=null){$cprice=$cprice.toString().indexOf('.')>0?$cprice.toString():$cprice.toString()+'.00';$cwasprice=$cwasprice.toString().indexOf('.')>0?$cwasprice.toString():$cwasprice.toString()+'.00';if(parseFloat($cwasprice.replace('£',''),10)>parseFloat($cprice.replace('£',''),10)){if(!$cprice.match('^£'))
$cprice='£'+$cprice;if(!$cwasprice.match('^£'))
$cwasprice='£'+$cwasprice;$('.prices').html('<span class="was">'+$cwasprice+'</span>'+'<span class="now">Now '+$cprice+'</span>').removeClass('price_changed');}
else{$cprice=$cprice.toString().indexOf('.')>0?$cprice.toString():$cprice.toString()+'.00';if(!$cprice.match('^£'))
$cprice='£'+$cprice;$('.prices').html('<b>'+$cprice+'</b>').removeClass('price_changed');}}
$altDiv.after(newel)
$('.cloud-zoom, .cloud-zoom-gallery').CloudZoom();},qtyPlus:function(evt){var $this=$(evt.target),max_qty=$this.siblings('#quantity').data('maxbasketcount'),qty
if(max_qty==$this.siblings('#quantity').val()){$('.error').remove();$('#quantity').before('<p class="error">Maximum quantity for this item is '+maxQty+'</p>');}else{qty=$this.siblings('#quantity').val();qty++;$this.siblings('#quantity').val(qty);};return false;},qtyMinus:function(evt){var $this=$(evt.target),min_qty=$this.siblings('#quantity').data('minbasketcount'),qty
if(min_qty==0&&$this.siblings('#quantity').val()==1){}else if(min_qty==$this.siblings('#quantity').val()){}else{qty=$this.siblings('#quantity').val();qty--;$this.siblings('#quantity').val(qty);};return false;},closePopUp:function(evt){var $this=$(evt.target),_self=this;$('.img_modal_pop').fadeTo(500,0,function(){$('.img_modal_pop').empty();$('.img_modal_pop').remove();});},onSwatchOver:function(evt){var $this=$(evt.target),$top=($this.offset().top-107),$left=($this.offset().left-80),bgurl=$this.attr('href'),cprice=$this.attr('data-cprice'),cname=$this.attr('data-cname'),swatch_modal=$('.swatch_modal')
if(!cprice.match('^£')){cprice='£'+cprice;}
swatch_modal.find('.swatch_name').text(cname).end().find('.swatch_price').text(cprice).end().find('.swatch_color').css('background','url('+bgurl+') repeat left top')
swatch_modal.css({'display':'block',top:$top,left:$left}).stop().animate({opacity:1},'slow')},onSwatchOut:function(evt){$('.swatch_modal').stop().animate({opacity:0},'slow',function(){$(this).css({'display':'none',top:0,left:0})})}}));Hrd.define('Harrods.FooterPages',Hrd.extend({init:function(config){Hrd.apply(this._config,config);if($("dl.accordions").length>0){var theHash=window.location.hash;if(theHash!=""){theHash=theHash.replace(/#/g,'').substr(0,2).replace(/_/g,'')-1;$('dl.accordions dt').eq(theHash).addClass('active');$('dl.accordions dd').eq(theHash).show();var targetOffset=$('dl.accordions dt').eq(theHash).offset().top;$('html,body').animate({scrollTop:targetOffset},"slow");}else if($(".designers_accor").length>0){$('dl.accordions dt').addClass('active');$('dl.accordions dd').show();}else if($(".furniture_landing").length>0||$(".sizeguide").length>0){}else{$('dl.accordions dt').eq(0).addClass('active');$('dl.accordions dd').eq(0).show();};};if($(".designers_az_c").length>0||$(".designers_accor").length>0){$('body').append('<p class="tooltip">Coming soon</p>');if($(".coming_soon").length>0){$(".coming_soon").hover(function(){var tooltop=($(this).offset().top)-20;var toolleft=$(this).offset().left+20;$(".tooltip").css({top:tooltop,left:toolleft}).fadeIn();},function(){$(".tooltip").fadeOut();})}}
this.oldAccordion();this.filterRestaurantItems('restaurant_fine');$('.restaurant_tabs>a>span').on({click:$.proxy(this.onRestaurantTabClick,this)});$('.right_col_tree > li:first-child').addClass('active');$('.right_col_tree > li:first-child > ul > li:first-child').addClass('active');$('.lv1 > li, .lv2 > li').on('click',function(e){$(this).siblings('li').removeClass('active');$(this).addClass('active');});$('.viewStyles a').on('click',$.proxy(this.toggleCalendarView,this));$('.eventLink').on({mouseover:$.proxy(this.onEventOver,this),mouseleave:$.proxy(this.onEventOut,this)})
$('.hasEvent li .close').on({click:$.proxy(this.onEventOut,this)});$(".gcb_check").on('click',$.proxy(this.giftCardCheck,this));$('.see_more').click(function(){$(this).hide()
$('.brands_hero_copy').show();});$('.see_less').click(function(){$('.see_more').show()
$('.brands_hero_copy').hide();});$('#read_more').click(function(){$('#more_info').toggle();})
if($("#map_canvas_b").length>0){this.setGoogleMap();}
if($(".grotto_tab-content").length>0){this.grotto();}
if($(".top5-cont").length>0){$(".top5-cont").each(function(){var $this=$(this),link=$this.find("h2 a").attr("href");$this.on('click',function(){window.location=link});});}},grotto:function(){var $tabContent=$('.grotto_tab-content');$tabContent.hide();$("#tabmenu li:first").addClass("active").show();$tabContent.first().show();$("#tabmenu li").click(function(e){$("#tabmenu li").removeClass("active");$(this).addClass("active");$tabContent.hide();var $activeTab=$(this).find("a").attr("href").split('#');var $activeItem=$activeTab[1];$('#'+$activeItem).show();e.preventDefault();;});var w_w=$(window).outerWidth(),w_h=$(window).outerHeight(),img_modal=['<div class="img_modal grotto_modal" style="width:',w_w,'px;height:',w_h,'px"><div class="img_modal_bg" style="width:',w_w,'px;height:',w_h,'px"></div><div class="img_modal_c"><div class="close"><img src="/public/img/close.png" /></div>','<div class="img_modal_alt_c"><ul></ul></div>','<img src="" class="theLargeimg" alt=""></div></div>'].join('')
$('.img_modal').remove();$('body').append(img_modal);$('.view_large').on('click',function(e){e.preventDefault();var $largeImgURL=$(this).attr('href'),modalDiv=$('.img_modal_c'),scrollPos=$(window).scrollTop(),winHeight=$(window).height(),modalDivHeight=$(modalDiv).outerHeight();$('.theLargeimg').attr('src',$largeImgURL);var yPos=((winHeight-modalDivHeight)/5)+scrollPos;$(modalDiv).css({'top':yPos});$('.img_modal').show();});},setGoogleMap:function(){$.getScript('http://maps.googleapis.com/maps/api/js?key=AIzaSyCdA6b-5ubFiYTi08nPKtLIgF0w3NJwPk4&sensor=false&callback=mapInitialize')
window.mapInitialize=function(){var myOptions={center:new google.maps.LatLng(51.500000,-0.163379),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(document.getElementById("map_canvas_b"),myOptions),image=new google.maps.MarkerImage('/public/img/h-map-marker.png',new google.maps.Size(57,57),new google.maps.Point(0,0),new google.maps.Point(20,30)),myLatLng=new google.maps.LatLng(51.499223,-0.163282),marker=new google.maps.Marker({position:myLatLng,map:map,icon:image});}},onRestaurantTabClick:function(evt){var $this=$(evt.target),thisId=$this.parents("li").attr("id");this.filterRestaurantItems(thisId);$('.rest-nav li').removeClass('rest-nav-selected');$this.parents("li").addClass('rest-nav-selected');return false;},filterRestaurantItems:function(restaurantType){$('.summary').each(function(){$this=$(this);if(!$this.hasClass(restaurantType)&&!$this.hasClass('display')){$(this).hide();}else{$(this).show();}})
$('.restaurant_item').each(function(){if(restaurantType=='restaurant_all'){$(this).show();}
else{if(!$(this).hasClass(restaurantType)){$(this).hide();}else{$(this).show();}}})
return false;},onEventOver:function(evt){var $this=$(evt.target),$top=$this.position().top-190,$left=$this.position().left-230
$this.parents('table').find('.more_info_modal').stop().animate({opacity:0},'slow').css({'display':'none','top':0,'left':0})
$this.parent().find('.more_info_modal').css({'display':'block','top':$top,'left':$left}).stop().animate({opacity:1},'slow')},onEventOut:function(evt){var $this=$(evt.target)
if(evt.type=='mouseleave'){$this.siblings('.more_info_modal').stop().animate({opacity:0},'slow').css({'display':'none','top':0,'left':0})}else{$this.parents('.more_info_modal').stop().animate({opacity:0},'slow').css({'display':'none','top':0,'left':0})}},giftCardCheck:function(evt){var $this=$(evt.target),g_card_nb=$this.parents(".gift_card_login").find("#gift_card_number").val(),g_card_pin=$this.parents(".gift_card_login").find("#gift_card_pin").val(),cardNumber,cardPin,gift_card_nb_reg=/^\d{16}$/,gift_card_pin_reg=/^\d{4}$/,card_nb_error='<li class="error_c"><p class="error">Please enter a correct card number.</p></li>',card_pin_eroor='<li class="error_c"><p class="error">Please enter a correct pin number.</p></li>',service_url
$(".error_c").remove();if(!gift_card_nb_reg.test(g_card_nb)){$this.parents(".gift_card_login").find("#gift_card_number").parent("li").before(card_nb_error).addClass('error');}else if(!gift_card_pin_reg.test(g_card_pin)){$this.parents(".gift_card_login").find("#gift_card_pin").parent("li").before(card_pin_eroor).addClass('error');}else{$(".error_c").remove();cardNumber=$(".gift_card_login").find("#gift_card_number").val()
cardPin=$(".gift_card_login").find("#gift_card_pin").val();service_url=PROTOCOL+WEBROOT+'/UIServices/GiftCardService.asmx/BalanceCheck'
$.ajax({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",url:PROTOCOL+WEBROOT+'/UIServices/GiftCardService.asmx/BalanceCheck',data:JSON.stringify({"cardNumber":cardNumber,"pin":cardPin}),success:$.proxy(this.onGiftCardBalance,this)});};return false;},onGiftCardBalance:function(response){if(response.d.IsValid){var card_fst_4=$(".gift_card_login").find("#gift_card_number").val().substr(0,4),card_lst_4=$(".gift_card_login").find("#gift_card_number").val().substr(12,20),card_balance=response.d.EntityData.CurrBal;$(".main_copy").hide();$(".display_balance .card_no").text(card_fst_4+" **** **** "+card_lst_4);$(".display_balance .card_blc").text("£"+card_balance);$(".display_balance").show();$(".gift_card_login").find("#gift_card_number, #gift_card_pin").val('');}else{$(".gift_card_login").find("#gift_card_number").parent("li").before('<li class="error_c"><p class="error">'+response.d.ErrorMessage+'</p></li>').addClass('error');}},oldAccordion:function(){$('.accordions dt').on("click",function(){if($(this).next('dd').is(':hidden')){$(this).addClass('active');$(this).next('dd').slideDown('fast');}else{$(this).removeClass('active');$(this).next('dd').slideUp('fast');};});},toggleCalendarView:function(evt){var $this=$(evt.target),curview,querystring
if(location.search.length>0){curview=Harrods.Mixins.getQueryString('view');if(curview!=undefined){querystring=location.search.replace(curview,$this.text());window.location.href=window.location.pathname+querystring;}else{window.location.href=window.location.pathname+location.search+"&view="+$this.text();}}else{window.location.href=window.location.pathname+"?view="+$this.text();}
return false;}}));Hrd.define('Harrods.Home',Hrd.extend({_fopen:false,_nopen:false,_body:$('body'),_window:$(window),_scroll:($.browser.mozilla||$.browser.msie)?$('html'):$('body'),closest:{e:null,v:9999},_topCat:false,current:null,_transform:(Modernizr.prefixed('transform')||"").replace(/([A-Z])/g,function(str,m1){return'-'+m1.toLowerCase();}).replace(/^ms-/,'-ms-'),_config:{container:window,threshold:-700,inertia:.3,masterheadheight:80},init:function(config){Hrd.apply(this._config,config);if(topCat==='new-christmas'){topCat='static';}
this.isDocking=false;if(topCat!='static'){$('.story').height(this._window.height());}
else if(topCat=='static'){$('.story').height(1034);}
$('#megamenu a.topnavlink').on('click.harrods.home',$.proxy(this.onClick,this));this.updateDimensions();this.preload();this.load4q();},load4q:function(){$.getScript('http://ips-invite.iperceptions.com/webValidator.aspx?sdfc=f4c2df60-37947-60d55f44-33c0-42f5-9dd4-4bd94af06490&lID=1&loc=4Q-WEB2&cD=90&rF=False&iType=1&domainname=0')},onClearScroll:function(){this.isAnimating=false;this._scroll.stop();},preload:function(){if(topCat!=undefined&&topCat!='siteroot'&&topCat!='static'){this._topCat=true;topCat=topCat.replace(/ /g,'-');$('#megamenu').find("#new-"+topCat).trigger('click.harrods.home');};var aImg=[];for(var i in homeImages){if(homeImages[i]!=''){aImg.push(homeImages[i]);}}
if(aImg.Length>0){$('.story').css("visibility","hidden");}
Hrd.preloader.queue(aImg);Hrd.preloader.preload($.proxy(this.onLoaded,this));},onLoaded:function(){if(this._isIpad){$('.story').css({'background-attachment':'scroll','background-position':'center top'});}else{this._window.bind('resize',$.proxy(this.updateDimensions,this)).bind('resizestop',$.proxy(this.stopResize,this)).bind('scroll',$.proxy(this.onScroll,this)).bind('mousedown',$.proxy(this.onClearScroll,this)).bind('mousewheel',$.proxy(this.onClearScroll,this));}
$('.story').css("visibility","visible").fadeIn(1000,function(){$('.row').each(function(){$(this).data('y',$(this).offset().top);});});},onClick:function(evt){if($('body').hasClass('home')&&topCat!='static'){$('#megamenu a').removeClass('active');$(evt.target).addClass('active');this.isAnimating=true;var story=(evt.target.id).replace('new-','');var oldIndex=(this.current!=null)?this.current.index():0;this.current=$("#story-"+story);var dist=Math.abs(oldIndex-this.current.index());if(dist<3)dist=1
else dist=2;if(this._topCat){dist=0;this._topCat=false;}
var _top=this.current.offset().top;var _self=this;if(this._isIpad){return true;}
else{this._scroll.stop().animate({'scrollTop':_top},dist*1800,'easeInOutCirc',function(){_self.isDocking=false;_self.isAnimating=false;});return false;}}
else{return true;}},stopResize:function(e){},updateDimensions:function(){this._config.threshold=-this._window.height();},onScroll:function(evt){var _self=this;this.closest.proximity=99999;var sectionProximity;$('.story').each(function(index){var _x='50% ';var _y;if(topCat!=='static'){_y=-(_self.distancefromfold($(this)))*_self._config.inertia+_self._config.masterheadheight;}else{_y=-$(window).scrollTop()+_self._config.masterheadheight;}
var bpos=_x+_y+'px';$(this).css({'backgroundPosition':bpos});var dff=_self.distancefromfold($(this));if(topCat!=='static'){$(this).find('article .box').each(function(){var $e=$(this);var s=$e.data('speed');$e.css({marginTop:(-dff*s)+'px'});});}
sectionProximity=Math.abs(_self.distancefromfold($(this)));if(sectionProximity<_self.closest.proximity){_self.closest.e=$(this);_self.closest.proximity=sectionProximity;}});if(!this.isAnimating){var i='#new-'+this.closest.e.attr('id').replace(/story-/,'');if(!$(i).hasClass('active')){$(i).trigger('click.harrods.scene');}
this.scrollArrow($(i),true);}},scrollArrow:function(target,anim){var p=target.position().left+target.width()/2+9;$('#megamenu .marker').css('left',p+'px');},onScrollOver:function(evt){this.scrollTimeout=false;if(this.closest.e==null){return;}
var _self=false;var i='#new-'+this.closest.e.attr('id').replace(/story-/,'');$(i).trigger('click.harrods.home');},distancefromfold:function($element){var fold=$(window).height()+$(window).scrollTop();return(fold-$element.height())-$element.offset().top;},inview:function($element,settings){}}));Hrd.define('Harrods.Login',Hrd.extend({_loader:'<img src="/new_images/zoomloader.gif" class="small_loader" alt="Loading ..." />',_emailReg:Harrods.Regex.email,_passReg:Harrods.Regex.password,_returnUrl:Harrods.Mixins.getQueryString("ReturnUrl"),_loginErrors:{},_loginInvalid:"false",init:function(config){Hrd.apply(this._config,config);$("[ID$='lnkLogInRegistered']").on('click',$.proxy(this.loginIn,this));$("[ID$='txtPassword'], [ID$='txtEmail']").on({keypress:$.proxy(this.onKeyPress,this)})},loginIn:function(){this._loginInvalid="false";var eMailNew=$("[ID$='txtEmail']"),password=$("[ID$='txtPassword']"),login_val=eMailNew.val(),pass_val=password.val()
this.removeErrorMessages();this.validateMandatoryField(eMailNew,'Email is required');if($.trim(login_val)!=''&&!this._emailReg.test($.trim(login_val))){this._loginInvalid="true";this.addValError(eMailNew,'Incorrect Email');}
this.validateMandatoryField(password,'Account Password is required');if(this._loginInvalid=="false"){this.addLoader($(".right_column"));var _self=this
$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AccountService.svc/Signin",contentType:"application/json; charset=utf-8",dataType:"json",data:'{ "email": "'+login_val+'", "password": "'+pass_val+'"}',success:function(data){$.proxy(_self.onSignin(data),_self)},error:function(data){$.proxy(_self.onSigninFail(data),_self)}});}else{this.showMessage("msgboxValidation",'Please correct/complete highlighted fields below');s_sendFormErrorEvent(s.pageName,"LogInRegistered",this._loginErrors);}
return false;},onSigninFail:function(){var errMsg='There was a problem with the server - please try again'
$(".loadingCover, .loadingBg").remove();this.showMessage("msgboxError",errMsg);$("[ID$='txtPassword']").val('');},onSignin:function(response){if(response.d.isValid&&response.d.entityData!=null){s_sendFormSuccessEvent(s.pageName,"LogInRegistered");this._returnUrl='/account';this.loadNextPage();}else{var errMsg=response.d.errorMessage;if(response.d.errors!=null){var that=this;$.each(response.d.errors,function(key,val){errMsg=errMsg+'<br />'+val.Value;that._loginErrors[val.Value]=val.Value;});s_sendFormErrorEvent(s.pageName,"LogInRegistered",this._loginErrors);}
$(".loadingCover, .loadingBg").remove();this.showMessage("msgboxError",errMsg);$("[ID$='txtPassword']").val('');}},focusOnLoad:function(){if($("[ID$='btnRegister']").length>0&&$("[ID$='txtEmail']").val()==''){$("[ID$='txtFirstName']").focus();}else{$("[ID$='txtPassword']").focus();}},onKeyPress:function(evt){if(evt.which==13){$("[ID$='lnkLogInRegistered']").click();$(evt.target).blur();}},addLoader:function(theparent){var loadingCover=$("<div class='loadingCover'></div>"),loadingBg=$("<div class='loadingBg'></div>")
loadingCover.height(theparent.height()).width(theparent.width()+10)
loadingBg.height(theparent.height()).width(theparent.width()+10)
theparent.prepend(loadingBg).prepend(loadingCover);},listHightlight:function(){$('.login_f li input, .unsigned_f li input, .to_from li input, .to_from li select').focus(function(){if($(this).attr('id')!='payment_startdate_year'&&$(this).attr('id')!='payment_expirydate_year'){$('.login_f li, .unsigned_f li, .to_from li').removeClass('active');$(this).parent('li').addClass('active');}});},loadNextPage:function(){var Url={encode:function(string){return escape(this._utf8_encode(string));},decode:function(string){return this._utf8_decode(unescape(string));},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}}
if(this._returnUrl!=undefined){var newURL=this._returnUrl;if(newURL.indexOf("?")!=-1){newURL=newURL+="&ref=login";}else{newURL=newURL+="?ref=login";}
newURL=Url.decode(newURL);if(newURL=='/'){window.location='/account?ref=login';$(".loadingCover, .loadingBg").remove();}else{window.location=newURL;$(".loadingCover, .loadingBg").remove();}}else{window.location='/account?ref=login';$(".loadingCover, .loadingBg").remove();}},validateMandatoryField:function(field,message){if($.trim(field.val())==''){this._loginInvalid="true";this.addValError(field,message);}},addValError:function(field,message){field.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');if(field!=null&&field[0]!=null){this._loginErrors[message]=message;}},removeErrorMessages:function(){$("li.error, div.error, li.error_c").removeClass('error');$("li.error_c").empty().hide();$('#MessageBox').empty().removeClass();this._loginErrors={};},showMessage:function(type,message){$('#MessageBox').empty().removeClass().html(message).addClass(type).show("slow");}}));Hrd.define('Harrods.MiniHarrods',Hrd.extend({init:function(config){Hrd.apply(this._config,config);$("[ID$='btnJoinMiniHarrods']").on('click',$.proxy(this.joinMiniHarrods,this));$("[ID$='drpAccounts']").on('change',$.proxy(this.onChildSelect,this))
$(".remove_child").on('click',$.proxy(this.removeChild,this));$("#btnUpdateMiniHarrods").on('click',$.proxy(this.updateMiniHarrods,this));$("[ID$='btnAddMiniHarrods']").on('click',$.proxy(this.addMiniHarrods,this));$("[ID$='ddlMiniHarrods']").on('change',$.proxy(this.RenderName,this));$("[ID$='ddlReason'], [ID$='ddlRewardsMember']").on('change',$.proxy(this.renderMiniName,this));$("[ID$='normalRewards']").on('click',$.proxy(this.requestCard,this));$("[ID$='miniRewards']").on('click',$.proxy(this.requestCardMini,this));$("[ID$='confirm'] .cancel").on('click',$.proxy(this.cancelCardRequest,this));$("[ID$='miniConfirm'] .cancel").on('click',$.proxy(this.cancelCardRequestMini,this));this.renderMiniName();this.RenderName(null);$(".print_card").on('click',function(e){print();})
$("#aspnetForm").submit(function(){return false;});},requestCard:function(){$(".new_rcard_main").slideUp("fast",function(){$("[ID$='confirm']").slideDown()});},cancelCardRequest:function(){$("[ID$='confirm']").slideUp("fast",function(){$(".new_rcard_main").slideDown();});},requestCardMini:function(){$(".new_rcard_main").slideUp("fast",function(){$("[ID$='miniConfirm']").slideDown()});},cancelCardRequestMini:function(){$("[ID$='miniConfirm']").slideUp("fast",function(){$(".new_rcard_main").slideDown();});},RenderName:function(o){var child_no;if(o==null||o==undefined){child_no=$("[ID$='ddlMiniHarrods']").find('option:first').val();}else{child_no=$(o.target).find('option:selected').val()}
$("#ChildCardName").text(child_no);},renderMiniName:function(){var userNames=[];if($("[ID$='ddlRewardsMember']").length>0){userNames=String($("[ID$='ddlRewardsMember']").val()).split(':');}else{userNames=String($("[ID$='hidVaues']").val()).split(':');}
$(".name_line_1:first").text(userNames[1]);$(".name_line_2:first").text(userNames[2]);},addMiniHarrods:function(evt){evt.preventDefault();var invalid=true,ksinfo=[]
$(".new_k_info").each(function(i,v){var kgender,krelation,kfirstname,klastname,kdobd,kdobm,kdoby
if($(this).find("[ID$='drpChildGender'] option:selected").val()==''){alert('Please Select Gender');invalid=true}else{kgender=$(this).find("[ID$='drpChildGender'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildRelationship'] option:selected").val()==''){alert('Please Select Relationship');invalid=true}else{krelation=$(this).find("[ID$='drpChildRelationship'] option:selected").val()
invalid=false}
if($(this).find("[ID$='txtChildFirstName']").val()==''){alert('Please Enter Child\'s first name');invalid=true}else{kfirstname=$(this).find("[ID$='txtChildFirstName']").val()
invalid=false}
if($(this).find("[ID$='txtChildSurname']").val()==''){alert('Please Enter Child\'s last name');invalid=true}else{klastname=$(this).find("[ID$='txtChildSurname']").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBDay'] option:selected").val()==''){alert('Please Enter a birthday day');invalid=true}else{kdobd=$(this).find("[ID$='drpChildDOBDay'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBMonth'] option:selected").val()==''){alert('Please Enter a birthday month');invalid=true}else{kdobm=$(this).find("[ID$='drpChildDOBMonth'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBYear'] option:selected").val()==''){alert('Please Enter a birthday year');invalid=true}else{kdoby=$(this).find("[ID$='drpChildDOBYear'] option:selected").val()
invalid=false}
ksinfo.push({"Gender":kgender,"KCRelationshipField":krelation,"FirstName":kfirstname,"Surname":klastname,"DateOfBirthDay":kdobd,"DateOfBirthMonth":kdobm,"DateOfBirthYear":kdoby})})
if(invalid==false){this.addLoader($(".right_column"));var o=this;$.ajax({url:'/UIServices/Account/LoyaltyService.svc/AddAssociatedAccounts',dataType:'json',contentType:'application/json;charset=utf-8',type:"POST",data:JSON.stringify({associatedAccounts:ksinfo}),success:function(data){if(data.d.isValid==true){window.location="/account/print-mini-harrods"}else{alert(data.d.errorMessage);o.onUpdateFail();}}});}},addLoader:function(theparent){var loadingCover=$("<div class='loadingCover'></div>"),loadingBg=$("<div class='loadingBg'></div>")
loadingCover.height(theparent.height()).width(theparent.width()+10)
loadingBg.height(theparent.height()).width(theparent.width()+10)
theparent.prepend(loadingBg).prepend(loadingCover);},onUpdateFail:function(){$(".loadingCover, .loadingBg").remove();},updateMiniHarrods:function(evt){evt.preventDefault();var $this=$(evt.target),child_id=Harrods.Mixins.getQueryString("childid"),invalid=true,ksinfo=[]
$(".new_k_info").each(function(i,v){var kgender,krelation,kfirstname,klastname,kdobd,kdobm,kdoby
if($(this).find("[ID$='drpChildGender'] option:selected").val()==''){alert('Please Select Gender');invalid=true}else{kgender=$(this).find("[ID$='drpChildGender'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildRelationship'] option:selected").val()==''){alert('Please Select Relationship');invalid=true}else{krelation=$(this).find("[ID$='drpChildRelationship'] option:selected").val()
invalid=false}
if($(this).find("[ID$='txtChildFirstName']").val()==''){alert('Please Enter Child\'s first name');invalid=true}else{kfirstname=$(this).find("[ID$='txtChildFirstName']").val()
invalid=false}
if($(this).find("[ID$='txtChildSurname']").val()==''){alert('Please Enter Child\'s last name');invalid=true}else{klastname=$(this).find("[ID$='txtChildSurname']").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBDay'] option:selected").val()==''){alert('Please Enter a birthday day');invalid=true}else{kdobd=$(this).find("[ID$='drpChildDOBDay'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBMonth'] option:selected").val()==''){alert('Please Enter a birthday month');invalid=true}else{kdobm=$(this).find("[ID$='drpChildDOBMonth'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBYear'] option:selected").val()==''){alert('Please Enter a birthday year');invalid=true}else{kdoby=$(this).find("[ID$='drpChildDOBYear'] option:selected").val()
invalid=false}
ksinfo.push({"Gender":kgender,"KCRelationshipField":krelation,"FirstName":kfirstname,"Surname":klastname,"DateOfBirthDay":kdobd,"DateOfBirthMonth":kdobm,"DateOfBirthYear":kdoby,"CustomerId":child_id})})
if(invalid==false){this.addLoader($(".right_column"));var o=this
$.ajax({url:'/UIServices/Account/LoyaltyService.svc/UpdateAssociatedAccount',dataType:'json',contentType:'application/json;charset=utf-8',type:"POST",data:JSON.stringify({associatedAccount:ksinfo}),success:function(data){if(data.d.isValid==true){window.location="/account/manage-mini-harrods"}else{alert(data.d.errorMessage);o.onUpdateFail();}}});}},removeChild:function(evt){this.addLoader($(".right_column"));var $this=$(evt.target),child_id=$this.parents('.address_box ').attr('rel')
var o=this
$.ajax({url:'/UIServices/Account/LoyaltyService.svc/RemoveAssociatedAccount',dataType:'json',contentType:'application/json;charset=utf-8',type:"POST",data:JSON.stringify({associatedAccountId:child_id}),success:function(data){if(data.d.isValid==true){window.location="/account/manage-mini-harrods";}else{alert('Error: Please try again!');o.onUpdateFail();}}});},onChildSelect:function(evt){var $this=$(evt.target),child_no=$this.find('option:selected').val(),child_name=$this.find('option:selected').text()
$("[ID$='txtRewardsCardNumber']").text(child_no)
$("[ID$='txtChildName']").text(child_name)},joinMiniHarrods:function(evt){evt.preventDefault();var invalid=true,ksinfo=[]
$(".new_k_info").each(function(i,v){var kgender,krelation,kfirstname,klastname,kdobd,kdobm,kdoby,ktcs,kresponsible
if($(this).find("[ID$='drpChildGender'] option:selected").val()==''){alert('Please Select Gender');invalid=true}else{kgender=$(this).find("[ID$='drpChildGender'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildRelationship'] option:selected").val()==''){alert('Please Select Relationship');invalid=true}else{krelation=$(this).find("[ID$='drpChildRelationship'] option:selected").val()
invalid=false}
if($(this).find("[ID$='txtChildFirstName']").val()==''){alert('Please Enter Child\'s first name');invalid=true}else{kfirstname=$(this).find("[ID$='txtChildFirstName']").val()
invalid=false}
if($(this).find("[ID$='txtChildSurname']").val()==''){alert('Please Enter Child\'s last name');invalid=true}else{klastname=$(this).find("[ID$='txtChildSurname']").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBDay'] option:selected").val()==''){alert('Please Enter a birthday day');invalid=true}else{kdobd=$(this).find("[ID$='drpChildDOBDay'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBMonth'] option:selected").val()==''){alert('Please Enter a birthday month');invalid=true}else{kdobm=$(this).find("[ID$='drpChildDOBMonth'] option:selected").val()
invalid=false}
if($(this).find("[ID$='drpChildDOBYear'] option:selected").val()==''){alert('Please Enter a birthday year');invalid=true}else{kdoby=$(this).find("[ID$='drpChildDOBYear'] option:selected").val()
invalid=false}
if($("[ID$='chkIamParent']").is(':checked')==false){alert('Please confirm you are the parent or legal guardian for the above child(ren)');invalid=true}else{ktcs=true
invalid=false}
if($("[ID$='chkAcceptTsAndCs']").is(':checked')==false){alert('Please accept the Terms and Conditions of Mini Harrods');invalid=true}else{kresponsible=true
invalid=false}
ksinfo.push({"Gender":kgender,"KCRelationshipField":krelation,"FirstName":kfirstname,"Surname":klastname,"DateOfBirthDay":kdobd,"DateOfBirthMonth":kdobm,"DateOfBirthYear":kdoby,"TCs":ktcs,"isKCResponsible":kresponsible})})
if(invalid==false){this.addLoader($(".right_column"));var o=this
$.ajax({url:'/UIServices/Account/LoyaltyService.svc/AddAssociatedAccounts',dataType:'json',contentType:'application/json;charset=utf-8',type:"POST",data:JSON.stringify({associatedAccounts:ksinfo}),success:function(data){if(data.d.isValid==true){window.location="/account/print-mini-harrods"}else{alert(data.d.errorMessage);o.onUpdateFail();}}});}},addOtherChild:function(evt){evt.preventDefault();if($(".new_k_info").length==10){alert('A maximum of 10 children can be added. Please contact the Rewards team to add additional children');}else{$(evt.target).before($(".new_k_info:first").clone())
$(".new_k_info:last").find('input:text').val('').end().append('<a href="#" class="cancel_minik black_button_s">Cancel <span>&raquo;</span></a>')}}}));Hrd.define('Harrods.Modal',Hrd.extend({$modal:{},_isover:false,_config:{ajax:false,content:null},init:function(config){Hrd.apply(this._config,config);this.$target=$(this._config.target);this.$content=this._config.content.clone().attr('id','currentBlock');var new_class=this.$target.attr("id");this.$modal=$(Harrods.Templates.toolmodal).addClass(new_class).appendTo('#tools')
this.$modal.append(this.$content);this.$content.show();this.$modal.css({'opacity':0}).fadeTo(1000,1,'easeOutQuart');this.setSize();if(!this._isIpad){this.$modal.find('.close').bind('click',$.proxy(this.close,this));this.$modal.on('mouseleave',$.proxy(this.onout,this));this.$target.on('mouseleave',$.proxy(this.onout,this));this.$modal.on('mouseover',$.proxy(this.onover,this));this.$target.on('mouseover',$.proxy(this.onover,this));}else{$('body').on('touchstart.harrods.modal',$.proxy(this.closeIpad,this));}
this.$target.addClass("active");},setSize:function(){var right=this.$target.width(),top=($(window).height()-this.$modal.height())*.5;this.$modal.css({right:right+'px'});},close:function(){var _self=this;this.unbind();this.$target.removeClass("active");this.$modal.fadeTo(1000,0,'easeOutCirc',function(){$(this).remove();});},closeIpad:function(evt){if(!$(evt.target).parents('.tool-block').length){this.unbind();this.$target.removeClass("active");this.$modal.fadeTo(500,0,'easeOutCirc',function(){$(this).remove();});}},unbind:function(){this.$modal.off('mouseleave mouseover');this.$target.off('mouseleave mouseover');$('body').off('touchstart.harrods.modal');},onover:function(){this._isover=true;},onout:function(){var _self=this;this._isover=false;setTimeout(function(){if(!_self._isover){_self.close();}},300);}}));Hrd.define('Harrods.MyAccount',Hrd.extend({_loader:'<img src="/new_images/zoomloader.gif" class="small_loader" alt="Loading ..." />',_personalDetails:{},_loginDetails:{},init:function(config){Hrd.apply(this._config,config);this.listHightlight();this.addDatePikerTransac();$(".save_personal_details").on('click',$.proxy(this.saveDetails,this));$("[ID$='change_user_password']").on('click',$.proxy(this.changePW,this));$(".openHistoryDetails").on('click',$.proxy(this.openHistoryDetails,this));$("[ID$='btnJoinRewards']").on('click',$.proxy(this.joinRewards,this));$(".save_preferences").on('click',$.proxy(this.savePreferences,this));$('.user_titles').change(function(){if($(this).val()=="MR"){$("[ID$='drpUserGender']").val("M");}else if($(this).val()=="DOCTOR"){$("[ID$='drpUserGender']").val("")}else{$("[ID$='drpUserGender']").val("F")}});$('.radioWork').click(function(){$("[ID$='radPersonal']").attr('checked',false);return false;});$('.radioPersonal').click(function(){$("[ID$='radWork']").attr('checked',false);return false;});var smsErorrMsg="<tr class='tr_erorr'><td colspan='3'><b>Please enter your mobile number at the top of the page.</b></td></tr>",mailErorrMsg="<tr class='tr_erorr'><td colspan='3'><b>No address currently selected. Please select/add an address above.</b></td></tr>";$(".myaccount_personal_preferences input:checkbox").click(function(){$(".tr_erorr").remove();if($(this).attr("id").indexOf("SMS")!=-1&&$(this).is(":checked")){if($("[ID$='radPersonal']").is(":checked")&&$("[ID$='txtPersonalMobilePhoneNumber']").val()==""){$(this).parents("tr").before(smsErorrMsg);}else if($("[ID$='radWork']").is(":checked")&&$("[ID$='txtWorkMobilePhoneNumber']").val()==""){$(this).parents("tr").before(smsErorrMsg);}}
if($(this).attr("id").indexOf("DirectMail")!=-1&&$(this).is(":checked")&&($("[ID$='drpAddresses'] option:selected").val()=="Please Select"||$("[ID$='txtWorkMobilePhoneNumber']").val()==undefined)){$(this).parents("tr").before(mailErorrMsg);}})
var _self=this
$("[ID$='ddlLasrTwelveMonthsList']").change(function(){_self.filterArticlesByMonth();return false;})
this.addChangeDatepicker();this.requestRedemption();$(".request_new_card").click(function(){$(".new_rcard_main").slideUp("fast",function(){$(".new_card_confirm").slideDown();});})
$(".new_card_confirm .cancel").click(function(){$(".new_card_confirm").slideUp("fast",function(){$(".new_rcard_main").slideDown();});})
if(typeof availableDates!="undefined"){var dpick3ops={formElements:{"req_10_dates":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,enabledDates:{},noDrag:true,callbackFunctions:{"dateset":[callBackOne]}}
for(var k in availableDates){var availdates=availableDates[k];dpick3ops.enabledDates[availdates]=1;}
datePickerController.createDatePicker(dpick3ops);}
$(".fakebt").click(function(){datePickerController.show($(this).children('input').attr('id'));})
function callBackOne(argObj){var spn=document.getElementById("dateToShow"),formattedDate=datePickerController.printFormattedDate(argObj.date,"d-sl-m-sl-Y",false);while(spn.firstChild)spn.removeChild(spn.firstChild);spn.appendChild(document.createTextNode(formattedDate));if($("#dateToShow").text()!=""){$("#req_10_confirmation").show("slow",function(){$("#req_10_confirmation").focus();});}}
$(".req_10_confir_bt").click(function(){__doPostBack('ctl00$ContentPlaceHolder1$btnAddNew',$("#dateToShow").text());return false;})
$("#req_10_confirmation .cancel").click(function(){$("#dateToShow").text("");$("#req_10_confirmation").hide();return false;})
var personalMobilePhoneNumber=$("[ID$='txtPersonalMobilePhoneNumber']").val();var workMobilePhoneNumber=$("[ID$='txtWorkMobilePhoneNumber']").val();$('#btnPrintBottom, #btnPrintTop').click(function(){_self.printForm("divPrint");return false;})},savePreferences:function(evt){evt.preventDefault();var invalid="false",mobileNumberRequired=false,addressRequired=false
$(".to_from li").removeClass("error");$(".error_c").remove();$(".myaccount_personal_preferences input:checkbox").each(function(){if($(this).attr("id").indexOf("SMS")!=-1&&$(this).is(":checked")){mobileNumberRequired=true;}else if($(this).attr("id").indexOf("DirectMail")!=-1&$(this).is(":checked")){addressRequired=true;}})
var contactDetails={},personalMobileCountyCode=$("[ID$='drpPersonalMobileCountryCode']").val(),personalMobilePhoneNumber=$("[ID$='txtPersonalMobilePhoneNumber']").val(),workMobileCountyCode=$("[ID$='drpWorkMobileCountryCode']").val(),workMobilePhoneNumber=$("[ID$='txtWorkMobilePhoneNumber']").val(),selectedAddressId=$("[ID$='drpAddresses'] option:selected").val(),selectedSmsNumber="personal"
if($("[ID$='radWork']").attr('checked')){selectedSmsNumber="work"}
var targetOffset=$('h1').offset().top;if(mobileNumberRequired&&personalMobilePhoneNumber==""&&workMobilePhoneNumber==""){invalid="true";$('html,body').animate({scrollTop:targetOffset},"slow");$("[ID$='txtPersonalMobilePhoneNumber']").parent("li").before('<li class="error_c"><p class="error">Please enter a mobile number to receive SMS messages</p></li>').addClass('error');}else if(mobileNumberRequired&&selectedSmsNumber=="personal"&&personalMobilePhoneNumber==""){$('html,body').animate({scrollTop:targetOffset},"slow");$("[ID$='txtPersonalMobilePhoneNumber']").parent("li").before('<li class="error_c"><p class="error">Home mobile number required</p></li>').addClass('error');invalid="true";}else if(mobileNumberRequired&&selectedSmsNumber=="work"&&workMobilePhoneNumber==""){$('html,body').animate({scrollTop:targetOffset},"slow");$("[ID$='txtWorkMobilePhoneNumber']").parent("li").before('<li class="error_c"><p class="error">Work mobile number required</p></li>').addClass('error');invalid="true";}
if(personalMobilePhoneNumber!=""){if(!/^([0-9]*[1-9][0-9]*)$/.test(personalMobilePhoneNumber)||personalMobilePhoneNumber.length<6){$('html,body').animate({scrollTop:targetOffset},"slow");invalid="true";$("[ID$='txtPersonalMobilePhoneNumber']").before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}}
if(workMobilePhoneNumber!=""){if(!/^([0-9]*[1-9][0-9]*)$/.test(workMobilePhoneNumber)||workMobilePhoneNumber.length<6){$('html,body').animate({scrollTop:targetOffset},"slow");invalid="true";$("[ID$='txtWorkMobilePhoneNumber']").before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}}
if(addressRequired&&selectedAddressId==undefined){$('html,body').animate({scrollTop:targetOffset},"slow");invalid="true";$(".address_title").parent("li").before('<li class="error_c"><p class="error">Please add an address to receive updates via post</p></li>');}
if(addressRequired&&selectedAddressId=="Please Select"){$('html,body').animate({scrollTop:targetOffset},"slow");invalid="true";$("[ID$='drpAddresses']").parent("li").before('<li class="error_c"><p class="error">Please select an address to receive updates via post</p></li>').addClass('error');}
if(invalid=="false"){personalMobilePhoneId=$("[ID$='hidPersonalMobilePhoneId']").val();workMobilePhoneId=$("[ID$='hidWorkMobilePhoneId']").val();if(selectedAddressId==undefined){selectedAddressId="";}
var _self=this
$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AccountService.svc/UpdateCommunicationPreferencesContactDetails",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({personalMobilePhoneId:personalMobilePhoneId,personalMobileCounrtyCode:personalMobileCountyCode,personalMobileNumber:personalMobilePhoneNumber,workMobilePhoneId:workMobilePhoneId,workMobileCounrtyCode:workMobileCountyCode,workMobileNumber:workMobilePhoneNumber,addressId:selectedAddressId,smsNumber:selectedSmsNumber,mobileNumberRequired:mobileNumberRequired,addressRequired:addressRequired}),success:function(data){$.proxy(_self.onSavePreferencesContactDetails(data),_self)},error:function(data){$.proxy(_self.onUpdateFail(data),_self)}});}},onSavePreferencesContactDetails:function(response){var _self=this,a1=[],a2=[]
if(response.d.isValid&&response.d.entityData!=null){var dcpAddressId=$("[ID$='drpAddresses'] option:selected").val();if(dcpAddressId==undefined){dcpAddressId="";}
var selectedNumber="personal";if($("[ID$='radWork']").attr('checked')){selectedNumber="work";}
$(".myaccount_personal_preferences").find("input:checkbox:enabled").each(function(){var rewardsPref={};rewardsPref.StringValue=$(this).attr('id');rewardsPref.BooleanValue=$(this).is(':checked');a1.push(rewardsPref)})
$(".preferences_interests").find("input:checkbox:enabled").each(function(){var rewardsInter={};rewardsInter.StringValue=$(this).attr('id');rewardsInter.BooleanValue=$(this).is(':checked');a2.push(rewardsInter)})
var _self=this
$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AccountService.svc/UpdatePreferences",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({selectedSmsPhoneNumberType:selectedNumber,selectedDcpAddressId:dcpAddressId,preferenceUpdates:a1}),success:function(data){$.proxy(_self.onSavePersonalDetails(data),_self)}});var _self=this
$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AccountService.svc/UpdateInterests",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({interestUpdates:a2}),success:function(data){$.proxy(_self.onSavePersonalDetails(data),_self)}});}else{var errMsg=response.d.errorMessage;var ifbroken=false;if(response.d.errors!=null){$.each(response.d.errors,function(key,val){errMsg=errMsg+'<br />'+val.Value;});}
if(ifbroken==false){_self.showMessage("msgboxError",errMsg);}}},onSavePersonalDetails:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){window.location="/account";}else{var errMsg=response.d.errorMessage;var ifbroken=false;if(response.d.errors!=null){$.each(response.d.errors,function(key,val){errMsg=errMsg+'<br />'+val.Value;});}
if(ifbroken==false){_self.showMessage("msgboxError",errMsg);}}},joinRewards:function(){var invalid="false",message="";$(".to_from li").removeClass("error");$(".error_c").remove();var acceptTsAndCs=$("[ID$='chkAcceptTsAndCs']");if(acceptTsAndCs.is(":checked")!=true){invalid="true";message="Please accept the Terms and Conditions";acceptTsAndCs.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
if($("[ID$='hidPersonalDetailsIsValid']").val()=="false"){invalid="true";message="You need to update your personal details before continuing";var personalDetailsButton=$('.edit_personal_details_button');personalDetailsButton.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
if($("[ID$='hidAddressDetailsIsValid']").val()=="false"){invalid="true";message="You need to update your address details before continuing";var addressDetailsButton=$('.hidAddressDetailsIsValid');addressDetailsButton.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
var rewardsCardNumber=$("[ID$='txtRewardsCardNumber']");if($("input[@name='rewardcardoption']:checked").val()=="haverewardcard"){if(rewardsCardNumber.val()==""){invalid="true";message="Reward card number is required";rewardsCardNumber.parents('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
else{var rewardReg=/^\d{16}$/;if(!rewardReg.test(rewardsCardNumber.val())){invalid="true";message="Reward card number is Incorrect";rewardsCardNumber.parents('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}}}else{rewardsCardNumber.val("");}
if(invalid=="false"){return true;}else{return false;}},openHistoryDetails:function(evt){var e=$(evt.target)
if(!e.parents('tr').hasClass('active')){e.parents('tr').addClass('active').next('tr.historyDetailsTbl').toggle();e.addClass('tr_expand').html('<span>Hide</span>');}else{e.parents('tr').removeClass('active').next('tr.historyDetailsTbl').toggle();e.removeClass('tr_expand').addClass('tr_hide').html('<span>Expand</span>');}
return false;},listHightlight:function(){$('.login_f li input, .unsigned_f li input, .to_from li input, .to_from li select').focus(function(){if($(this).attr('id')!='payment_startdate_year'&&$(this).attr('id')!='payment_expirydate_year'){$('.login_f li, .unsigned_f li, .to_from li').removeClass('active');$(this).parent('li').addClass('active');}});},saveDetails:function(){var invalid="false";$(".to_from li").removeClass("error");$(".error_c").remove();if($("[ID$='txtFirstName']").val()==undefined){this._personalDetails.UserTitle=$("[ID$='HiddenTitle']").val();this._personalDetails.FirstName=$("[ID$='HiddenFirstname']").val();this._personalDetails.LastName=$("[ID$='HiddenSurname']").val();this._personalDetails.CompanyName="";}
else{this._personalDetails.UserTitle=$("[ID$='_drpUserTitle']").val();if(this._personalDetails.UserTitle=="NONESPECIFIED"){invalid="true";$("[ID$='_drpUserTitle']").parent("li").before('<li class="error_c"><p class="error">Please select a title</p></li>').addClass('error');}
this._personalDetails.FirstName=$("[ID$='txtFirstName']").val();if(this._personalDetails.FirstName==""){invalid="true";$("[ID$='txtFirstName']").parent("li").before('<li class="error_c"><p class="error">Please enter a first name</p></li>').addClass('error');}
this._personalDetails.LastName=$("[ID$='txtLastName']").val();if(this._personalDetails.LastName==""){invalid="true";$("[ID$='txtLastName']").parent("li").before('<li class="error_c"><p class="error">Please enter a last name</p></li>').addClass('error');}
this._personalDetails.CompanyName=$("[ID$='txtCompanyName']").val();}
this._personalDetails.EmailAddress=$("[ID$='txtEmail']").val();var emailReg=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;if(this._personalDetails.EmailAddress==""){invalid="true";$("[ID$='txtEmail']").parent("li").before('<li class="error_c"><p class="error">Please enter an Email address</p></li>').addClass('error');}else if(!emailReg.test(this._personalDetails.EmailAddress)){invalid="true";$("[ID$='txtEmail']").parent("li").before('<li class="error_c"><p class="error">Please enter a valid email</p></li>').addClass('error');}
this._personalDetails.ConfirmEmailAddress=$("[ID$='txtConfirmEmail']").val();if(this._personalDetails.ConfirmEmailAddress==""){invalid="true";$("[ID$='txtConfirmEmail']").parent("li").before('<li class="error_c"><p class="error">Please enter an Email address</p></li>').addClass('error');}else if(!emailReg.test(this._personalDetails.ConfirmEmailAddress)){invalid="true";$("[ID$='txtConfirmEmail']").parent("li").before('<li class="error_c"><p class="error">Please enter a valid email</p></li>').addClass('error');}else if(this._personalDetails.ConfirmEmailAddress!=this._personalDetails.EmailAddress){invalid="true";$("[ID$='txtConfirmEmail']").parent("li").before('<li class="error_c"><p class="error">Emails are not the same</p></li>').addClass('error');}
this._personalDetails.Gender=$("[ID$='drpUserGender']").val();this._personalDetails.DobDay=$("[ID$='drpUserDOBDay']").val();this._personalDetails.DobMonth=$("[ID$='drpUserDOBMonth']").val();this._personalDetails.DobYear=$("[ID$='drpUserDOBYear']").val();if(this._personalDetails.DobDay!=""&&this._personalDetails.DobMonth==""){invalid="true";$("[ID$='drpUserDOBDay']").parent("li").before('<li class="error_c"><p class="error">Please select a month</p></li>').addClass('error');}
if(this._personalDetails.DobMonth==2&&this._personalDetails.DobDay>29){invalid="true";$("[ID$='drpUserDOBDay']").parent("li").before('<li class="error_c"><p class="error">Day can not be more than 29</p></li>').addClass('error');}else if(/^4|6|9|11$/.test(this._personalDetails.DobMonth)&&this._personalDetails.DobDay>30){invalid="true";$("[ID$='drpUserDOBDay']").parent("li").before('<li class="error_c"><p class="error">Day can not be more than 30</p></li>').addClass('error');}
this._personalDetails.PersonalLandlineCountyCode=$("[ID$='drpPersonalLandlineCountryCode']").val();this._personalDetails.PersonalLandlinePhoneNumber=$("[ID$='txtPersonalLandlinePhoneNumber']").val();if(this._personalDetails.PersonalLandlinePhoneNumber!=""&&this._personalDetails.PersonalLandlineCountyCode==""){invalid="true";$("[ID$='txtPersonalLandlinePhoneNumber']").parent("li").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
this._personalDetails.WorkLandlineCountyCode=$("[ID$='drpWorkLandlineCountryCode']").val();this._personalDetails.WorkLandlinePhoneNumber=$("[ID$='txtWorkLandlinePhoneNumber']").val();if(this._personalDetails.WorkLandlinePhoneNumber!=""&&this._personalDetails.WorkLandlineCountyCode==""){invalid="true";$("[ID$='txtWorkLandlinePhoneNumber']").parent("li").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
this._personalDetails.PersonalMobileCountyCode=$("[ID$='drpPersonalMobileCountryCode']").val();this._personalDetails.PersonalMobilePhoneNumber=$("[ID$='txtPersonalMobilePhoneNumber']").val();if(this._personalDetails.PersonalMobilePhoneNumber!=""&&this._personalDetails.PersonalMobileCountyCode==""){invalid="true";$("[ID$='txtPersonalMobilePhoneNumber']").parent("li").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
this._personalDetails.WorkMobileCountyCode=$("[ID$='drpWorkMobileCountryCode']").val();this._personalDetails.WorkMobilePhoneNumber=$("[ID$='txtWorkMobilePhoneNumber']").val();if(this._personalDetails.WorkMobilePhoneNumber!=""&&this._personalDetails.WorkMobileCountyCode==""){invalid="true";$("[ID$='txtWorkMobilePhoneNumber']").parent("li").before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
if(invalid=="false"){this.addLoader($(".right_column"));var _self=this
$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AccountService.svc/ChangePersonalDetails",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"personalDetails":this._personalDetails}),success:function(data){$.proxy(_self.onUpdate(data),_self)},error:function(data){$.proxy(_self.onUpdateFail(data),_self)}});}
else{this.showMessage("msgboxValidation",'Please correct/complete highlighted fields below');}},onUpdateFail:function(){var errMsg='There was a problem with the server - please try again'
$(".loadingCover, .loadingBg").remove();this.showMessage("msgboxError",errMsg);},onUpdate:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){$(".loadingCover, .loadingBg").remove();window.location="/account";}},addLoader:function(theparent){var loadingCover=$("<div class='loadingCover'></div>"),loadingBg=$("<div class='loadingBg'></div>")
loadingCover.height(theparent.height()).width(theparent.width()+10)
loadingBg.height(theparent.height()).width(theparent.width()+10)
theparent.prepend(loadingBg).prepend(loadingCover);},removeErrorMessages:function(){$("li.error, div.error, li.error_c").removeClass('error');$("li.error_c").empty().hide();$('#MessageBox').empty().removeClass();},showMessage:function(type,message){$('#MessageBox').empty().removeClass().html(message).addClass(type).show("slow");},changePW:function(){var _self=this;$(".to_from li").removeClass("error");$(".error_c").remove();var invalid="false";var currentPassword=$("[ID$='CurrentPassword']");var newPassword=$("[ID$='1_NewPassword']");var newConfirmPassword=$("[ID$='ConfirmNewPassword']");var passReg=/^.*(?=.{6,})(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*$/;if(currentPassword.val()==""){invalid="true";currentPassword.parent("li").before('<li class="error_c"><p class="error">Please enter a Current password</p></li>').addClass('error');}
if(newPassword.val()==""){invalid="true";newPassword.parent("li").before('<li class="error_c"><p class="error">Please enter a New password</p></li>').addClass('error');}
else{if($.trim(newPassword.val())!=''&&!passReg.test(newPassword.val())){invalid="true";newPassword.parent("li").before('<li class="error_c"><p class="error">New password is invalid</p></li>').addClass('error');}}
if(newConfirmPassword.val()==""){invalid="true";newConfirmPassword.parent("li").before('<li class="error_c"><p class="error">Please Re-type the New password</p></li>').addClass('error');}
else{if(newPassword.val()!=""){if(newPassword.val()!=newConfirmPassword.val()){invalid="true";newConfirmPassword.parent("li").before('<li class="error_c"><p class="error">New password and Confirm password do not match</p></li>').addClass('error');}}}
if(invalid=="false"){this._loginDetails.PasswordCurrent=currentPassword.val();this._loginDetails.PasswordNew=newPassword.val();this._loginDetails.PasswordConfirm=newConfirmPassword.val();this._loginDetails.EmailCurrent='';this._loginDetails.EmailNew='';this._loginDetails.Question='';this._loginDetails.Answer='';this._loginDetails.AnswerConfirm='';this._loginDetails.AcceptTsAndCs=true;$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AccountService.svc/ChangePassword",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"loginDetails":this._loginDetails}),success:function(data){$.proxy(_self.onChangePassword(data),_self)}});}
return false;},onChangePassword:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){window.location="/account";}else{var errMsg=response.d.errorMessage;var ifbroken=false;if(response.d.errors!=null){$.each(response.d.errors,function(key,val){errMsg=errMsg+'<br />'+val.Value;});}
if(ifbroken==false){_self.showMessage("msgboxError",errMsg);}}},showMessage:function(type,message){$('#MessageBox').empty().removeClass();$('#MessageBox').html(message).addClass(type).show("slow");},addDatePikerTransac:function(){Date.fromUKFormat=function(sUK){var A=sUK.split(/[\\\/]/);A=[A[1],A[0],A[2]];return new Date(Date.parse(A.join('/')));}
var mydate=new Date();var year=mydate.getFullYear();var month=mydate.getMonth()+1;if(month<10){month='0'+month;}
var day=mydate.getDate();if(day<10){day='0'+day;}
var todayis=year+""+month+""+day;mydate.setDate(mydate.getDate()-1);var theyear=mydate.getFullYear();var themonth=mydate.getMonth()+1;if(themonth<10){themonth='0'+themonth;}
var theday=mydate.getDate();if(theday<10){theday='0'+theday;}
var theyesterday=theyear+""+themonth+""+theday;mydate.setMonth(mydate.getMonth()-6)
var theyear2=mydate.getFullYear();var themonth2=mydate.getMonth()+1;if(themonth2<10){themonth2='0'+themonth2;}
var theday2=mydate.getDate();if(theday2<10){theday2='0'+theday2;}
var sixmonthsearly=theyear2+""+themonth2+""+theday2;mydate.setMonth(mydate.getMonth()+4)
var theyear3=mydate.getFullYear();var themonth3=mydate.getMonth()+1;if(themonth3<10){themonth3='0'+themonth3;}
var theday3=mydate.getDate();if(theday3<10){theday3='0'+theday3;}
var twomonthsearly=theyear3+""+themonth3+""+theday3;var dpick1ops={formElements:{"ctl00_ContentPlaceHolder1_txtDateFrom":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:"20070101",rangeHigh:theyesterday,cursorDate:sixmonthsearly}
var dpick2ops={formElements:{"ctl00_ContentPlaceHolder1_txtDateTo":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:"20070101",rangeHigh:theyesterday,cursorDate:theyesterday}
var dpick3ops={formElements:{"ctl00_ContentPlaceHolder1_transDate":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:twomonthsearly,rangeHigh:theyesterday,cursorDate:theyesterday}
var dpick4ops={formElements:{"ctl00_ContentPlaceHolder1_txtDateToIns":"d-sl-m-sl-Y"},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,rangeLow:"20070101",rangeHigh:todayis,cursorDate:todayis}
datePickerController.createDatePicker(dpick1ops);datePickerController.createDatePicker(dpick2ops);datePickerController.createDatePicker(dpick3ops);datePickerController.createDatePicker(dpick4ops);var fromDate=$("[ID$='txtDateFrom']");var dateTo=$("[ID$='txtDateTo']");var dateToIns=$("[ID$='txtDateToIns']");var transDate=$("[ID$='transDate']");if(fromDate.val()==''||fromDate.val()=='222'){fromDate.val(theday2+"/"+themonth2+"/"+theyear2)}
if(dateTo.val()==''||dateTo.val()=='222'){dateTo.val(theday+"/"+themonth+"/"+theyear);}
if(transDate.val()==''||transDate.val()=='222'){transDate.val(theday+"/"+themonth+"/"+theyear);}
if(dateToIns.val()==''||dateToIns.val()=='222'){dateToIns.val(day+"/"+month+"/"+year);}
$("[ID$='btnSearchTransactions']").click(function(){$(".to_from li").removeClass("error");$(".error_c").remove();var isValid=true;var fromDate=$("[ID$='txtDateFrom']");var dateTo=$("[ID$='txtDateTo']");var reDate=/(?:0[1-9]|[12][0-9]|3[01])\/(?:0[1-9]|1[0-2])\/(?:19|20\d{2})/;if(!reDate.test(fromDate.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid from" date</p></li>');}
if(!reDate.test(dateTo.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid to" date</p></li>');}
if(isValid){if(Date.fromUKFormat(fromDate.val())<Date.fromUKFormat("01/01/2007")){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only display transactions from 2007 onwards</p></li>');isValid=false;}
if(Date.fromUKFormat(dateTo.val())>Date.fromUKFormat(theday+"/"+themonth+"/"+theyear)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only display transactions up to yesterday\'s date</p></li>');isValid=false;}
if(Date.fromUKFormat(fromDate.val())>Date.fromUKFormat(dateTo.val())){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, this date range is invalid. Please enter valid dates</p></li>');isValid=false;}}
return isValid;})
$("[ID$='btnSearchIncidents']").click(function(){$(".error_c").remove();var postbackid=$(this).attr('id').replace(/_/g,"$");var isValid=true;var fromDate=$("[ID$='txtDateFrom']");var dateToIns=$("[ID$='txtDateToIns']");var reDate=/(?:0[1-9]|[12][0-9]|3[01])\/(?:0[1-9]|1[0-2])\/(?:19|20\d{2})/;if(!reDate.test(fromDate.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid from" date</p></li>');}
if(!reDate.test(dateToIns.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid to" date</p></li>');}
if(isValid){if(Date.fromUKFormat(fromDate.val())<Date.fromUKFormat("01/01/2007")){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry we can only display Incidents from 2007 onwards</p></li>');isValid=false;}else if(Date.fromUKFormat(dateToIns.val())>Date.fromUKFormat(day+"/"+month+"/"+year)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry we can only display Incidents up to today\'s date</p></li>');isValid=false;}else if(Date.fromUKFormat(fromDate.val())>Date.fromUKFormat(dateToIns.val())){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, this date range is invalid. Please enter valid dates</p></li>');isValid=false;}else{__doPostBack(postbackid,fromDate.val()+'|'+dateToIns.val());}}
return false;})
$("[ID$='btnRequestPoints']").click(function(){$(".to_from li").removeClass("error");$(".error_c").remove();var postbackid=$(this).attr('id').replace(/_/g,"$");var isValid=true;var transDate=$("[ID$='transDate']");var message="";var assistantId=$("[ID$='txtAssistantId']");var reDate=/(?:0[1-9]|[12][0-9]|3[01])\/(?:0[1-9]|1[0-2])\/(?:19|20\d{2})/;if(!reDate.test(transDate.val())){isValid=false;$('.datesErrorsUL').append('<li class="error_c"><p class="error">Please enter a "Valid from" date</p></li>');}else if(Date.fromUKFormat(transDate.val())<Date.fromUKFormat(theday3+"/"+themonth3+"/"+theyear3)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only add Rewards points for transactions up to two months after the transaction date.</p></li>');isValid=false;}else if(Date.fromUKFormat(transDate.val())>Date.fromUKFormat(theday+"/"+themonth+"/"+theyear)){$('.datesErrorsUL').append('<li class="error_c"><p class="error">Sorry, we can only add Rewards points on transactions up to yesterday\'s date.  Please try again tomorrow</p></li>');isValid=false;}
if(assistantId.val()==""){isValid=false;message="Assistant number is required";assistantId.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(isNaN(assistantId.val())){isValid=false;message="Assistant number is invalid";assistantId.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
var transactionNumber1=$("[ID$='txtTransNumberPart1']");var tranInvalid="false";if(transactionNumber1.val()==""){isValid=false;tranInvalid="true";message="Transaction number is incomplete";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(isNaN(transactionNumber1.val().toUpperCase().replace(/NT/g,''))){isValid=false;tranInvalid="true";message="Transaction number is invalid";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}
if(tranInvalid=="false"){var transactionNumber2=$("[ID$='txtTransNumberPart2']");if(transactionNumber2.val()==""){isValid=false;message="Transaction number is incomplete";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(isNaN(transactionNumber2.val())){isValid=false;message="Transaction number is invalid";transactionNumber1.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}}
if(isValid==true){__doPostBack(postbackid,transDate.val());}else{return false;}
return false;})
$(".info_hover").hover(function(){$(".retro_points_info").remove();var wrapper=$("<span>");var thealt=$(this).attr("alt");var thistop=($(this).offset().top)-150;var thisleft=516;wrapper.addClass("retro_points_info").text(thealt)
$(this).parents("ul").before(wrapper);$(".retro_points_info").css({top:thistop,left:thisleft}).fadeIn();},function(){$(".retro_points_info").remove();});},renderNameDisplay:function(){var userNames=[];if($("[ID$='ddlRewardsMember']").length>0){userNames=String($("[ID$='ddlRewardsMember']").val()).split(':');}else{userNames=String($("[ID$='hidVaues']").val()).split(':');}
if($("[ID$='ddlReason']").val()!="NameChange"){$(".name_line_1").text(userNames[1]);$(".name_line_2").text(userNames[2]);}
else{$(".name_line_1").text(userNames[3]);$(".name_line_2").text(userNames[4]);}
if($("[ID$='hidLoggedInID']").val()==userNames[0]){$(".logged_in_user").show();$(".non_logged_in_user").hide();}else{$(".logged_in_user").hide();$(".non_logged_in_user").show();}},filterArticlesByMonth:function(){var selectedMonth=$("[ID$='ddlLasrTwelveMonthsList']").val();$('.article').each(function(){if(!$(this).hasClass(selectedMonth)){$(this).hide();}else{$(this).show();}})
return false;},requestRedemption:function(){$("[ID$='btnContinue']").click(function(){var message="";$(".to_from li").removeClass("error");$(".error_c").remove();var redemptionValue=$("[ID$='txtRedemptionValue']");var num=redemptionValue.val();var min_amount=$("[ID$='hidMinRedemptionAmount']").val();var max_amount=$("[ID$='hidMaxRedemptionAmount']").val();if($("[ID$='ddlRewardsMember']").length>0){var card_number=String($("[ID$='ddlRewardsMember']").val()).split(':')[1];}else{var card_number=$("[ID$='hidRewardsCardNumber']").val();}
var currentcash=$("[ID$='hidCurrentCashBallance']").val();if(num==''){message="You have not entered a value to credit onto your Rewards card.";redemptionValue.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(isNaN(num)){message="Please enter a valid amount.";redemptionValue.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(parseFloat(num)<parseFloat(min_amount)){message="The minimum amount you can credit onto your Rewards card is "+min_amount;redemptionValue.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(parseFloat(num)>parseFloat(max_amount)){message="The maximum amount you can credit onto your Rewards card is "+max_amount;redemptionValue.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(parseFloat(num)%5!=0){message="The redemption amount must be in multiples of £5.";redemptionValue.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else if(parseFloat(num)%5==0){$(".confirmation_msg .redemption_points").text(num*100);$(".confirmation_msg .redemption_card_number").text(card_number);$(".confirmation_msg .redemption_current_cash_ballance").text('£'+parseFloat(currentcash).toFixed(2));$(".confirmation_msg .redemption_new_cash_ballance").text('£'+(parseFloat(currentcash)+parseFloat(num)).toFixed(2));$(".newRedemptionRequest").hide();$(".confirmation_msg").show();}
return false;})
$(".new_redemption_cancel").click(function(){$(this).parents('.confirmation_msg').find('.redemption_points, .redemption_card_number, .redemption_current_cash_ballance, .redemption_new_cash_ballance').text('');$(this).parents('.confirmation_msg').hide();$(".newRedemptionRequest").show();return false;})
$("[ID$='btnAddNewRedemption']").click(function(){e.preventDefault();return true;})},addChangeDatepicker:function(){var inc2=1;$("[ID$='btnChange10PercentDay']").each(function(){$(this).parent('span').append('<input type="text" id="Change10PercentDay'+inc2+'" class="changedatepicker iedatepick" name="Change10PercentDay'+inc2+'" value="" />');inc2++;})
if($(".changedatepicker").length>0){$(".changedatepicker").each(function(){var opts={formElements:{},fillGrid:true,highlightDays:[0,0,0,0,0,0,0],noFadeEffect:true,finalOpacity:100,enabledDates:{},noDrag:true,callbackFunctions:{"dateset":[callBackFunc]}};var cavaildates=eval($(this).siblings("[ID$='btnChange10PercentDay']").attr('dates'));for(var k in cavaildates){var cavaildates1=cavaildates[k];opts.enabledDates[cavaildates1]=1;}
var theId=$(this).attr('id');opts.formElements[theId]="d-sl-m-sl-Y";datePickerController.createDatePicker(opts);})};$(".changefakebt").click(function(){datePickerController.show($(this).children('input').attr('id'));return false;})
$(".changefakebt a").click(function(){datePickerController.show($(this).siblings('input').attr('id'));return false;})
function callBackFunc(argObj){if(argObj.date!=null){var theClickedOne=$('#'+argObj.id);var actulaDate=theClickedOne.parents('tr').children('td:first').text();var newDate=datePickerController.printFormattedDate(argObj.date,"d-sl-m-sl-Y",false);var postbackid=theClickedOne.siblings('a').attr('id').replace(/_/g,"$");var uniqId=theClickedOne.parents('tr').attr('rel');$(".confirmation_msg .actual_date").text(actulaDate);$(".confirmation_msg .new_date").text(newDate);$(".confirmation_msg .change_date_confir_bt").data('args',[postbackid,newDate,uniqId]);$(".confirmation_msg").show("slow",function(){$(".confirmation_msg").focus();});}}
$(".confirmation_msg .cancel").click(function(){$(this).siblings('.actual_date, .new_date').text('');$(this).parent('.confirmation_msg').hide();return false;})
$(".confirmation_msg .change_date_confir_bt").click(function(){var theargs=$(this).data('args');__doPostBack(theargs[0],theargs[1]+'|'+theargs[2]);return false;});$(".cancel_msg .cancel").click(function(){$(this).siblings('.actual_date').text('');$(this).parent('.cancel_msg').hide();return false;});$(".cancel_msg .conf_bt").click(function(){var theargs=$(this).data('args');__doPostBack(theargs[0],theargs[1]);return false;});$("[ID$='btnCancel10PercentDay']").click(function(){var actulaDate=$(this).parents('tr').children('td:first').text();var uniqid=$(this).parents('tr').attr('rel');var postbackid=$(this).attr('id').replace(/_/g,"$");$(".cancel_msg .conf_bt").data('args',[postbackid,uniqid]);$(".cancel_msg .actual_date").text(actulaDate);$(".cancel_msg").show("slow",function(){$(".cancel_msg").focus();});return false;})},printForm:function(strid){$('#printSelectedPeriod').show()
var prtContent=document.getElementById(strid);var WinPrint=window.open('','','letf=0,top=0,width=630,height=420,toolbar=0,scrollbars=0,status=0');WinPrint.document.write('<html><head><title>Print</title>');WinPrint.document.write('<style type="text/css" media="print">#tblStatements{border-collapse: collapse}#tblStatements thead td{font-weight:bold;border:none!important}#tblStatements td{padding:5px 0 5px 0;border-bottom:1px solid #ccc}#tblStatements .bigborder td{border-bottom:3px solid #000!important}.black_button_s{display:none}#tblsStatements td p{margin-bottom:0px!important}</style>');WinPrint.document.write('</head><body>');WinPrint.document.write('<h2>Your Harrods Rewards Statement</h2>')
WinPrint.document.write(prtContent.innerHTML);WinPrint.document.write('</body></html>');WinPrint.document.close();WinPrint.focus();WinPrint.print();WinPrint.close();}}));Hrd.define('Harrods.Payment',Hrd.extend({_loader:'<img src="/new_images/zoomloader.gif" class="small_loader" alt="Loading ..." />',_payment:{},_address:{},_what_card:null,_what_billing_address:null,_addressId:"",_theCardId:"",init:function(config){Hrd.apply(this._config,config);$(".saved_billing_addresses").hide();$(".add_new_card").on('click',$.proxy(this.openCardForm,this));$('.cancel_add_address').on('click',$.proxy(this.closeCardForm,this));$('.bill_address #saved_address').on('click',$.proxy(this.useSavedAddress,this));$('.bill_address .custom_address').on('change',$.proxy(this.loadSavedAddress,this));$('.bill_address #custom_address').on('click',$.proxy(this.useCustomAddress,this));$(".remove_payment_cards").live("click",$.proxy(this.removeCard,this));$(".edit_payment_cards").live("click",$.proxy(this.editCard,this));this.listHightlight()
this.focusOnLoad()
$("#add_new_card").on('click',$.proxy(this.saveCardDetails,this));},editCard:function(evt){var _self=this;var $this=$(evt.target);var cardId=$this.parents("[ID$='CardItem']").attr("rel");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/PaymentCardService.svc/GetCard",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"cardId":cardId}),success:function(data){$.proxy(_self.onGetCardInfo(data),_self)}});_self._what_card="edit_card";_self._theCardId=$this.parents(".address_box").attr("rel");},onGetCardInfo:function(response){var _self=this;$('.bill_address_action, .cards_form, .bill_address').show();$("#saved_address").click();if(response.d.isValid&&null!=response.d.entityData){$.each(response.d.entityData,function(key,value){if($(".cards_form [ID$='"+key+"']")&&value!=null){if(key=='CardNumber'){var card_fst_4=value.substr(0,4);var card_lst_4=value.substr(12,15);$(".cards_form [ID$='"+key+"']").data('cnumber',value);$(".cards_form [ID$='"+key+"']").val(card_fst_4+" **** **** "+card_lst_4);}else{$(".cards_form [ID$='"+key+"']").val(value);}}});$("[ID$='AddressChoice']").val(response.d.entityData.BillingAddressId);$("[ID$='AddressChoice']").change();$("[ID$='CardType']").parent("li").append("<span class='field_repace'>"+$("[ID$='CardType'] option:selected").text()+"</span>");$("[ID$='CardNumber']").parent("li").append("<span class='field_repace'>"+$("[ID$='CardNumber']").val()+"</span>");}
_self._what_card="custom_card";if($('.add_card_from_c').is(':hidden')){$('.add_card_from_c').slideDown();}},openCardForm:function(evt){evt.preventDefault();var _self=this;this._what_card="new_card";if($('.add_card_from_c').is(':hidden')){$('.add_card_from_c').slideDown();};return false;},useCustomAddress:function(evt){var _self=this;$(".saved_billing_addresses").slideUp();this.what_billing_address="custom_address";this._addressId='';$.ajax({type:"GET",url:'/UIServices/Common/SiteService.svc/renderuc?path=/UserControls/Common/AddressForm.ascx&bustcache='+(new Date()).getTime(),dataType:'html',success:function(data){$.proxy(_self.onGetAddressForm(data),_self)}});},useSavedAddress:function(evt){var _self=this;_self._what_billing_address="saved_address";$(".saved_billing_addresses").slideDown();},loadSavedAddress:function(evt){var $this=$(evt.target);var _self=this;$(".saved_billing_addresses").slideUp();this._addressId=$this.val();$.ajax({type:"GET",url:'/UIServices/Common/SiteService.svc/renderuc?path=/UserControls/Common/AddressForm.ascx&bustcache='+(new Date()).getTime(),dataType:'html',success:function(data){$.proxy(_self.onGetAddressForm(data),_self)}});},onGetAddressForm:function(data){var _self=this;$('#billing_address_form').html(data);$('#billing_address_form').find("[ID$='divFindAddress']").hide();$(".add_card_from_c .address_form").show();if(this._addressId!=''){$(".add_card_from_c .address_form input, .add_card_from_c .address_form select").attr('disabled',true);$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/GetAddress",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"addressId":this._addressId}),success:function(data){$.proxy(_self.onGetAddress(data),_self)}});}
else{this.setAddressFieldLayout('GB',1);$("[ID$='txtCountryName']").on('change',$.proxy(this.drpInsightCountryList,_self));$("#btnFindAddress").on('click',$.proxy(this.findAddress,_self));$('.cancel_add_address').on('click',$.proxy(this.cancelAddAddress,_self));$("[ID$='ddAddressList']").on('change',$.proxy(this.ddAddressList,this));}},onGetAddress:function(response){var _self=this;$(".loadingCover, .loadingBg").remove();if(response.d.isValid&&null!=response.d.entityData){this.setAddressFieldLayout(response.d.entityData.CountryCode,1);$.each(response.d.entityData,function(key,value){if(key=='IsDefaultContactAddress'&&value){var defaultContactAddressCheckbox=$("#billing_address_form [ID$='chkDefaultContactAddress']");defaultContactAddressCheckbox.attr('checked',true);}
if(key=='TelephoneNumberCountryCode'){var telephoneNumberCountryCodeDropdown=$("#billing_address_form [ID$='TelephoneNumberCountryCode']");telephoneNumberCountryCodeDropdown.val(value);}
if(key=='TelephoneNumber1CountryCode'){var telephoneNumber1CountryCodeDropdown=$("#billing_address_form [ID$='TelephoneNumber1CountryCode']");telephoneNumber1CountryCodeDropdown.val(value);}
if($("#billing_address_form [ID$='txt"+key+"']")&&value!=null){if(key=='UserTitle'){$(".address_form [ID$='txt"+key+"']").val(value.toUpperCase());}
else if(key=='CountryName'){}
else if(key=='RegionName'&&response.d.entityData.CountryCode=='US'){$("#delivery_address_f [ID$='txt"+key+"Us']").val(response.d.entityData.RegionCode);$('#ukCounty, #auCounty,#caCounty,#jpCounty').hide();$('#usCounty').show();}else if(key=='RegionName'&&response.d.entityData.CountryCode=='CA'){$("#delivery_address_f [ID$='txt"+key+"Ca']").val(response.d.entityData.RegionCode);$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();}else if(key=='RegionName'&&response.d.entityData.CountryCode=='JP'){$("#delivery_address_f [ID$='txt"+key+"Jp']").val(response.d.entityData.RegionCode);$('#ukCounty, #auCounty,#caCounty,#usCounty').hide();$('#jpCounty').show();}else if(key=='RegionName'&&response.d.entityData.CountryCode=='AU'){$("#delivery_address_f [ID$='txt"+key+"Au']").val(response.d.entityData.RegionCode);$('#ukCounty, #usCounty,#caCounty,#jpCounty').hide();$('#auCounty').show();}
else if(response.d.entityData.CountryCode=='GB'){$('#ukCounty').children('label').text('County*');$("#billing_address_form [ID$='txt"+key+"']").val(value);$('#auCounty, #usCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();}else{$("#billing_address_form [ID$='txt"+key+"']").val(value);};}});if($('.add_address_from_c').is(':hidden')){$('.add_address_from_c').slideToggle();};if($(document.activeElement).hasClass('fixAddressLink')==true){$('.save_to_addresses').click();}}},setAddressFieldLayout:function(countryCode,full){$('.txtAddressLine1, .txtAddressLine2, .txtCity, .txtCounty, .txtPostcode').show();$('.txtAddressLine1').children('label').text('Address line 1: *');$('.txtCity').children('label').text('Town/City');$('.txtCounty').children('label').text('State/Region');$('.txtPostCode').children('label').text('Postcode/Zipcode');$("#btnFindAddress, #btnLookupUSAddress").hide();if(countryCode=='GB'){$('.txtCountry').find('select').val('GB');$("[ID$='TelephoneNumberCountryCode'], [ID$='TelephoneNumber1CountryCode']").val("+44");$('#usCounty, #auCounty, #caCounty, #jpCounty').hide();$('.txtCity').children('label').text('City: *');$('.txtPostcode').children('label').text('Postcode: *');$("#ukCounty, #btnFindAddress").show();if(full=="0"){$('.txtAddressLine1').children('label').text('House number');$('.txtAddressLine2, .txtCity, .txtCounty').hide();}}
else if(countryCode=='US'){$('#ukCounty, #auCounty,#caCounty,#jpCounty, #btnLookupUSAddress').hide();$('#usCounty').show();$('.txtCity').children('label').text('City');$('.txtPostcode').children('label').text('Zipcode');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='CA'){$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();$('.txtCity').children('label').text('City/Municipality');$('.txtPostcode').children('label').text('Postal code');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='AU'){$('#ukCounty, #caCounty,#usCounty,#jpCounty').hide();$('#auCounty').show();$('.txtCity').children('label').text('Suburb');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='JP'){$('#ukCounty, #auCounty,#usCounty,#caCounty').hide();$('#jpCounty').show();$('.txtCity').children('label').text('City/District');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}
else{$('#usCounty, #auCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();$('.txtCity').children('label').text('Town');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}},closeCardForm:function(evt){var _self=this;var $this=$(evt.target)
$this.parent('div').slideUp();},saveCardDetails:function(evt){evt.preventDefault();var _self=this;$('.error_c').remove();$('.error').removeClass("error");if(_self._what_card==null){$('.cards_action li').addClass('error');$('.cards_action').prepend('<li class="error_c checkbox"><p class="error">Please select a card.</p></li>');}else if(_self._what_billing_address==null){$('.bill_address_action li').addClass('error');$('.bill_address_action').prepend('<li class="error_c checkbox"><p class="error">Please select a billing address.</p></li>');}else if($('#billing_address_form').html()==''||$('#billing_address_form form .address_form').is(':hidden')){$('.bill_address_action li').addClass('error');$('.bill_address_action').prepend('<li class="error_c checkbox"><p class="error">Please select an address.</p></li>');}else{var invalid="false";var here=$('.add_card_from_c');this._payment.Id=_self._theCardId;this._payment.CardType=$("[ID$='CardType'] option:selected").val().toUpperCase();if(_self.what_card=="edit_card"){this._payment.CardNumber=$("#CardNumber").data("cnumber");}else{this._payment.CardNumber=$("#CardNumber").val();}
if(this._payment.CardNumber==""){invalid="true";$(".sb_card_number").before('<li class="error_c"><p class="error">Please enter a card number</p></li>').addClass('error');}else if(isNaN(this._payment.CardNumber)==true){invalid="true";$(".sb_card_number").before('<li class="error_c"><p class="error">Must be a number</p></li>').addClass('error');}
else if(!this.isValidIdentifier(this._payment.CardNumber)){invalid="true";$(".sb_card_number").before('<li class="error_c"><p class="error">Please enter a valid card number</p></li>').addClass('error');}
this._payment.CardHoldersName=$("#CardHoldersName").val();if(this._payment.CardHoldersName==""){invalid="true";$(".sb_card_name").before('<li class="error_c"><p class="error">Please enter a name</p></li>').addClass('error');}
this._payment.StartMonth=$("[ID$='StartMonth'] option:selected").val();this._payment.StartYear=$("[ID$='StartYear'] option:selected").val();this._payment.ExpiresMonth=$("[ID$='ExpiresMonth'] option:selected").val();this._payment.ExpiresYear=$("[ID$='ExpiresYear'] option:selected").val();this._payment.IssueNumber=$("#IssueNumber").val();var myday=new Date();var month=myday.getMonth();if(month<10)month="0"+month;var year=myday.getFullYear();if(this._payment.ExpiresYear==year&&this._payment.ExpiresMonth<month){invalid="true";$(".sb_card_end").before('<li class="error_c"><p class="error">Please enter a valid end month</p></li>').addClass('error');}
if($("[ID$='txtId']").val()==''){this._address.Id='';this._address.IsDefaultContactAddress=($("#chkDefaultContactAddress").attr('checked'));this._address.UserTitle=here.find("[ID$='txtUserTitle']").val();if(this._address.UserTitle=="Please Select"){invalid="true";here.find(".txtUserTitle").before('<li class="error_c"><p class="error">Please select a title</p></li>').addClass('error');}
this._address.FirstName=here.find("[ID$='txtFirstName']").val();if(this._address.FirstName==""){invalid="true";here.find(".txtFirstName").before('<li class="error_c"><p class="error">Please enter a first name</p></li>').addClass('error');}
this._address.LastName=here.find("[ID$='txtLastName']").val();if(this._address.LastName==""){invalid="true";here.find(".txtLastName").before('<li class="error_c"><p class="error">Please enter a last name</p></li>').addClass('error');}
this._address.CompanyName=here.find("[ID$='txtCompanyName']").val();this._address.AddressLine1=here.find("[ID$='txtAddressLine1']").val();if(this._address.AddressLine1==""){invalid="true";here.find(".txtAddressLine1").before('<li class="error_c"><p class="error">Please enter an address line 1</p></li>').addClass('error');}
this._address.AddressLine2=here.find("[ID$='txtAddressLine2']").val();this._address.CountryCode=here.find("[ID$='txtCountryName']").val();this._address.City=here.find("[ID$='txtCity']").val();if(this._address.City==""){invalid="true";here.find(".txtCity").before('<li class="error_c"><p class="error">Please enter a town/city</p></li>').addClass('error');}
this._address.Postcode=here.find("[ID$='txtPostcode']").val();if(this._address.CountryCode=="GB"||address.CountryCode=="US"||address.CountryCode=="AU"){if(this._address.Postcode==""){invalid="true";here.find(".txtPostcode").before('<li class="error_c"><p class="error">Please enter a postcode</p></li>').addClass('error');}}
this._address.CountryName=$("[ID$='txtCountryName'] option:selected").text();this._address.TelephoneNumber=$("[ID$='txtTelephoneNumber']").val();this._address.TelephoneNumber1=$("[ID$='txtTelephoneNumber1']").val();this._address.TelephoneNumberCountryCode=$("[ID$='TelephoneNumberCountryCode']").val();this._address.TelephoneNumber1CountryCode=$("[ID$='TelephoneNumber1CountryCode']").val();if(this._address.TelephoneNumber==""){if(this._address.TelephoneNumber1==""){invalid="true";$("[ID$='txtTelephoneNumber1']").parent('li').before('<li class="error_c"><p class="error">Please enter at least one telephone number</p></li>').addClass('error');}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._address.TelephoneNumber1)||this._address.TelephoneNumber1.length<6){invalid="true";$("[ID$='txtTelephoneNumber1']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._address.TelephoneNumber1!=""&&this._address.TelephoneNumber1CountryCode==""){invalid="true";$("[ID$='txtTelephoneNumber1']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._address.TelephoneNumber)||this._address.TelephoneNumber.length<6){invalid="true";$("[ID$='txtTelephoneNumber']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._address.TelephoneNumber!=""&&this._address.TelephoneNumberCountryCode==""){invalid="true";$("[ID$='txtTelephoneNumber']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
if(this._address.TelephoneNumber1==""){if(this._address.TelephoneNumber==""){invalid="true";$("[ID$='txtTelephoneNumber']").parent('li').before('<li class="error_c"><p class="error">Please enter at least one telephone number</p></li>').addClass('error');}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._address.TelephoneNumber)||this._address.TelephoneNumber.length<6){invalid="true";$("[ID$='txtTelephoneNumber']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._address.TelephoneNumber!=""&&this._address.TelephoneNumberCountryCode==""){invalid="true";$("[ID$='txtTelephoneNumber']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}}else if(!/^([0-9]*[1-9][0-9]*)$/.test(this._address.TelephoneNumber1)||this._address.TelephoneNumber1.length<6){invalid="true";$("[ID$='txtTelephoneNumber1']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(this._address.TelephoneNumber1!=""&&this._address.TelephoneNumber1CountryCode==""){invalid="true";$("[ID$='txtTelephoneNumber1']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
this._address.Email=here.find("#txtEmail").val();var emailReg=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;if(this._address.Email==""){invalid="true";here.find(".txtEmail").before('<li class="error_c"><p class="error">Please enter an Email address</p></li>').addClass('error');}else if(!emailReg.test(this._address.Email)){invalid="true";here.find(".txtEmail").before('<li class="error_c"><p class="error">Please enter a valid email</p></li>').addClass('error');}
if(this._address.CountryCode=="GB"){this._address.RegionName=here.find("[ID$='txtRegionName']").val();this._address.RegionCode="";if(this._address.RegionName==""){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a county</p></li>').addClass('error');};}else if(this._address.CountryCode=="US"){this._address.RegionName=here.find("[ID$='txtRegionNameUs'] option:selected").text();this._address.RegionCode=here.find("[ID$='txtRegionNameUs'] option:selected").val();if(this._address.RegionName==""||this._address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a state/region</p></li>').addClass('error');};}else if(this._address.CountryCode=="CA"){this._address.RegionName=here.find("[ID$='txtRegionNameCa'] option:selected").text();this._address.RegionCode=here.find("[ID$='txtRegionNameCa'] option:selected").val();if(this._address.RegionName==""||this._address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a province</p></li>').addClass('error');};}else if(this._address.CountryCode=="JP"){this._address.RegionName=here.find("[ID$='txtRegionNameJp'] option:selected").text();this._address.RegionCode=here.find("[ID$='txtRegionNameJp'] option:selected").val();if(this._address.RegionName==""||this._address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a prefecture</p></li>').addClass('error');};}else if(this._address.CountryCode=="AU"){this._address.RegionName=here.find("[ID$='txtRegionNameAu'] option:selected").text();this._address.RegionCode=here.find("[ID$='txtRegionNameAu'] option:selected").val();if(this._address.RegionName==""||this._address.RegionName=="Please Select"){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a state/region</p></li>').addClass('error');};}else{this._address.RegionName=here.find("[ID$='txtRegionName']").val();this._address.RegionCode="";if(this._address.RegionName==""){invalid="true";here.find(".txtCounty").before('<li class="error_c"><p class="error">Please enter a state/region</p></li>').addClass('error');};};}
else{this._address.Id=$("[ID$='txtId']").val();}
if(invalid=="false"){this._payment.BillingAddress=this._address;$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/PaymentCardService.svc/SaveCardWithAddress",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"card":this._payment,"address":this._address}),success:function(data){$.proxy(_self.onSaveCard(data),_self)},error:function(data){$.proxy(_self.onSaveCardFail(data),_self)}});}}},onSaveCard:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){var line=[];$('.add_card_from_c').slideUp();$('#MessageBox').empty().removeClass().hide();$(".loadingCover, .loadingBg").remove();var cadrId=response.d.entityData.Id.replace(/{|}/ig,"");var cardType=response.d.entityData.CardType;var cardFullName=response.d.entityData.CardHoldersName;var cardNumberEnding=response.d.entityData.LastFourDigits;var cardExpiDate=response.d.entityData.ExpiresMonth+"/"+response.d.entityData.ExpiresYear
if(_self._theCardId==""){line[1]='<li><div id="CardItem" rel="'+cadrId+'" class="address_box">';line[2]='<p class="address_actions" style="height:10px"><span style="float:left;color:red;">Saved</span><a href="#" class="edit_payment_cards">edit</a> | <a href="#" class="remove_payment_cards">remove</a></p>';line[3]='<p class="address_prev"><span class="address_cont"><strong>'+cardType+'</strong><br>'+cardFullName+'<br>';line[4]='Card number ending: '+cardNumberEnding+'<br>Expires end: '+cardExpiDate+'<br></span></p>';line[5]='<span id="divBtnSelectCard"><a href="#" class="green_button_l selectCardLink" style="margin-right: 7px;">Set preferred card<span>»</span></a></span>';line[6]='</div></li>'
var html=line.join("");$('.c_addresses_list li:first').before(html);$(".cards_form input").val("");$(".cards_form select").find('option:first').attr('selected','selected');$(".bill_address_action input:radio").attr("checked","");$("#billing_address_form").html("");$(".cards_form .field_repace").remove();$(".cards_form input, .cards_form select").show();}else{line[1]='<strong>'+cardType+'</strong><br>'+cardFullName+'<br>';line[2]='Card number ending: '+cardNumberEnding+'<br>Expires end: '+cardExpiDate+'<br></span>';var html=line.join("");$("[rel$='"+_self._theCardId+"'] .address_cont").html(html);$(".cards_form input").val("");$(".cards_form select").find('option:first').attr('selected','selected');$(".bill_address_action input:radio").attr("checked","");$("#billing_address_form").html("");$(".cards_form .field_repace").remove();$(".cards_form input, .cards_form select").show();}
var isnewaddress=true;$("[ID$='AddressChoice'] option").each(function(){if($(this).val()==response.d.entityData.BillingAddressId){isnewaddress=false;return false;}});if(isnewaddress==true){$("[ID$='AddressChoice']").append("<option value='"+response.d.entityData.BillingAddressId+"'>"+response.d.entityData.BillingAddress.AddressLine1+"</option>")}}else{var errMsg=response.d.errorMessage;var ifbroken=false;if(response.d.errors!=null){$.each(response.d.errors,function(key,val){errMsg=errMsg+'<br />'+val.Value;});}
if(ifbroken==false){_self.showMessage("msgboxError",errMsg);var targetOffset=$('h1').offset().top;$('html,body').animate({scrollTop:targetOffset},"slow");}}},onSaveCardFail:function(response){$(".cards_form ul").before("<li class=\"error_c\"><p class=\"error\">An error occured. Please try again</p></li>").addClass('error');},removeCard:function(evt){var _self=this;var $this=$(evt.target);var cardId=$this.parents("[ID$='CardItem']").attr("rel");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/PaymentCardService.svc/RemoveCard",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"cardId":cardId}),success:function(data){$.proxy(_self.onRemoveCard(data),_self)}});},onRemoveCard:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){window.location.reload(true);}else{var errMsg=response.d.errorMessage;var ifbroken=false;if(response.d.errors!=null){$.each(response.d.errors,function(key,val){errMsg=errMsg+'<br />'+val.Value;});}
if(ifbroken==false){}}},isValidIdentifier:function(identifier){var sum=0,alt=false,i=identifier.length-1,num;if(identifier.length<13||identifier.length>19){return false;}
while(i>=0){num=parseInt(identifier.charAt(i),10);if(isNaN(num)){return false;}
if(alt){num*=2;if(num>9){num=(num%10)+1;}}
alt=!alt;sum+=num;i--;}
return(sum%10==0);},findAddress:function(evt){evt.preventDefault();var countryCode=$("[ID$='txtCountryName']").val();var houseNumber=$("[ID$='txtInsightAddressLine1']").val();var postCode=$("[ID$='txtPostcode']").val().toLowerCase();var _self=this
$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/FindAddress",data:JSON.stringify({"countryCode":countryCode,"houseNumber":houseNumber,"postCode":postCode}),success:function(data){$.proxy(_self.onFindAddress(data),_self)}});},drpInsightCountryList:function(evt){var $this=$(evt.target),rootthis=$this.parents('.txtCountry').siblings('.txtCounty');this.setAddressFieldLayout($this.val(),1);},cancelAddAddress:function(evt){var $this=$(evt.target)
$this.parent('div').parent('div').slideUp();$('#delivery_address_f').empty();$('.add_new_address_h').text('Add new address');return false;},onFindAddress:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){$('.small_loader').remove();if(response.d.entityData.addressCount==1){this.onSelectAddress(response);}else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$('#divFindAddress').slideDown("slow");}}else{$('.txtPostcode').before('<li class="error_c"><p class="error">'+response.d.errorMessage+'</p></li>').addClass('error');$('.small_loader').remove();}},onSelectAddress:function(response){if(response.d.isValid&&null!=response.d.entityData){$('.small_loader').remove();if(response.d.entityData.addressCount==1){$.each(response.d.entityData.addressMaster,function(key,value){if($("[ID$='txt"+key+"']")&&value!=null){if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='US'){$("[ID$='txt"+key+"Us']").val(value);$('#ukCounty, #auCounty,#caCounty,#jpCounty').hide();$('#usCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='CA'){$("[ID$='txt"+key+"Ca']").val(value);$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='JP'){$("[ID$='txt"+key+"Jp']").val(value);$('#ukCounty, #auCounty,#caCounty,#usCounty').hide();$('#jpCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='AU'){$("[ID$='txt"+key+"Au']").val(value);$('#ukCounty, #usCounty,#caCounty,#jpCounty').hide();$('#auCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='GB'){$('#ukCounty').children('label').text('County');$("[ID$='txtInsightCounty']").val(value);$('#auCounty, #usCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();}else{$("[ID$='txtInsight"+key+"']").val(value);};}});this.setAddressFieldLayout(response.d.entityData.addressMaster.CountryName,1);$("[ID$='Short'], #Options1, #Options3, [ID$='divFindAddress']").hide();}
else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$("[ID$='divFindAddress']").slideDown("slow");}}
else{$('#ErrorAddBill').append('<p class="error">'+response.d.errorMessage+'</p>').show();$('.small_loader').remove();}
if(response.d.isValid&&null!=response.d.entityData){}
else{$('#ErrorAddBill').html(response.d.errorMessage).show();}
return false;},ddAddressList:function(){if($("[ID$='ddAddressList']").is(":visible")){var error_div=$('#ErrorAdd');this.selectAddress(error_div);}},selectAddress:function(){var _self=this;var countryCode=$("[ID$='txtCountryName']").val();var searchStatus=$("[ID$='SearchStatus']").val();var ambiguityId=$("[ID$='ddAddressList']").attr("selectedIndex")-1;$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/SelectAddress",data:JSON.stringify({"countryCode":countryCode,"searchStatus":searchStatus,"ambiguityId":ambiguityId}),success:function(data){$.proxy(_self.onSelectAddress(data),_self)}});},onSelectAddress:function(response){if(response.d.isValid&&null!=response.d.entityData){$('.small_loader').remove();if(response.d.entityData.addressCount==1){$.each(response.d.entityData.addressMaster,function(key,value){if($("[ID$='txt"+key+"']")&&value!=null){if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='US'){$("[ID$='txt"+key+"Us']").val(value);$('#ukCounty, #auCounty,#caCounty,#jpCounty').hide();$('#usCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='CA'){$("[ID$='txt"+key+"Ca']").val(value);$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='JP'){$("[ID$='txt"+key+"Jp']").val(value);$('#ukCounty, #auCounty,#caCounty,#usCounty').hide();$('#jpCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='AU'){$("[ID$='txt"+key+"Au']").val(value);$('#ukCounty, #usCounty,#caCounty,#jpCounty').hide();$('#auCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryCode=='GB'){$('#ukCounty').children('label').text('County');$("[ID$='txtRegionName']").val(value);$('#auCounty, #usCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();}else{$("[ID$='txt"+key+"']").val(value);};}});this.setAddressFieldLayout(response.d.entityData.addressMaster.CountryName,1);$("[ID$='Short'], #Options1, #Options3, [ID$='divFindAddress']").hide();}
else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$("[ID$='divFindAddress']").slideDown("slow");}}
else{$('#ErrorAddBill').append('<p class="error">'+response.d.errorMessage+'</p>').show();$('.small_loader').remove();}
if(response.d.isValid&&null!=response.d.entityData){}
else{$('#ErrorAddBill').html(response.d.errorMessage).show();}
return false;},listHightlight:function(){$('.login_f li input, .unsigned_f li input, .to_from li input, .to_from li select').focus(function(){if($(this).attr('id')!='payment_startdate_year'&&$(this).attr('id')!='payment_expirydate_year'){$('.login_f li, .unsigned_f li, .to_from li').removeClass('active');$(this).parent('li').addClass('active');}});},focusOnLoad:function(){$("[ID$='CardType']").focus();}}));Hrd.define('Harrods.Product',Hrd.extend({_window:$(window),_basketItemCount:0,_isBedding:false,_addedRangeOptions:false,init:function(){var swatch_modal=['<div class="swatch_modal"><div class="swatch_modal_in">','<div class="swatch_color">','</div><div class="swatch_info">','<p class="swatch_name f_left">','</p><p class="swatch_price f_right">','</p></div></div></div>'].join('')
$('body').append(swatch_modal);if($('.htabs').length>0){$('.htabs').tabs();}
var _self=this;if(this._isTouch){$('html').addClass('isTouch');}
if($('.homewares-pdp').length){_self.generateRangeColourSwatchTooltips();}
if($('.homewares-pdp.bedding').length){_self._isBedding=true;}
if($(".hampers").length){$("body").on("click","#delivery---returns",$.proxy(this.dAndRTracking,this));}
if($('.cross_sell .carousel').length>0){if($('.port_product').length>0||$('.landsc_product').length>0){$('.cross_sell .carousel').each(function(i,e){if($(e).find('ul li').length>6){$(e).css('padding','0 15px')
_self.crossSellCarousel(e);}});}else{$('.cross_sell .carousel').each(function(i,e){if($(e).find('ul li').length>3){$(e).css('padding','0 15px')
_self.crossSellCarousel(e);}});}}
if($("#color_swatch_w").length>0){$("#color_swatch_w.nano").nanoScroller();}
$('.view_full_img').on("click",$.proxy(this.viewFullImg,this))
$('body').on("click",'.img_modal_bg, .close',$.proxy(this.hideFullImg,this))
$('body').on("click",'.img_modal_alt_c li img',$.proxy(this.updateFullImg,this))
$('.product_right_box').find('.color_swatch').on({mouseover:$.proxy(this.onSwatchOver,this),mouseleave:$.proxy(this.onSwatchOut,this),click:$.proxy(this.onSwatchClick,this)})
$('.qplus').on('click',$.proxy(this.qtyPlus,this))
$('.qminus').on('click',$.proxy(this.qtyMinus,this))
$('#colour').on('change',function(){var a=$('.color_swatch[data-cname="'+$(this).val()+'"]');if(a.length>0)
a.click()})
$('#size').on('change',$.proxy(this.onSizeChange,this));$('#size_homeware').on('change',$.proxy(this.onSizeFilterChange,this));$('#colour_homeware').on('change',$.proxy(this.onColourFilterChange,this));$('.colour_swatch_homeware').on('click',$.proxy(this.onColourFilterChange,this));$('.range-options .colour-picker.more-colours .selected-colour').on('click',$.proxy(this.showRangeItemColours,this));$('.range-options .colour-picker .swatch-tooltip .close').on('click',$.proxy(this.hideRangeItemColours,this));$('.range-options .colour-picker .swatch-tooltip').on('mouseleave',$.proxy(this.hideRangeItemColours,this));$('.range-options').on('click','.remove-item',$.proxy(this.removeSelectedRangeItem,this));$('.colour-swatch-selector-homeware').on('click',$.proxy(this.onColourSwatchSelectorClick,this));$('.qty-homeware').on('change',$.proxy(this.onQuantitySelectorChange,this));this.colorSwatches();$('#quantity').on('blur',$.proxy(this.checkQuantity,this))
if($('.cloud-360').length>0){$('.cloud-360').append('<img src="/public/img/360_thumb.png" class="v360_thumb" alt="360 view" />')}
if($('.recently_viewed_c').find('.carousel ul li').length>6){$('#recently_viewed .slides').swipe({steps:3});}
$('.cloud-zoom-gallery').on('click',function(evt){$('.alt_view').find('li').removeClass('active');$(this).parent('li').addClass('active');$('.flash_360_c').remove();});$('.cloud-360').on('click',$.proxy(this.show360,this))
$('.alt_view > li:nth-child(1)').addClass('active');$('.colour_swatch_homeware:first-child').addClass('active');if($('#size-guide').length>0){$('#size').on('click',$.proxy(this.sizeGuideStuff,this));}
if($('#size_detail').length>0&&$('#colour_detail').length==0){this.getCrossSell();$('#size').on('change',$.proxy(this.getCrossSell,this));}
if($('.port_product').length>0||$('.landsc_product').length>0){this.hampersActions()}
$('body').on({'Harrods.Product.SwatchSetup':$.proxy(this.colorSwatches,this)});$('.homewares-pdp').on("click",'.add_to_bag_homeware',$.proxy(this.yourSelectedItemToBag,this));},hampersActions:function(){var hamp_name=$('.product_right_box').find('.fn').text(),excep_hampers=[2946734,2946733,2948478,2948479,2947119,2791599,2946735,2946736],prodid=$('.product_code').attr('data-prodid');$('.hamper_name').text(hamp_name)
$.each(excep_hampers,function(i,v){if(v==prodid){$('#contents').hide()}})},getCrossSell:function(evt){var $this,productId,_self=this
function pad(str,max){return str.length<max?pad("0"+str,max):str;}
if(evt!=undefined&&evt.type=='change'){$this=$(evt.target)
productId=pad($this.find("option:selected").attr('data-pid'),18)}else{productId=pad($('.product_code').attr("data-prodid"),18)}
$.ajax({type:"GET",url:PROTOCOL+WEBROOT+"/UIServices/CatalogService.svc/GetCrossSell",data:{productId:productId},success:function(data){$.proxy(_self.onGetCrossSell(data),_self)}});},show360:function(evt){evt.preventDefault();var $this=$(this),prodid360=$(".product_code").attr("data-prodid"),v360url="http://s7g1.scene7.com/is/content/Harrods/"+prodid360+".swf",flashdurl="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash",v360_c='<div class="flash_360_c">'
+'<div id="flash_360">'
+'<script type="text/javascript">'
+'var swf_url = "'+v360url+'";'
+'var flashvars = {};'
+'var params = {'+'quality: "best",'+'bgcolor: "#ffff",'+'allowfullscreen: "false",'+'wmode: "transparent"'+'};'
+'var attributes = {};'
+'swfobject.embedSWF('+'swf_url, '+'"flash_360",'+'"400",'+'"455",'+'"7.0.0",'+'"/Flash/expressInstall.swf",'+'flashvars,'+'params,'+'attributes);'
+'$("#flash_360").append(\'To view interactive 360&deg; you need Flash Player 9 or higher installed.<a href="'+flashdurl+'" title="Download FP9">Click here to download</a>.\');'
+'</script>'
+'</div>'
+'<p class="roll_zoom_text2">Click and drag to rotate</p> '
+'</div>';$('.flash_360_c').remove();$('.alt_view').find('li').removeClass('active')
$this.parent('li').addClass('active')
$('.alt_view').after(v360_c)},sizeGuideStuff:function(){var $tableHt=$('#size-data.nano table').height();var $scrollHt=$('#size-data.nano').height();if($tableHt<=$scrollHt){$('.nano').css({'height':$tableHt});$('ul.size-head').css({'background':'none','width':'360px'});$('.size-foot').css({'background':'none','width':'360px'});$('#size-data').css({'border-top':'solid 1px #dcdcdc','border-bottom':'solid 1px #dcdcdc'});$('#size-data table').css({'width':'360px'});if(($('ul.size-head li.last').width())=='46'){$('ul.size-head li').css({'width':'44px'});$('ul.size-head li.last').css({'width':'45px'});$('#size-data td').css({'width':'44px'});$('#size-data td.last').css({'width':'45px'});}
else if(($('ul.size-head li').width())=='57'){$('ul.size-head li').css({'width':'59px'});$('ul.size-head li.last').css({'width':'60px'});$('#size-data td').css({'width':'61px'});$('#size-data td.last').css({'width':'60px'});}
else if(($('ul.size-head li.last').width())=='71'){$('ul.size-head li').css({'width':'71px'});$('ul.size-head li.last').css({'width':'72px'});$('#size-data td').css({'width':'71px'});$('#size-data td.last').css({'width':'72px'});}
else if(($('ul.size-head li').width())=='86'){$('ul.size-head li').css({'width':'89px'});$('ul.size-head li.last').css({'width':'90px'});$('#size-data td').css({'width':'89px'});$('#size-data td.last').css({'width':'90px'});}
else if(($('ul.size-head li').width())=='115'){$('ul.size-head li').css({'width':'119px'});$('ul.size-head li.last').css({'width':'120px'});$('#size-data td').css({'width':'119px'});$('#size-data td.last').css({'width':'120px'});}
else if(($('ul.size-head li').width())=='173'){$('ul.size-head li').css({'width':'180px'});$('ul.size-head li.last').css({'width':'179px'});$('#size-data td').css({'width':'180px'});$('#size-data td.last').css({'width':'179px'});}}},qtyPlus:function(evt){var $this=$(evt.target),quantity=$this.siblings('#quantity').length>0?$this.siblings('#quantity'):$this.siblings('.quantity'),max_qty=quantity.data('maxbasketcount'),qty
if(max_qty==quantity.val()){$('.error').remove();if($('.giftcard_right').length>0){alert('Maximum quantity for this item is '+max_qty);}else{$('.quantity').before('<li class="error_c"><p class="error">Maximum quantity for this item is '+max_qty+'</p></li>');}}else{qty=quantity.val();qty++;quantity.val(qty);};return false;},qtyMinus:function(evt){var $this=$(evt.target),quantity=$this.siblings('#quantity').length>0?$this.siblings('#quantity'):$this.siblings('.quantity'),min_qty=quantity.data('minbasketcount'),qty
if(min_qty==0&&quantity.val()==1){}else if(min_qty==quantity.val()){}else{qty=quantity.val();qty--;quantity.val(qty);};return false;},checkQuantity:function(){$('.error').remove();var quantity=$('#quantity'),mq=quantity.data('maxbasketcount')
if(mq>0){if(quantity.val()>mq){if($('.giftcard_right').length>0){alert('Maximum quantity for this item is '+mq);}else{quantity.before('<p class="error">Maximum quantity for this item is '+mq+'</p>');}}}},colorSwatches:function(){$('.color_swatch').each(function(){var bgurl=$(this).attr('href')
$(this).css('background','url('+bgurl+') repeat left top')
if($(this).hasClass('active')){$(this).click()}})
$('.colour_swatch_homeware').each(function(){var bgurl=$(this).attr('href')
$(this).css('background','url('+bgurl+') repeat left top')})},onSwatchClick:function(evt){evt.preventDefault();var $this=$(evt.target),$pid=$this.data('prodcode'),$cname=$this.attr('data-cname'),$cprice=$this.data('cprice'),$cwasprice=$this.data('cwasprice'),$quantity=$this.data('quan'),rel,$altDiv=$('.alt_view'),$newsizes=$this.next('ul'),$sizedd=$('#size'),ismodelview=$this.attr('data-cmodelview')=='true'?'-f':'',newel=$('.product_main_img').clone().find('.product_img').attr('src',S7+$pid+ismodelview+'?$productMain$').end().attr('href',S7+$pid+ismodelview+'?$fullScreen$'),priceChanged=$this.data('pchanged')
$('.view_full_img').attr('data-cmodelview',ismodelview);$('.color_c .color_swatch, .color_box .color_swatch').removeClass('active')
$this.addClass('active')
$('.product_code').text('Product Code '+$pid).attr("data-prodid",$pid);$('#wrap').remove()
$altDiv.find('li').each(function(i,v){var $this=$(this)
if(i==0){rel=S7+$pid+'?$productMain$'
$this.find('a').attr('href',S7+$pid+'?$fullScreen$').attr('rel',"useZoom: 'product_img', smallImage: '"+rel+"'")
$this.find('img').attr('src',S7+$pid+'?$thumbnail$')}else{if(!$this.find('a').hasClass('cloud-360')){rel=S7+$pid+'-'+i+'?$productMain$'
$this.find('a').attr('href',S7+$pid+'-'+i+'?$fullScreen$').attr('rel',"useZoom: 'product_img', smallImage: '"+rel+"'")
$this.find('img').attr('src',S7+$pid+'-'+i+'?$thumbnail$')}else{var href360="http://s7g1.scene7.com/is/content/Harrods/"+$pid+".swf"
$this.find('img:first').attr('src',S7+$pid+'?$thumbnail$')
$this.find('a').attr("href",href360)}}})
$altDiv.find('li').removeClass('active')
$altDiv.find('li:first').addClass('active')
$('.flash_360_c').remove();if($newsizes.find('li').length>0){$sizedd.empty()
$newsizes.find('li').each(function(i,v){var $this=$(this);$sizedd.append(['<option value="',$this.attr('data-pvariantid'),'" data-cwasprice="',$this.attr('data-wasprice'),'" data-cprice="',$this.attr('data-price'),'" data-pid="',$this.attr('data-pid'),'" data-quan="',$this.attr('data-quan'),'">',$this.attr('data-psize'),'</option>'].join(''))})}
if($cwasprice!=null&&$cprice!=null){if(parseFloat($cwasprice.replace('£',''),10)>parseFloat($cprice.replace('£',''),10))
$('.prices').html('<span class="was">'+$cwasprice+'</span>'+'<span class="now">Now '+$cprice+'</span>').removeClass('price_changed');else
$('.prices').html('<b>'+$cprice+'</b>').removeClass('price_changed');}
var productId=$this.attr('data-prodcode'),_self=this
$.ajax({type:"GET",url:PROTOCOL+WEBROOT+"/UIServices/CatalogService.svc/GetCrossSell",data:{productId:productId},success:function(data){$.proxy(_self.onGetCrossSell(data),_self)}});$altDiv.after(newel)
$('.cloud-zoom, .cloud-zoom-gallery').CloudZoom();$('#colour').data('pid',$pid).attr('data-quan',$quantity).val($cname)},onGetCrossSell:function(data){var $div=$('<div>')
$('.cross_sell').remove();$div.append(data.entityData)
if($('.homewares-pdp').length){$('.product_left_box').after($div.html());}
else{$('.view_full_img').after($div.html())}
$('.htabs').tabs();this.crossSellCarousel();$('.products_row_small li img.product_img').on({click:$.proxy(this.productImgClick,this)})},crossSellCarousel:function(e){$('.cross_sell').find('.carousel').each(function(){var id=$(this).attr('id')
if($(this).find('ul li').length>3){$('#'+id+' .slides').swipe({steps:1});}})},productImgClick:function(evt){var $this=$(evt.target)
$url=$this.siblings('h3').find('a').attr('href')
window.location=$url},onSwatchOver:function(evt){var $this=$(evt.target),$top=($this.offset().top-107),$left=($this.offset().left-80),bgurl=$this.attr('href'),cprice=$this.attr('data-cprice'),cname=$this.attr('data-cname'),swatch_modal=$('.swatch_modal')
swatch_modal.find('.swatch_name').text(cname).end().find('.swatch_price').text(cprice).end().find('.swatch_color').css('background','url('+bgurl+') repeat left top')
swatch_modal.css({'display':'block',top:$top,left:$left}).stop().animate({opacity:1},'slow')},onSwatchOut:function(evt){$('.swatch_modal').stop().animate({opacity:0},'slow',function(){$(this).css({'display':'none',top:0,left:0})})},viewFullImg:function(evt){var ismodelview=$('.color_c .color_swatch:first').attr('data-cmodelview')=='true'?'-f':''
var pid
if($('#colour').length>0&&$('#colour').data('pid')!=null){pid=ismodelview?$('#colour').data('pid')+'-f':$('#colour').data('pid')}else{pid=ismodelview?$('.product_code').data('prodid')+'-f':$('.product_code').data('prodid')}
var w_w=$(window).outerWidth(),w_h=$(window).outerHeight(),$altDiv=$('.alt_view'),$ullis,$imgsrc,img_modal
var imgurl=$('#product_img').attr('href');if(this._isBedding){imgurl=imgurl.replace("_zoom","_overlay");}
img_modal='<div class="img_modal" style="width:'+w_w+'px;height:'+w_h+'px"><div class="img_modal_bg" style="width:'
+w_w+'px;height:'+w_h+'px"></div><div class="img_modal_c"><div class="close"><img src="/public/img/close.png" /></div>'
+'<div class="img_modal_alt_c"><ul></ul></div>'+'<img src="'+imgurl+'" class="thezoomedimg" alt=""></div></div>';$('.img_modal').remove();$('body').append(img_modal);var altImageCount=1;var selectedImageIndex=1;$altDiv.find('li').each(function(i,v){if($(this).hasClass('active')){selectedImageIndex=altImageCount;}
altImageCount++;if(!$(this).find('a').hasClass('cloud-360')){$imgsrc=$(this).find('a img').attr('src')
$ullis=['<li><img src="',$imgsrc,'" alt="" />'].join('')
$('.img_modal').find('.img_modal_alt_c ul').append($ullis);}})
if(this._isBedding){$('.img_modal').find('.img_modal_alt_c ul').css('width',($('.img_modal').find('.img_modal_alt_c ul').find('li').length*152.5)+'px');$('.img_modal_c').css('height','617px');}
else{$('.img_modal').find('.img_modal_alt_c ul').css('width',($('.img_modal').find('.img_modal_alt_c ul').find('li').length*82)+'px')}
$('.img_modal').find('.img_modal_alt_c ul li:nth-child('+selectedImageIndex+') img').addClass('active')
$('.img_modal').fadeIn()
this._window.on('resize',$.proxy(this.updateDimensions,this))},updateFullImg:function(evt){var $this=$(evt.target)
if(this._isBedding){var $imgsrc=$this.attr('src').replace("$productdetail_bedding_thumb$","$productdetail_bedding_overlay$")}
else{var $imgsrc=$this.attr('src').replace("$thumbnail$","$fullScreen$")}
$('.img_modal_alt_c ul li img').removeClass('active')
$this.addClass('active')
$('.thezoomedimg').attr('src',$imgsrc)},hideFullImg:function(evt){$('.img_modal').fadeOut();},updateDimensions:function(){$('.img_modal, .img_modal_bg').height($(window).outerHeight()+20).width($(window).outerWidth());},onSizeChange:function(evt){if(evt!=undefined){evt.preventDefault();}
var _self=this;var $cprice=$('#size option:selected').data('cprice').toString();var $cwasprice=$('#size option:selected').data('cwasprice').toString();var $pcode=$('#size option:selected').data('pid').toString();if($cwasprice!=null&&$cprice!=null){if(parseFloat($cwasprice.replace('£','').replace(',',''),10)>parseFloat($cprice.replace('£','').replace(',',''),10))
$('.prices').html('<span class="was">'+$cwasprice+'</span>'+'<span class="now">Now '+$cprice+'</span>').removeClass('price_changed');else
$('.prices').html('<b>'+$cprice+'</b>').removeClass('price_changed');}
$('.product_code').text('Product Code '+$pcode)},onSizeFilterChange:function(evt){if(evt!=undefined){evt.preventDefault();}
var _self=this;var size=$('#size_homeware option:selected').val();var hiddenVariants=$('.variant.hidden');hiddenVariants.slideDown();hiddenVariants.removeClass('hidden');if((size!=null)&&(size!='')){var variants=$('.variant[data-psize !="'+size+'"]').not('.variant[data-pshape ="PILLOWCASE"]');variants.slideUp();variants.addClass('hidden');}},onColourFilterChange:function(evt){if(evt!=undefined){evt.preventDefault();}
var _self=this;var colourSelected='';var prodId;if(evt.target.tagName=="A"){colourSelected=$(evt.target).attr('data-pcolour');prodId=$(evt.target).attr('data-prodid');$('#colour_homeware').val(colourSelected);}
else if(evt.target.tagName=="SELECT"){colourSelected=$(evt.target).val();prodId=$(".colour_swatch_homeware[data-pcolour='"+colourSelected+"']").attr('data-prodid');}
var colourSelectorsMatchingColour=$('.colour-swatch-selector-homeware[data-pcolour="'+colourSelected+'"]');$('.colour_swatch_homeware').removeClass('active');$(".colour_swatch_homeware[data-pcolour='"+colourSelected+"']").addClass('active');$.each(colourSelectorsMatchingColour,function(i,sourceOption){_self.swapSwatches($(sourceOption));});var zoomPreset,mainPreset,thumbPreset;if(this._isBedding){zoomPreset='?$productdetail_bedding_zoom$';mainPreset='?$productdetail_bedding$';thumbPreset='?$productdetail_bedding_thumb$';}
else{zoomPreset='?$fullscreen$';mainPreset='?$productMain$';thumbPreset='?$thumbnail$';}
colourSelected=colourSelected.toUpperCase();var imgPath=S7+prodId+'-'+colourSelected;$('.product_left_box .product_main_img').attr('href',imgPath+zoomPreset);$('.product_left_box .product_img').attr('src',imgPath+mainPreset);var altcount=0;$('.alt_view a').each(function(){if(altcount==0){$(this).attr('href',imgPath+zoomPreset);$(this).attr("rel","useZoom: 'product_img', smallImage: '"+imgPath+mainPreset+"'");$(this).find('img').attr('src',imgPath+thumbPreset);}
else{$(this).attr('href',S7+prodId+'-'+altcount+'-'+colourSelected+zoomPreset);$(this).attr("rel","useZoom: 'product_img', smallImage: '"+S7+prodId+'-'+altcount+'-'+colourSelected+mainPreset+"'");$(this).find('img').attr('src',S7+prodId+'-'+altcount+'-'+colourSelected+thumbPreset);}
altcount++;});$('.alt_view li').removeClass('active');$('.alt_view > li:first-child').addClass('active');$('.cloud-zoom, .cloud-zoom-gallery').CloudZoom();_self.resetRangeSelectedSwatchTooltip();},generateRangeColourSwatchTooltips:function(){$('.colour_swatch_homeware').each(function(){var swatch=$(this);var colour=swatch.attr('data-cname');swatch.append('<span class="colour-tooltip">'+colour+'</span>');});$('.colour-swatch-selector-homeware').each(function(){var swatch=$(this);var colour=swatch.attr('data-pcolour');swatch.append('<span class="colour-tooltip">'+colour+'</span>');});this.resetRangeSelectedSwatchTooltip();},resetRangeSelectedSwatchTooltip:function(){$('.selected-colour').each(function(){var swatch=$(this);swatch.find('.colour-tooltip').remove();var colour=swatch.attr('data-pcolour');swatch.append('<span class="colour-tooltip">'+colour+'</span>');});},showRangeItemColours:function(evt){$('.range-options .colour-picker').removeClass('showtooltip');$(evt.target).parent().addClass('showtooltip');$(evt.target).parent().find('.swatch-tooltip').show();},hideRangeItemColours:function(evt){$('.range-options .colour-picker .swatch-tooltip').hide();$('.range-options .colour-picker').removeClass('showtooltip');},onColourSwatchSelectorClick:function(evt){if(evt!=undefined){evt.preventDefault();}
var _self=this;var sourceOption=$(evt.target);_self.swapSwatches(sourceOption);_self.resetRangeSelectedSwatchTooltip();},onQuantitySelectorChange:function(evt){if(evt!=undefined){evt.preventDefault();}
var _self=this;if(_self._addedRangeOptions){$('.selected-items .title').html('Your Selected Items');$('.add_to_bag_homeware').attr('value','Add to Bag');$('#addTobagStatusList').html('');_self._addedRangeOptions=false;}
var quantitySelector=$(evt.target);var quantitySelected=quantitySelector.val();var selectedColourVariant=quantitySelector.closest('.variant').find('.selected-colour');selectedColourVariant.attr('data-quan-selected',quantitySelected);var selectedColourVariantProductId=selectedColourVariant.attr('data-prodid');var colourVariant=quantitySelector.closest('.variant').find('.colour-swatch-selector-homeware[data-prodid = "'+selectedColourVariantProductId+'"]');colourVariant.attr('data-quan-selected',quantitySelected);_self.calculateSubtotal();},calculateSubtotal:function(){var homewareOptions=$('.colour-swatch-selector-homeware');var itemsText='';var totalQuantity=0;var totalPrice=0;$.each(homewareOptions,function(i,option){var optionElement=$(option);var productId=optionElement.attr('data-prodid');var quantity=parseInt(optionElement.attr('data-quan-selected'));var pcolour=optionElement.attr('data-pcolour');var pshape=optionElement.attr('data-pshape');var psize=optionElement.attr('data-psize');var cprice=optionElement.attr('data-cprice');var price=parseFloat(cprice.substring(1));if((pshape.lastIndexOf('s')==pshape.length-1)&&quantity<2){pshape=pshape.substring(0,pshape.length-1);}
if(psize!=''){if((quantity!=null)&&(quantity>0)){itemsText+='<li class="item" data-prodid="'+productId+'" data-quan-selected="'+quantity+'">'+quantity+' x '+pshape+' ('+psize+', '+pcolour+')<a class="remove-item">remove</a></li>';}}
else{if((quantity!=null)&&(quantity>0)){itemsText+='<li class="item" data-prodid="'+productId+'" data-quan-selected="'+quantity+'">'+quantity+' x '+pshape+' ('+pcolour+')<a class="remove-item">remove</a></li>';}}
totalPrice+=quantity*price;totalQuantity+=quantity;});$('.add-to-bag .subtotal').removeClass('hidden');$('.range-options .error').addClass('hidden');var selectedItemsList=$('.selected-items').find('#your-selected-items-list');selectedItemsList.html(itemsText);var addToBagSubtotal=$('.add-to-bag').find('.subtotal');totalPrice=totalPrice.toFixed(2);var addToBagTotalsContent=totalQuantity+' Items subtotal <span class="amount">£'+totalPrice+'</span>';addToBagSubtotal.html(addToBagTotalsContent);var selectedItemsDiv=$('.selected-items');if(totalQuantity==0){$('.add-to-bag .subtotal').addClass('hidden');$('.range-options .selected-items').addClass('hidden');}
else if(totalQuantity>0){selectedItemsDiv.removeClass("hidden");}
else{selectedItemsDiv.addClass("hidden");}},removeSelectedRangeItem:function(evt){var _self=this;evt.preventDefault();var prodid=$(evt.target).parent().attr('data-prodid');console.log(prodid);$(evt.target).parent().remove();var swatch=$(".colour-swatch-selector-homeware[data-prodid='"+prodid+"']");swatch.attr('data-quan-selected','0');var selectedswatch=$(".selected-colour[data-prodid='"+prodid+"']");if(selectedswatch.length){selectedswatch.attr('data-quan-selected','0');selectedswatch.closest('.variant').find('.qty-homeware').val(0);}
_self.calculateSubtotal();},resetQuantitySelectors:function(){var quantitySelectors=$('.qty-homeware');var selectedColourVariants=$('.selected-colour');var colourVariants=$('.colour-swatch-selector-homeware');quantitySelectors.val(0);selectedColourVariants.attr('data-quan-selected',0);colourVariants.attr('data-quan-selected',0);var selectedItemsList=$('.selected-items .ul');selectedItemsList.html();var addToBagSubtotal=$('.add-to-bag .subtotal')
var addToBagTotalsContent='0 Items subtotal <span class="amount">£0</span>';addToBagSubtotal.html(addToBagTotalsContent);},swapSwatches:function(sourceOption){var targetSpan=sourceOption.closest('.colour-picker').find('.selected-colour');$.each(sourceOption[0].attributes,function(i,attr){if((attr!=null)&&(attr.name!='class')){targetSpan.attr(attr.name,attr.value);}});var stockQuantity=sourceOption.attr('data-quan');var quantitySelected=sourceOption.attr('data-quan-selected');var quantitySelector=sourceOption.closest('.variant').find('.qty-homeware');var outOfStockMessage=sourceOption.closest('.variant').find('.out-of-stock');var replacementQuantityContent='';var replacementQuantityContentElement=null;if(stockQuantity<=0){replacementQuantityContent='<span class="out-of-stock">Out of stock</span>';replacementQuantityContentElement=$(replacementQuantityContent)}
else{replacementQuantityContent+='<select class="qty-homeware">';for(var i=0;((i<=99)&&(i<=stockQuantity));i++){if(i==quantitySelected){replacementQuantityContent+='<option selected>'+i+'</option>';}
else{replacementQuantityContent+='<option>'+i+'</option>';}}
replacementQuantityContent+='</select>';replacementQuantityContentElement=$(replacementQuantityContent);replacementQuantityContentElement.on('change',$.proxy(this.onQuantitySelectorChange,this));}
if(quantitySelector.length>0){quantitySelector.replaceWith(replacementQuantityContentElement);}
else if(outOfStockMessage.length>0){outOfStockMessage.replaceWith(replacementQuantityContentElement);}},yourSelectedItemToBag:function(){var _self=this;if($('.range-options #your-selected-items-list li').length==0){$('.range-options .error').removeClass('hidden');}
else{$('#your-selected-items-list li').each(function(){var pid=$(this).attr("data-prodid");var qty=$(this).attr("data-quan-selected");var varId='';var catPath='';var gcVal='';var pDesc=$(this).html();_self.addSpecifiedProductToBag(pid,qty,varId,catPath,gcVal,pDesc);});$('#topnav').find('.basketQty').text('Your Bag ('+_basketItemCount+')').addClass('inuse');$('#topnav').trigger('Harrods.Basket.getBasketPreview');$("#your-selected-items-list").empty();_self.resetQuantitySelectors();$('.add-to-bag .subtotal').addClass('hidden');$('.selected-items .title').html('Items Added to Bag');$('.add_to_bag_homeware').attr('value','Added to Bag');_self._addedRangeOptions=true;}},addSpecifiedProductToBag:function(pid,qty,var_id,cat_path,gcVal,pDesc){var _self=this;$.ajax({async:false,type:"GET",traditional:true,url:PROTOCOL+SERVICES_ROOT+"/BasketService.svc/AddProductToBag",data:{pid:pid,qnt:qty,varId:var_id,catPath:cat_path,gcVal:gcVal},success:function(response){_self.onAddSpecifiedProductToBag(response,pid,pDesc);_basketItemCount=response.entityData.f.ItemCount;}});},onAddSpecifiedProductToBag:function(response,pid,pDesc){if(response.IsValid==true){var msg=pDesc;$('#addTobagStatusList').append("<li class='item added'>"+msg+"</li>");}
else{var msg=pid+" "+pDesc+"   "+response.Errors;$('#addTobagStatusList').append("<li class='item failed'>"+msg+"</li>");}},dAndRTracking:function(){var localTrackingObject={};var trackedInteraction="delivery concertina";if(typeof window.s!="undefined"&&typeof window.s.manuallyTrackInteraction=="function"){localTrackingObject.pageName=window.s.pageName;interactionName=""+window.s.pageName+" :"+trackedInteraction;localTrackingObject.eVar38=interactionName;localTrackingObject.events="event21";s.manuallyTrackInteraction(trackedInteraction,localTrackingObject);}
return true;}}));Hrd.define('Harrods.ProductList',Hrd.extend({_currentView:'p',_isBeddingPLP:false,_isTowelsPLP:false,init:function(){if($('.bedding-plp').length){this._isBeddingPLP=true;}
if($('.towels-plp').length){this._isTowelsPLP=true;}
if($('.model_prod_v').length>0){this.getView();}else{this.setRolloverImg()
$('.products_row li img.product_img').fadeTo(300,1);}
if($("[ID$='wishList_sorting']").length>0){$('.products_row li img.product_img').fadeTo(300,1);}
$('.products_row').find('.color_swatch').on("click",$.proxy(this.altImgClick,this))
$('.model_view').on("click",$.proxy(this.modelView,this))
$('.product_view').on("click",$.proxy(this.productView,this))
$('.products_row li img.product_img').on({click:$.proxy(this.productImgClick,this),mouseover:$.proxy(this.productImgOver,this),mouseleave:$.proxy(this.productImgOut,this)})
$('.products_row_small li img.product_img').on({click:$.proxy(this.productImgClick,this)})
$('.img_nav li a span').on({mouseover:$.proxy(this.onImgNavOver,this),mouseleave:$.proxy(this.onImgNavOut,this)})
$('.img_nav li a .text_c').each(function(index){var $this=$(this),t=178/2-$this.height()/2;$this.css({top:t});});$('.nano').each(function(){var $this=$(this);if(!$this.hasClass('color_swatch_w')){var lis=$this.find('div ul li').length;if(lis>4){$this.css('height','100px');$this.find('.content').css('height','100px');var nanoid=$this.attr('id');$('#'+nanoid+'.nano').nanoScroller();}else{$this.css('height',(lis*22)+'px');}}});$('#hampers_content.nano').each(function(){var $this=$(this)
if(!$this.hasClass('color_swatch_w')){var lis=$this.find('div ul li').length
if(lis>10){$this.css('height','200px')
$this.find('.content').css('height','200px')
$('#'+'hampers_content'+'.nano').nanoScroller();}else{$this.css('height',(198)+'px')
$('#'+'hampers_content'+'.nano').nanoScroller();}}})
$('.colour_list li a').each(function(){var $this=$(this),color=$this.text().toLowerCase()
if(color.indexOf(' ')!=-1){color=color.slice(0,color.indexOf(' '));}
if(color=='white'||color=='clear'){$this.children('span').css('border','1px solid #ccc')
$this.children('span').css('background','url("'+S7+'white") no-repeat 50% 50%')}else if(color=='multi'){$this.children('span').css('background','url("'+S7+'multicolour") no-repeat 50% 50%')}else{$this.children('span').css('background','url("'+S7+color+'") no-repeat 50% 50%')}})
$(".left_column .accordion dd a").on({click:$.proxy(this.plpLoader,this)})},setRolloverImg:function(){var _self=this;$('.products_row li img.product_img').each(function(){var $this=$(this),roll_img
if($this.attr('data-hover')!=undefined){if(_self._currentView=='p'){roll_img=$this.attr('data-hover')}else{roll_img=$this.attr('data-original')}
$this.after('<img src="'+roll_img+'" alt"" class="rollover_img" />')}})},plpLoader:function(o){if(!$(o.target).parent().hasClass('disabled'))
Harrods.Mixins.gLoader($(".right_column"))},getView:function(){$('.products_row li .product_img').hide();this.setRolloverImg();var _self=this
if(window.localStorage){try{if(localStorage.getItem('currentView')!=null){_self._currentView=localStorage.getItem('currentView')
_self.setView(_self._currentView,false)}else{_self.setView(_self._currentView,false)}}catch(e){console.log('error setting current view : '+this._currentView)}}},altImgClick:function(evt){evt.preventDefault();var $this=$(evt.target),$img_src,$rollimg
if(this._currentView=='m'){$img_src=$this.attr('href').replace('-s','-f?$productlistpage$');$rollimg=$this.attr('href').replace('-s','?$productlistpage$');}else{$img_src=$this.attr('href').replace("-s",'?$productlistpage$')
$rollimg=$this.attr('href').replace('-s','-f?$productlistpage$');}
if(this._isBeddingPLP||this._isTowelsPLP){var parentId=$this.attr('data-parentprodid');var colour=$this.attr('data-pcolour').toUpperCase();var imgPreset='?$productlistpage$';if(this._isBeddingPLP){imgPreset='?$productlistpagebedding$';}
$img_src=S7+parentId+'-'+colour+imgPreset;$rollimg=S7+parentId+'-'+colour+imgPreset;}
$this.parents('li').find('.product_img').attr('src',$img_src)
if($this.parents('li').find('.rollover_img').length>0){$this.parents('li').find('.rollover_img').attr('src',$rollimg)}
$this.siblings().removeClass('active')
$this.addClass('active');var $fav_it=$this.parents('li').find('.fav_it'),$productId=$this.parents('li').find('.product_img').first().attr('alt'),$pnewid=$this.text().replace('#',''),$href=$this.parents('li').find('a').first(),$originalhref=$href.attr('data-originalhref'),$newUrl=$originalhref;if(this._isBeddingPLP||this._isTowelsPLP){$productId='';$pnewid='';}
if($originalhref.indexOf('?p=')>0){$newUrl=$originalhref.replace('?p='+$productId,'?');}
if(this._currentView=='m'){$newUrl=$newUrl.replace('?','?v=1&p='+$pnewid+($newUrl.indexOf('?')>0?'&':''));}else{$newUrl=$newUrl.replace('?','?p='+$pnewid+($newUrl.indexOf('?')>0?'&':''));}
$href.attr('href',$newUrl.replace('&&','&'))},onImgNavOver:function(evt){var $this=$(evt.target)
$this.parents('a').find('.black_box').stop().animate({opacity:.7})
$this.parents('a').find('.text_c').stop().animate({opacity:1})},onImgNavOut:function(evt){var $this=$(evt.target)
$this.parents('a').find('.black_box, .text_c').stop().animate({opacity:0})},modelView:function(evt){evt.preventDefault();var $this=$(evt.target)
if(!$this.hasClass('active')){this.setView('m')}},productView:function(evt){evt.preventDefault();var $this=$(evt.target)
if(!$this.hasClass('active')){this.setView('p')}},setView:function(view){var _self=this,view=view
$('.products_row li .product_img').fadeTo(300,0);if(view=='m'){$('.product_view').removeClass('active')
$('.model_view').addClass('active')
$('.products_row li .product_img').each(function(){var $this=$(this),imgsrc=$this.attr('src'),splits=imgsrc.split('?'),ahref=$this.siblings('h3').find('a').attr('href')
if(splits[1]!=null){$this.attr('src',splits[0]+'-f?'+splits[1]).stop().fadeTo(450,1)}else{$this.attr('src',splits[0]+'-f?').stop().fadeTo(450,1)}
$this.siblings('h3').find('a').attr('href',ahref.replace('?','?v=1&'));if($this.attr('data-hover')!=undefined){if($this.attr('data-original')!=undefined){$this.siblings('.rollover_img').attr('src',$this.attr('data-original'));}else{$this.siblings('.rollover_img').attr('src',imgsrc);}}})}else{$('.model_view').removeClass('active')
$('.product_view').addClass('active')
$('.products_row li .product_img').each(function(){var $this=$(this),imgsrc=$this.attr('src'),splits=imgsrc.split('-f'),ahref=$this.siblings('h3').find('a').attr('href')
if(splits[1]!=null){$this.attr('src',splits[0]+splits[1]).stop().fadeTo(450,1)}else{$this.attr('src',splits[0]).stop().fadeTo(450,1)}
$this.siblings('h3').find('a').attr('href',ahref.replace('?v=1&','?'));if($this.attr('data-hover')!=undefined){$this.siblings('.rollover_img').attr('src',$this.attr('data-hover'));}else{$this.siblings('.rollover_img').attr('src',imgsrc);}})}
localStorage.removeItem('currentView')
localStorage.setItem('currentView',view)
this._currentView=localStorage.getItem('currentView')},productImgClick:function(evt){var $this=$(evt.target)
$url=$this.siblings('h3').find('a').attr('href')
window.location=$url},productImgOver:function(evt){var $this=$(evt.target)
if($this.attr('data-hover')!=undefined){$this.stop(true,true).animate({'opacity':0},200)}},productImgOut:function(evt){var $this=$(evt.target)
if($this.attr('data-hover')!=undefined){$this.stop(true,true).animate({'opacity':1},200)}}}));Hrd.define('Harrods.Register',Hrd.extend({_loader:'<img src="/new_images/zoomloader.gif" class="small_loader" alt="Loading ..." />',_validIcon:"<img src='/new_images/basket_checkout/v_icon.gif' alt='Valid' />",_notValidIcon:"<img src='/new_images/basket_checkout/not_v_icon.gif' alt='Invalid' />",_emailReg:Harrods.Regex.email,_passReg:Harrods.Regex.password,_postcodeReg:Harrods.Regex.postcode,_rewardReg:Harrods.Regex.reward,_spaceReg:Harrods.Regex.space,_returnUrl:Harrods.Mixins.getQueryString("ReturnUrl"),_personalDetails:{},init:function(config){Hrd.apply(this._config,config);$("[ID$='divFindAddress']").hide();$("[ID$='drpInsightCountryList']").val('GB');this.setAddressFieldLayout('GB',1);$("input[@name='rewardcardoption']:radio").on('click',$.proxy(this.rewardCardOption,this));$("[ID$='drpInsightHomePhone']").on('change',$.proxy(this.updatePhoneDd,this));$("[ID$='txtPassword']").on('blur',$.proxy(this.validatPassword,this));$("[ID$='txtEmail']").on('blur',$.proxy(this.validatEmail,this));$("#txtRewardsCardNumber").on('blur',$.proxy(this.validatRCard,this));$("[ID$='btnRegister']").on('click',$.proxy(this.registerNewAccount,this));$("#btnFindAddress").on('click',$.proxy(this.FindAddress,this));$("#btnEnterFullAddress").on('click',$.proxy(this.EnterFullAddress,this));$("#btnLookupUSAddress").on('click',$.proxy(this.LookupUSAddress,this));$("[ID$='ddAddressList']").on('change',$.proxy(this.ddAddressList,this));$("[ID$='drpInsightCountryList']").on('change',$.proxy(this.drpInsightCountryList,this));},rewardCardOption:function(){var rewardoptionval=$("input[@name='rewardcardoption']:checked").val();if(rewardoptionval=='newrewardcard'){$("#divHaveRewardCard").slideUp("slow");}else if(rewardoptionval=='haverewardcard'){$("#divHaveRewardCard").slideDown("slow");}else{$("#divHaveRewardCard").slideUp("slow");}},updatePhoneDd:function(){if($("[ID$='drpInsightWorkPhone']").val()==""){$("[ID$='drpInsightWorkPhone']").val($("[ID$='drpInsightHomePhone']").val());}
if($("[ID$='drpInsightHomeMobile']").val()==""){$("[ID$='drpInsightHomeMobile']").val($("[ID$='drpInsightHomePhone']").val());}
if($("[ID$='drpInsightHomeMobile']").val()==""){$("[ID$='drpInsightWorkMobile']").val($("[ID$='drpInsightHomePhone']").val());}},validatPassword:function(){var password=$("[ID$='txtPassword']").val();if(!this._passReg.test(password)){$("#valid_password_feedback").empty().html(this._notValidIcon);}else{$("#valid_password_feedback").empty().html(this._validIcon);}},validatEmail:function(){var eMailVal=$.trim($("[ID$='txtEmail']").val())
if(eMailVal==''||!this._emailReg.test(eMailVal)){$("#valid_email_feedback").empty().html(this._notValidIcon);}else{$("#valid_email_feedback").empty().html(this._validIcon);}},validatRCard:function(){var rewardcard=$.trim($("#txtRewardsCardNumber").val())
if(!this._rewardReg.test(rewardcard)){$("#valid_rewardcard_feedback").empty().html(this._notValidIcon);}else{$("#valid_rewardcard_feedback").empty().html(this._validIcon);}},FindAddress:function(evt){var $this=$(evt.target),countryCode=$("[ID$='drpInsightCountryList']").val();$this.parents('.txtPostcode').removeClass('error');$this.parents('.txtPostcode').siblings('.txtAddressLine1').removeClass('error');$this.parents('.txtPostcode').siblings('.txtCountry').removeClass('error');$(".error_c").remove();$(".error").removeClass("error");if(countryCode==''){$this.parents('.txtPostcode').before('<li class="error_c"><p class="error">Please enter a postcode.</p></li>').addClass('error');$this.parents('.txtPostcode').children("[ID$='txtInsightPostCode']").focus();}else if(countryCode!='GB'){$this.parents('.txtPostcode').siblings('.txtCountry').before('<li class="error_c"><p class="error">Please select UK.</p></li>').addClass('error');}else{$this.parent('span').append(this._loader);var error_div=$('#ErrorAdd');this.findAddress(error_div);}
return false;},EnterFullAddress:function(evt){var $this=$(evt.target),countryCode=$("[ID$='drpInsightCountryList']").val();this.GetRegionalLabels(countryCode);$(".full").show();$('#Options1, #Options3, .short').hide();return false;},LookupUSAddress:function(evt){var $this=$(evt.target)
$this.parents('.txtPostcode').removeClass('error');$this.parents('.txtPostcode').siblings('.txtAddressLine1').removeClass('error');$this.parents('.txtPostcode').siblings('.txtCountry').removeClass('error');$(".error_c").remove();if($this.parents('.txtPostcode').siblings('.txtAddressLine1').children("[ID$='txtAddressLine1']").val()==''){$this.parents('.txtPostcode').siblings('.txtAddressLine1').before('<li class="error_c"><p class="error">Please enter Address Line 1.</p></li>').addClass('error');$this.parents('.txtPostcode').siblings('.txtAddressLine1').children("[ID$='txtAddressLine1']").focus();}
else if($this.parents('.txtPostcode').children("[ID$='txtInsightPostCode']").val()==''){$this.parents('.txtPostcode').before('<li class="error_c"><p class="error">Please enter a Zipcode.</p></li>').addClass('error');$this.parents('.txtPostcode').children("[ID$='txtInsightPostCode']").focus();}
else if($this.parents('.txtPostcode').siblings('.txtCountry').children('select').val()!='US'){$this.parents('.txtPostcode').siblings('.txtCountry').before('<li class="error_c"><p class="error">Please select US.</p></li>').addClass('error');}else{$this.parent('span').append(this._loader);var error_div=$('#ErrorAdd');this.lookupUSAddress(error_div);}
return false;},ddAddressList:function(){if($("[ID$='ddAddressList']").is(":visible")){var error_div=$('#ErrorAdd');this.selectAddress(error_div);}},drpInsightCountryList:function(evt){var $this=$(evt.target),rootthis=$this.parents('.txtCountry').siblings('.txtCounty');this.setAddressFieldLayout($this.val(),1);},registerNewAccount:function(e){e.preventDefault();invalid="false";$(".error_c").remove();$('.to_from li').removeClass('error');$('#ErrorAdd').empty().hide();this.removeErrorMessages();var _self=this
var title=$("[ID$='_drpUserTitle']");if(title.val()=='Please Select'){invalid="true";this.addValError(title,'Please select a title');}
var firstname=$("[ID$='txtFirstName']");this.validateMandatoryField(firstname,'First name is required');var lastname=$("[ID$='txtLastName']");this.validateMandatoryField(lastname,'Last name is required');var eMailNew=$("[ID$='txtEmail']");this.validateMandatoryField(eMailNew,'Email is required');var eMailConfirm=$("[ID$='txtConfirmEmail']");this.validateMandatoryField(eMailConfirm,'Confirm Email is required');if($.trim(eMailNew.val())!=''&&!this._emailReg.test($.trim(eMailNew.val()))){invalid="true";this.addValError(eMailNew,'Incorrect Email');}
if(eMailConfirm.val()!=eMailNew.val()){invalid="true";this.addValError(eMailConfirm,'Email entered doesn\'t match with confirm Email value');}
var password=$("[ID$='txtPassword']");this.validateMandatoryField(password,'Account Password is required');if($.trim(password.val())!=''&&!this._passReg.test(password.val())){invalid="true";this.addValError(password,'Incorrect Password');}
var passwordConfirm=$("[ID$='txtPasswordConfirm']");this.validateMandatoryField(passwordConfirm,'Confirm Password is required');if(password.val()!=passwordConfirm.val()){invalid="true";this.addValError(passwordConfirm,'Password entered doesn\'t match with confirm Password value');}
var countryCode=$("[ID$='drpInsightCountryList']");this.validateMandatoryField(countryCode,'Country is Required');this.validateMandatoryField($("#txtInsightAddressLine1"),'Line 1 is Required');this.validateMandatoryField($("#txtInsightCity"),'City is Required');if(countryCode.val()=="AU"){this.validateMandatoryField($("#txtRegionNameAu"),'County is Required');}else if(countryCode.val()=="CA"){this.validateMandatoryField($("#txtRegionNameCa"),'County is Required');}else if(countryCode.val()=="JP"){this.validateMandatoryField($("#txtRegionNameJp"),'County is Required');}else if(countryCode.val()=="US"){this.validateMandatoryField($("#txtRegionNameUs"),'County is Required');}
else{this.validateMandatoryField($("#txtInsightCounty"),'County is Required');}
if(!this._postcodeReg.test($("#txtInsightPostCode").val())){if(countryCode.val()=="GB"){this.addValError($("#txtInsightPostCode"),'Postcode is incorrect');invalid="true";}}
var TelephoneNumberCountryCode=$("[ID$='drpInsightHomePhone']").val();var TelephoneNumber=$("[ID$='txtInsightHomePhone']").val();var TelephoneNumber1CountryCode=$("[ID$='drpInsightHomeMobile']").val();var TelephoneNumber1=$("[ID$='txtInsightHomeMobile']").val();if(TelephoneNumber==""){if(TelephoneNumber1==""){invalid="true";$("[ID$='txtInsightHomeMobile']").parent('li').before('<li class="error_c"><p class="error">Please enter at least one telephone number</p></li>').addClass('error');}else if(!/^([0-9]*[1-9][0-9]*)$/.test(TelephoneNumber1)||TelephoneNumber1.length<6){invalid="true";$("[ID$='txtInsightHomeMobile']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(TelephoneNumber1!=""&&TelephoneNumber1CountryCode==""){invalid="true";$("[ID$='txtInsightHomeMobile']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}}else if(!/^([0-9]*[1-9][0-9]*)$/.test(TelephoneNumber)||TelephoneNumber.length<6){invalid="true";$("[ID$='txtInsightHomePhone']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(TelephoneNumber!=""&&TelephoneNumberCountryCode==""){invalid="true";$("[ID$='txtInsightHomePhone']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
if(TelephoneNumber1==""){if(TelephoneNumber==""){invalid="true";$("[ID$='txtInsightHomePhone']").parent('li').before('<li class="error_c"><p class="error">Please enter at least one telephone number</p></li>').addClass('error');}else if(!/^([0-9]*[1-9][0-9]*)$/.test(TelephoneNumber)||TelephoneNumber.length<6){invalid="true";$("[ID$='txtInsightHomePhone']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(TelephoneNumber!=""&&TelephoneNumberCountryCode==""){invalid="true";$("[ID$='txtInsightHomePhone']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}}else if(!/^([0-9]*[1-9][0-9]*)$/.test(TelephoneNumber1)||TelephoneNumber1.length<6){invalid="true";$("[ID$='txtInsightHomeMobile']").parent('li').before('<li class="error_c"><p class="error">Please enter a valid telephone number without any spaces and special characters</p></li>').addClass('error');}else if(TelephoneNumber1!=""&&TelephoneNumber1CountryCode==""){invalid="true";$("[ID$='txtInsightHomeMobile']").parent('li').before('<li class="error_c"><p class="error">Please enter a country code</p></li>').addClass('error');}
var rewardCardNumber=$("#txtRewardsCardNumber");var countryCodeSelect=$("[ID$='drpCountryList']");var rewardCardOption=this.getRewardCardOption();var referralToken=$("[ID$='hidReferralToken']").val();switch(rewardCardOption){case 0:if($.trim(rewardCardNumber.val())==''){invalid="true";rewardCardNumber.parent('div').before('<li class="error_c checkbox"><p class="error">Reward card number is required</p></li>').addClass('error');}
else if(!this._rewardReg.test(rewardCardNumber.val())){invalid="true";rewardCardNumber.parent('div').before('<li class="error_c checkbox"><p class="error">Reward card number is Incorrect</p></li>').addClass('error');}
break;case 1:if(countryCodeSelect.val()==''||countryCodeSelect.val()=='Please Select'){invalid="true";countryCodeSelect.parent('div').before('<li class="error_c checkbox"><p class="error">Country of residence is required</p></li>').addClass('error');}
break;}
if(rewardCardOption==2){referralToken="";}
var answer=$("[ID$='SecurityQestionAnswerTextbox']");if($.trim(answer.val())==''){invalid="true";this.addValError(answer,'Please enter answer');}
var confirmAnswer=$("[ID$='SecurityQestionConfirmAnswerTextbox']");if($.trim(confirmAnswer.val())==''){invalid="true";this.addValError(confirmAnswer,'Please enter confirm answer');}
if(answer.val()!=confirmAnswer.val()){invalid="true";this.addValError(confirmAnswer,'Answer and confirm answer do not match');}
var question=$("[ID$='SecurityQuestionsDropdown']");if(question.val()==''){invalid="true";this.addValError(question,'Please select a question');}
var acceptTsAndCs=$("[ID$='chkAcceptTsAndCs']");if(acceptTsAndCs.is(":checked")!=true){invalid="true";this.addValError(acceptTsAndCs,'Please accept the Terms and Conditions');}
if(invalid=="false"){this.addLoader($(".register_left"));this._personalDetails.UserTitle=title.val();this._personalDetails.FirstName=firstname.val();this._personalDetails.LastName=lastname.val();this._personalDetails.RewardsCardNumber=rewardCardNumber.val();this._personalDetails.RewardCardOptions=rewardCardOption;this._personalDetails.CountryCode=countryCode.val();var loginDetails={};loginDetails.EmailNew=eMailNew.val();loginDetails.EmailConfirm=eMailConfirm.val();loginDetails.PasswordNew=password.val();loginDetails.PasswordConfirm=passwordConfirm.val();loginDetails.Question=question.val();loginDetails.Answer=answer.val();loginDetails.AnswerConfirm=confirmAnswer.val();loginDetails.AcceptTsAndCs=acceptTsAndCs.is(":checked");var personalPreferences={};var loyaltyCust={};loyaltyCust.CompanyName=$.trim($("#txtInsightCompanyName").val());loyaltyCust.AddressID=$.trim($("#lblInsightAddressID").text());loyaltyCust.AddressLine1=$.trim($("#txtInsightAddressLine1").val());loyaltyCust.AddressLine2=$.trim($("#txtInsightAddressLine2").val());loyaltyCust.City=$.trim($("#txtInsightCity").val());loyaltyCust.County=$.trim($("#txtInsightCounty").val());if(countryCode.val()=="AU"){loyaltyCust.County=$.trim($("#txtRegionNameAu").val());}else if(countryCode.val()=="CA"){loyaltyCust.County=$.trim($("#txtRegionNameCa").val());}else if(countryCode.val()=="JP"){loyaltyCust.County=$.trim($("#txtRegionNameJp").val());}else if(countryCode.val()=="US"){loyaltyCust.County=$.trim($("#txtRegionNameUs").val());}
loyaltyCust.Postcode=$.trim($("#txtInsightPostCode").val());loyaltyCust.CountryCode=countryCode.val();loyaltyCust.CountryName=$("option:selected","[ID$='drpInsightCountryList']").text();loyaltyCust.RewardCardOptions=this.getRewardCardOption();loyaltyCust.ReceiveCardByPost=false;loyaltyCust.LandLinePersonalCountryCode=TelephoneNumberCountryCode;loyaltyCust.LandLinePersonalPhoneNumber=TelephoneNumber;loyaltyCust.MobilePersonalCountryCode=TelephoneNumber1CountryCode;loyaltyCust.MobilePersonalPhoneNumber=TelephoneNumber1;loyaltyCust.ReferralToken=referralToken;$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AccountService.svc/Register",data:JSON.stringify({"personalDetails":this._personalDetails,"loginDetails":loginDetails,"personalPreferences":personalPreferences,"loyaltyCustomer":loyaltyCust}),success:function(data){$.proxy(_self.onRegister(data),_self)}});}else{$('#MessageBox').empty().removeClass();$('#MessageBox').html('Please correct/complete highlighted fields below').addClass('msgboxValidation').show("slow");}
return false;},addLoader:function(theparent){var loadingCover=$("<div></div>");var loadingBg=$("<div></div>");loadingCover.height(theparent.height()).width(theparent.width()+10).addClass("loadingCover");loadingBg.height(theparent.height()).width(theparent.width()+10).addClass("loadingBg");theparent.prepend(loadingBg).prepend(loadingCover);},findAddress:function(errorMsg){var countryCode=$("[ID$='drpInsightCountryList']").val();var houseNumber=$("[ID$='txtInsightAddressLine1']").val();var postCode=$("[ID$='txtInsightPostCode']").val().toLowerCase();var _self=this
errorMsg.hide();$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/FindAddress",data:JSON.stringify({"countryCode":countryCode,"houseNumber":houseNumber,"postCode":postCode}),success:function(data){$.proxy(_self.onFindAddress(data),_self)}});},lookupUSAddress:function(errorMsg){var _self=this;var countryCode=$("[ID$='drpInsightCountryList']").val();var addressLine1=$("[ID$='txtInsightAddressLine1']").val();var city=$("[ID$='txtInsightCity']").val();var zipCode=$("[ID$='txtInsightPostCode']").val();errorMsg.hide();$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/LookupUSAddress",data:JSON.stringify({"countryCode":countryCode,"addressLine1":addressLine1,"city":city,"zipCode":zipCode}),success:function(data){$.proxy(_self.onFindAddress(data),_self)}});},selectAddress:function(){var _self=this;var countryCode=$("[ID$='drpInsightCountryList']").val();var searchStatus=$("[ID$='SearchStatus']").val();var ambiguityId=$('#divFindAddress select')[0].selectedIndex-1;$('#ErrorAddBill').hide();$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/SelectAddress",data:JSON.stringify({"countryCode":countryCode,"searchStatus":searchStatus,"ambiguityId":ambiguityId}),success:function(data){$.proxy(_self.onSelectAddress(data),_self)}});},showSelectedAddressById:function(Id){var _self=this;$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/GetAddress",data:JSON.stringify({"addressId":Id}),success:function(data){$.proxy(_self.onSelectBillingAddress(data),_self)}});},onRegister:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){document.cookie='ReferralToken'+'=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';if(window.s){(function(){var trackresponse=response.d.entityData.InsightCustomerID;if(trackresponse!=null){trackresponse=trackresponse.toString();}
else{trackresponse="";}"use strict";var trackObject={};trackObject.linkTrackVars="events,prop17,pageName";trackObject.linkTrackEvents="event36";trackObject.events="event36";trackObject.prop17="Insight Customer ID: "+trackresponse;trackObject.pageName=s.pageName;s.tl(true,"o","Registration Form Success",trackObject);})();}
if(response.d.entityData.PayrollNumber!=null&&response.d.entityData.PayrollNumber!=''){_self.showRegisterName();$(".loadingCover, .loadingBg").remove();var targetOffset=$('h1').offset().top;$('html,body').animate({scrollTop:targetOffset},"slow");$('#divPersonalAndLoginDetails').hide();$('.accountH2').hide();if(_self.GetNextPage()=="checkout"){$("[ID$='divStaffRegistrationLinkToCheckout']").show();}
else{$("[ID$='divStaffRegistrationLinkToMyAccount']").show();}}
else{this.loadNextPage();}}else{$(".loadingCover, .loadingBg").remove();var targetOffset=$('h1').offset().top;$('html,body').animate({scrollTop:targetOffset},"slow");var errMsg=response.d.errorMessage;var ifbroken=false;if(response.d.errors!=null){$.each(response.d.errors,function(key,val){if(val.Value=="PartialMatch_CustomerInfo"){_self.showRegisterName();$('#divPersonalAndLoginDetails').hide();$('.accountH2').hide();ifbroken=true;if(_self.GetNextPage()=="checkout"){$("[ID$='divPartialMatchLinkToCheckout']").show();}
else{$("[ID$='divPartialMatchLinkToMyAccount']").show();}}
else{errMsg=errMsg+'<br />'+val.Value;}});}
if(ifbroken==false){_self.showMessage("msgboxError",errMsg);}}},removeErrorMessages:function(){$("li.error_c").removeClass('error').empty().hide();$("li.error").removeClass('error');$("div.error").removeClass('error');$('#MessageBox').empty().removeClass();},showMessage:function(type,message){$('#MessageBox').empty().removeClass();$('#MessageBox').html(message).addClass(type).show("slow");},loadNextPage:function(){window.location=this.GetNextPage();},GetNextPage:function(){var new_url=this._returnUrl.substring(0,this._returnUrl.indexOf('&'));if(this._returnUrl){if(this._returnUrl=="checkout"){return this._returnUrl;}
else{return new_url;}}
else{if($("input[@name='rewardcardoption']:checked").val()=='newrewardcard'){return'/account';}
else{return'/account';}}},getRewardCardOption:function(){switch($("input[@name='rewardcardoption']:checked").val()){case"haverewardcard":return 0;case"newrewardcard":return 1;case"norewardcard":return 2;}},showRegisterName:function(){var headText='<h1 class=greenh1> Welcome '+$("[ID$='txtFirstName']").val()+' '+$("[ID$='txtLastName']").val()+'</h>';$("[ID$='divRegisterHeader']").html(headText);},ifCardRequestedByPost:function(){var RCCollectVal=$("#divCollectRewardCardOptionsUK input[@name='cardcollectoption']:checked").val();if(RCCollectVal=="cardcollectpost"){return true;}
return false;},isWholeNumber:function(s){var numbersReg=/^\s*\d+\s*$/;return numbersReg.test(s);},cleanString:function(str){return str.replace(/[^\d]/g,"");},cleanPhoneString:function(strNumber){return strNumber.replace(/[\+]/g,"");},validateMandatoryField:function(field,message){var _self=this;if($.trim(field.val())==''){invalid="true";_self.addValError(field,message);}},addValError:function(field,message){var _self=this;if(field.attr('id')=="txtInsightCounty"||field.attr('id')=="txtRegionNameUs"||field.attr('id')=="txtRegionNameCa"||field.attr('id')=="txtRegionNameJp"||field.attr('id')=="txtRegionNameAu"){field.parents('li.txtCounty').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}else{field.parent('li').before('<li class="error_c checkbox"><p class="error">'+message+'</p></li>').addClass('error');}},onFindAddress:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){$('.small_loader').remove();if(response.d.entityData.addressCount==1){this.onSelectAddress(response);}else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$('#divFindAddress').slideDown("slow");}}else{$('.txtPostcode').before('<li class="error_c"><p class="error">'+response.d.errorMessage+'</p></li>').addClass('error');$('.small_loader').remove();}},onSelectAddress:function(response){if(response.d.isValid&&null!=response.d.entityData){$('.small_loader').remove();if(response.d.entityData.addressCount==1){$.each(response.d.entityData.addressMaster,function(key,value){if($("[ID$='txt"+key+"']")&&value!=null){if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='US'){$("[ID$='txt"+key+"Us']").val(value);$('#ukCounty, #auCounty,#caCounty,#jpCounty').hide();$('#usCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='CA'){$("[ID$='txt"+key+"Ca']").val(value);$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='JP'){$("[ID$='txt"+key+"Jp']").val(value);$('#ukCounty, #auCounty,#caCounty,#usCounty').hide();$('#jpCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='AU'){$("[ID$='txt"+key+"Au']").val(value);$('#ukCounty, #usCounty,#caCounty,#jpCounty').hide();$('#auCounty').show();}else if(key=='RegionName'&&response.d.entityData.addressMaster.CountryName=='GB'){$('#ukCounty').children('label').text('County');$("[ID$='txtInsightCounty']").val(value);$('#auCounty, #usCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();}else{$("[ID$='txtInsight"+key+"']").val(value);};}});this.setAddressFieldLayout(response.d.entityData.addressMaster.CountryName,1);$("[ID$='Short'], #Options1, #Options3, [ID$='divFindAddress']").hide();}
else{$("[ID$='ddAddressList']").append($('<option></option>').val("0").html("Please Select"));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='SearchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$("[ID$='divFindAddress']").slideDown("slow");}}
else{$('#ErrorAddBill').append('<p class="error">'+response.d.errorMessage+'</p>').show();$('.small_loader').remove();}
if(response.d.isValid&&null!=response.d.entityData){}
else{$('#ErrorAddBill').html(response.d.errorMessage).show();}
return false;},setAddressFieldLayout:function(countryCode,full){$('.txtAddressLine1, .txtAddressLine2, .txtCity, .txtCounty, .txtPostcode').show();$('.txtAddressLine1').children('label').text('Address line 1: *');$('.txtCity').children('label').text('Town/City');$('.txtCounty').children('label').text('State/Region');$('.txtPostCode').children('label').text('Postcode/Zipcode');$("#btnFindAddress, #btnLookupUSAddress").hide();if(countryCode=='GB'){$('.txtCountry').find('select').val('GB');$("[ID$='drpInsightHomePhone'], [ID$='drpInsightHomeMobile']").val("+44");$('#usCounty, #auCounty, #caCounty, #jpCounty').hide();$('.txtCity').children('label').text('City: *');$('.txtPostcode').children('label').text('Postcode: *');$("#ukCounty, #btnFindAddress").show();if(full=="0"){$('.txtAddressLine1').children('label').text('House number');$('.txtAddressLine2, .txtCity, .txtCounty').hide();}}
else if(countryCode=='US'){$('#ukCounty, #auCounty,#caCounty,#jpCounty, #btnLookupUSAddress').hide();$('#usCounty').show();$('.txtCity').children('label').text('City');$('.txtPostcode').children('label').text('Zipcode');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='CA'){$('#ukCounty, #auCounty,#usCounty,#jpCounty').hide();$('#caCounty').show();$('.txtCity').children('label').text('City/Municipality');$('.txtPostcode').children('label').text('Postal code');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='AU'){$('#ukCounty, #caCounty,#usCounty,#jpCounty').hide();$('#auCounty').show();$('.txtCity').children('label').text('Suburb');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}
else if(countryCode=='JP'){$('#ukCounty, #auCounty,#usCounty,#caCounty').hide();$('#jpCounty').show();$('.txtCity').children('label').text('City/District');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}
else{$('#usCounty, #auCounty,#caCounty,#jpCounty').hide();$('#ukCounty').show();$('.txtCity').children('label').text('Town');$('.txtPostcode').children('label').text('Postcode');$('.txtCountry').find('select').val(countryCode);}}}));Hrd.define('Harrods.Scene',Hrd.extend({_fopen:false,_nopen:false,_isover:false,_currentView:'p',init:function(config){var _this=this;Hrd.apply(this._config,config);var footer_cols={"0":"130px","1":"90px","2":"140px","3":"75px","4":"85px","5":"335px"};$('.footer_h').each(function(i,v){$(this).css("width",footer_cols[i]);})
if($(".accordion").length>0){$(".accordion").accordions();}
if($('.quick_gallery').length>0){$('#carousel').carousel({moving:'h',interval:600,clip_width:346});}
if($('.plp_gallery').length>0){$('#carousel').carousel({moving:'h',interval:600,clip_width:475});}
if($('.shoot-carousel').length>0){$('#carousel').carousel({moving:'h',interval:600,clip_width:940});}
if($('.brand_logo_carousel_holder').length>0){if($('.brand_logo_carousel_holder .carousel ul li').length>4){$('.carousel').carousel({moving:'h',interval:600,clip_width:180});}else{$('.brand_logo_carousel_holder .carousel .slides').css({'width':'100%','padding':'0'});}}
if($('.furniture_brand').length>0){$('#carousel').carousel({moving:'h',interval:600,clip_width:250});}
if($('.global_advert ul li').length>0){_this.promoMsgSlideshow();}
if(window.favourites!=0){$('.fav-number').show();$('#fav-tool').addClass('active_g');$('.fav-number').text(window.favourites);$('.hasfavs h2 span').text(window.favourites);}
$('footer').on('click mouseleave',$.proxy(this.onFooter,this)).find('#signup_email, #signup_go').click(function(e){return false;});$('#megamenu .subnav').on({click:$.proxy(this.onNavAreaClick,this)});if(this.isIpad){$('body').on('click','#megamenu .topnavlink',$.proxy(this.onClick,this));}else{$('body').on('click.harrods.scene','#megamenu .topnavlink',$.proxy(this.onClick,this));}
$('#signup_email').on({focus:$.proxy(this.onNewsFocus,this),blur:$.proxy(this.onNewsBlur,this),keypress:$.proxy(this.onEmailSignUp,this)});$('#signup_go').on('click',$.proxy(this.onEmailSignUp,this));var $body=$('body');$body.on('focus','#sli_search_1, #search_field2',$.proxy(this.onSearchFocus,this));$body.on('blur','#sli_search_1, #search_field2',$.proxy(this.onSearchBlur,this));$body.on('keypress','#sli_search_1, #search_field2',$.proxy(this.onSearch,this));$body.on('click','#search_submit, #search_go2',$.proxy(this.onSearch,this));$body.on('click','.signin_tn .signout',$.proxy(this.signOut,this));$('#cookie-message').on('click','#close-cookie-message',function(e){e.preventDefault();$(this).parent().fadeOut(500);});$('#site-notification').on('click','#close-site-notification',function(e){var key=$('.hdnNodeId').val();var value=$('.hdnNodeId').val();var expires=new Date();expires.setTime(expires.getTime()+(1*24*60*60*1000));document.cookie=key+'='+value+';expires='+expires.toUTCString();e.preventDefault();$(this).parents().eq(2).fadeOut(500);});if(window.topCat===undefined){topCat='';}
$('#'+window.topCat.replace(/ /g,'-')).addClass('active');var result_modal=['<div class="signup_modal"><div class="close"><img src="/public/img/close.png" /></div><div class="signup_modal_in"><p class="result_title">','</p><p class="result_message">','</p></div></div>'].join('');$('.footer .signup_form').append(result_modal);$('.signup_modal').find('.close').on('click',$.proxy(this.resetSignup,this));$(window).on('scroll',function(){_this.resetSignup();});$("#socialmedia").click(function(){if($(".addthis_toolbox").length==0){var add_this_html='<div class="addthis_toolbox addthis_default_style ">'+'<a class="addthis_counter addthis_pill_style">'+'</a>'+'</div>';$(".socialmedia_c").append(add_this_html);$.getScript('http://s7.addthis.com/js/250/addthis_widget.js#pubid=harrods1',function(){var addthis_config={"data_track_clickback":true};addthis.init();});}});},ready:function(){if(topCat){var c=topCat.replace(/ /g,'-');if(!this._isIpad){$('#nav').find("[ID$='"+c+"']").trigger('click.harrods.scene');$('#nav').find("[ID$='"+c+"']").addClass("active");}
var target=$('#nav').find('#'+c);};$('#megamenu .subnav').append('<a href="#" class="close-megamenu">Hide Menu</a>');if(this._isIpad){$('#megamenu .close-megamenu').addClass('tablet');}
$('body').on('click','#megamenu .close-megamenu',$.proxy(this.onNavOut,this));$('body').on('click','.megamenu-bgr',function(e){e.preventDefault();$('.close-megamenu').trigger('click');});this.bindMegamenu();},onClick:function(evt){var isOpen=$(evt.target).parent().hasClass('opencat');if(this._isIpad&&!isOpen){evt.preventDefault();$('#megamenu').addClass('open');$('#megamenu .nav-link').removeClass('opencat');$(evt.target).parent().addClass('opencat');}
$('#megamenu a').removeClass('active');$(evt.target).addClass('active');if($('body').hasClass('home')&&topCat!='static'&&!this._isIpad){return false;}
else{return true;}},onFooter:function(evt){var isMsgClicked=($(evt.target).parents('.signup_form').length>0)?true:false;if(evt.type==='mouseleave'){if(this._fopen){$('.legal').hide();this.toggleFooterOpen('close');this._fopen=false;}}else if(evt.type==="click"&&!this._fopen&&!isMsgClicked){this.toggleFooterOpen('open');$('.legal').show();this._fopen=true;this.resetSignup();$('body').on('touchstart.harrods.scene',$.proxy(this.closeFooter,this));}},closeFooter:function(evt){var isMsgClicked=($(evt.target).parents('.signup_form').length>0)?true:false;if(!$(evt.target).closest('.footer').length&&this._fopen&&!isMsgClicked){$('.legal').hide();this.toggleFooterOpen('close');this._fopen=false;$('body').off('touchstart.harrods.scene',$.proxy(this.closeFooter,this));}},toggleFooterOpen:function(status){var isTransition=$('html').hasClass('transition');var $footer=$('footer');if(isTransition){$footer.toggleClass('open');}else{if(status==='open'){$footer.stop().css({'overflow':'visible'}).animate({height:'300px'});}else{$footer.stop().css({'overflow':'visible'}).animate({height:'40px'});}}},onSearchFocus:function(evt){$(evt.target).val('');},onSearchBlur:function(evt){if($(evt.target).val()==''){$(evt.target).val('Search harrods.com');}},onSearch:function(e){var evt=window.event||e;function pad(str,max){return str.length<max?pad("0"+str,max):str;}
if(evt.keyCode==13||evt.type=='click'){var $url="/search?for=",$searchval=$('#sli_search_1').val(),searchDefaults=['Enter Search','','Search','Keyword or Product Code','Search harrods.com'];if($.inArray($searchval,searchDefaults)>-1){$searchval=$('#search_field2').val();if($.inArray($searchval,searchDefaults)>-1){alert('Please enter a search keyword');return false;}}
$searchval=$.trim($searchval)
$searchval=$searchval.replace(/[|;$%@"<>^(),]/g,"");$searchval=$searchval.replace(/[&\s]/g,"+")
if($searchval.length>4&&/^\d*$/.test($searchval)){$searchval=pad($searchval,18);}
if($searchval!=""){this.getView();window.location="http://luxury.harrods.com/search?w="+$searchval+"&view="+this._currentView;}
return false;}},onNewsFocus:function(evt){$(evt.target).val('');this.resetSignup();return false;},onNewsBlur:function(evt){if($(evt.target).val()==''){$(evt.target).val('Email Sign up');}},onNavAreaClick:function(evt){if(this._isIpad){if(evt.target.nodeName==='UL'){evt.preventDefault();$('.close-megamenu').trigger('click');}}},onNavOut:function(e){e.preventDefault();$('#megamenu').removeClass('open');$('#megamenu .topnavlink').removeClass('opencat');$('.megamenu-bgr').hide();},signOut:function(){$.ajax({type:"GET",url:"/UIServices/Account/PersonalisationService.svc/Signout",data:{},success:this.onSignout});return false;},onSignout:function(response){if(response.d.IsValid){localStorage.clear();window.location="~/";window.location.reload();}},onEmailSignUp:function(evt){if(evt.type=='keypress'&&evt.keyCode==13||evt.type=='click'){var title="Please try again",message="";var email=$('#signup_email').val();evt.preventDefault();$('#signup_go').focus();if(email==""||!Harrods.Regex.email.test(email)){title='';message='Please enter a valid email address.';tclass='email_error1';this.showEmailSignUpResult(title,message,tclass);$('#signup_email').addClass('signup-error');}
else{var _self=this;$.ajax({type:"POST",url:"/UIServices/Account/PersonalisationService.svc/EmailSignUpInitiate",data:'{"emailAddress":"'+email+'"}',contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:function(data){if(typeof window.s!="undefined"){s.manuallyTrackInteraction("Email Signup Start",{"eVar23":"Footer Email Signup: "+s.pageName})}},success:function(data){$.proxy(_self.onSignup(data),_self)}});}}},resetSignup:function(){$('.signup_modal').fadeOut(function(){$('.signup_modal').removeClass('email_error1 email_error2 have_acc have_news thank_you');});$('#signup_email').removeClass('signup-error');},onSignup:function(response){var title="",message="",tclass='';if(response.d.isValid){if(response.d.entityData=="AlreadyRegisteredMessage"){title="You already have a Harrods account";message="To sign up to receive Harrods e-newsletters please log in to your account and edit your communication preferences.";tclass='have_acc';$('#signup_email').addClass('signup-error');}
else if(response.d.entityData=="AlreadySignedUpMessage"){title="You have already signed up to receive Harrods e-newsletters";message="Please check your junk or spam folders and your email security settings.<br /> You may also sign up to receive our e-newsletters with an alternative email address.";tclass='have_news';$('#signup_email').addClass('signup-error');}
else{title="Thank you";message="You have successfully subscribed to Harrods e-newsletters.";tclass='thank_you';if(typeof window.s!="undefined"){s.manuallyTrackInteraction("Email Signup Complete",{"events":"event3"})}}}
else{title='Sorry';message='We were unable to add this address to our mailing list. Please enter a valid email address.<br/> You may also sign up with an alternative email address.';tclass='email_error2';$('#signup_email').addClass('signup-error');}
this.showEmailSignUpResult(title,message,tclass);},showEmailSignUpResult:function(title,message,tclass){var result_modal=$('.signup_modal');result_modal.addClass(tclass).find('.result_title').html(title).end().find('.result_message').html(message).end().css({'display':'block','opacity':'1'});},onClose:function(){this.resetSignup();},getView:function(){var _self=this;if(window.localStorage){try{if(localStorage.getItem('currentView')!=null){_self._currentView=localStorage.getItem('currentView')}}catch(e){console.log('error setting current view : '+this._currentView)}}},promoMsgSlideshow:function(){var len=$(".global_advert ul li").length;var el_arr=[];var t=5000;var i=0;var fn=function(){i++;i=(i>len-1)?0:i;$(".global_advert ul li").removeClass('active');el_arr[i].addClass('active');};$(".global_advert ul li").each(function(){el_arr.push($(this));});fn();setInterval(fn,t);},bindMegamenu:function(){var timer;var w=window.innerWidth;var h=window.innerHeight;if($('.megamenu-bgr').length===0){$('#main').append('<div class="megamenu-bgr" style="height:'+h+'px;"></div>');}
if(!this._isIpad){$('#megamenu #nav').hover(function(){timer=setTimeout(function(){$('.megamenu-bgr').height(window.innerHeight+'px').show();$('#megamenu').addClass('active');},300);},function(){clearTimeout(timer);$("#megamenu").removeClass('active');$('.megamenu-bgr').hide();});}else{$('#megamenu #nav').click(function(evt){var $target=$(evt.target);if(!$target.hasClass('close-megamenu')&&!$target.hasClass('subnav')){$('.megamenu-bgr').height(window.innerHeight+'px').show();$('#megamenu').addClass('active');}});}}}));!function($){$.fn.tabs=function(){return this.each(function(){var $tabs=this,$div=$($tabs).find('.tabs_c_div'),$firstdiv=$($tabs).find('.tabs_c_div:first'),$li=$($tabs).find('ul li'),$firstli=$($tabs).find('ul li:first'),$a=$($tabs).find('ul li a')
$($div).hide();$($firstdiv).show();$($firstli).addClass('active');$a.bind('click',onAClick);function onAClick(evt){$li.removeClass('active');$(evt.target).parent().addClass('active');var currentTab=$(evt.target).attr('href');$div.hide();$(currentTab).show();return false;}})}}(window.jQuery);Harrods.Templates={toolmodal:'<div class="toolmodal"><div class="close"><img src="/public/img/close.png" /></div></div>',result_modal:'<div class="signup_modal"><div class="close"><img src="/public/img/close.png" /></div><div class="signup_modal_in"><p class="result_title"></p><p class="result_message"></p></div></div>',add_this_html:'<div class="addthis_toolbox addthis_default_style "><a class="addthis_counter addthis_pill_style"></a></div>',swatch_modal:'<div class="swatch_modal"><div class="swatch_modal_in"><div class="swatch_color"></div><div class="swatch_info"><p class="swatch_name f_left"></p><p class="swatch_price f_right"></p></div></div></div>',tooltip_modal:'<div class="tooltip_modal"><div class="tooltip_modal_in"></div></div>'};Harrods.Regex={email:/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/,password:/^.*(?=.{6,})(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*$/,postcode:/^([Gg][Ii][Rr]0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9]?[A-Za-z])))){0,1}[0-9][A-Za-z]{2})$/,reward:/^7042[0-9]{12}$/,space:/\s/}
Harrods.Mixins={getQueryString:function(qitem){var qs=location.search.replace('?','').split('&'),val="";for(var i=0;i<qs.length;i++){if(qs[i].split('=')[0]==qitem){val=qs[i].split('=')[1];}}
return val;},gLoader:function(theparent){var loadingCover=$("<div class='loadingCover'></div>"),loadingBg=$("<div class='loadingBg'></div>")
loadingCover.height(theparent.height()).width(theparent.width()+10);loadingBg.height(theparent.height()).width(theparent.width()+10);theparent.prepend(loadingBg).prepend(loadingCover);},removeGLoader:function(){$(".loadingCover, .loadingBg").remove();},pad:function(str,max){return str.length<max?pad("0"+str,max):str;},encodeUrl:function(string){return escape(this._utf8_encode(string));},decodeUrl:function(string){return this._utf8_decode(unescape(string));},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}};Hrd.define('Harrods.Tools',Hrd.extend({init:function(config){Hrd.apply(this._config,config);$('.tool').addClass('off').on({click:$.proxy(this.onClick,this),mouseover:$.proxy(this.onHover,this),mouseout:$.proxy(this.onHover,this)});},onHover:function(e){var tool=$(e.target);if(tool.hasClass('off')){tool.removeClass('off').addClass('on');}else{tool.removeClass('on').addClass('off');}},onClick:function(e){if(this.tool!=undefined)this.tool.close();this.clicked=true;var content=$(e.target).attr('id').replace(/-tool/,'-block');$content=$("#"+content);$('.result, .error_message').addClass('hidden');this.tool=new Harrods.Tools.Modal({target:$(e.target),content:$content});}}));Hrd.define('Harrods.Tools.Modal',Hrd.extend({init:function(config){Hrd.apply(this._config,config);this.view=new Harrods.Modal(this._config);this.model=new Harrods.Tools[$(this._config.target).attr('id').replace(/-tool/,'')];},openModal:function(){},onData:function(data){this.openModal();},close:function(){this.view.close();}}));Hrd.define('Harrods.Tools.az',Hrd.extend({init:function(config){this.currentCat='siteroot';$('.az_letters a').on('click',$.proxy(this.onLetter,this));$('.az_letters a.az_all').on('click',$.proxy(this.loadAll,this));this.loadAll();},onLetter:function(e){e.preventDefault();var $this=$(e.target),brandsbox=$('#currentBlock .brands_list_w #brands_list .content')
$('.az_letters a').removeClass('active')
$this.addClass('active');if($this.hasClass('disabled')){brandsbox.empty().append('<p>No brands under this category.</p>')}else{var letter=$this.text(),category;if(topCat.indexOf("new")!=-1){category=topCat;}else{category='siteroot';}
$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UiServices/CatalogService.svc/GetBrands",data:{category:category,startsWith:letter},success:this.onData});}},onData:function(data){var brandsbox=$('#currentBlock .brands_list_w #brands_list .content'),brands=data.entityData.children,isvalid=data.IsValid,$frag=document.createDocumentFragment(),b=brands.length,i=0;brandsbox.empty();if(isvalid){while(i!=b){var $a=document.createElement('a');$a.innerHTML=brands[i].dn;$a.setAttribute('href',brands[i].url);$frag.appendChild($a);i++;}
brandsbox.append($frag.cloneNode(true));$("#brands_list.nano").nanoScroller();}},loadAll:function(){var topc;if($("body").hasClass("home")){topcat='siteroot';}else{topc=topCat;}
$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UiServices/CatalogService.svc/GetBrands",data:{category:topc,startsWith:''},success:this.onData});}}));Hrd.define('Harrods.Tools.info',Hrd.extend({init:function(config){$('#contactUsForm input:text, #contactUsForm textarea , #signUpForm input:text').on({focus:$.proxy(this.onCcInputFocus,this),blur:$.proxy(this.onCcInputBlur,this)});$('#signup').on('click',$.proxy(this.signUpFlyout,this));$('#emailSignUp').on('keypress',$.proxy(this.signUpFlyout,this));$('#send_email').on('click',$.proxy(this.sendEmail,this));},onCcInputFocus:function(e){var $this=$(e.target);$this.attr('data-label',$this.val());$this.val('').removeClass('error');$('.result, .error_message').addClass('hidden');},onCcInputBlur:function(e){var $this=$(e.target);if($this.val()==''){$this.val($this.attr('data-label'));}},signUpFlyout:function(e){if(e.type==='click'||(e.type==='keypress'&&e.keyCode==13)){e.preventDefault();var email=$('#emailSignUp').val(),hasError=false,_self=this,erex=Harrods.Regex.email;$('.result').addClass('hidden');$('#emailSignUp').removeClass('error');if(email==''||email=='Enter email address'||!erex.test(email)){$('#emailSignUp').addClass('error');hasError=true;}
if(!hasError){$.ajax({type:"POST",url:"/UIServices/Account/PersonalisationService.svc/EmailSignUpInitiate",data:'{"emailAddress":"'+email+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(data){$.proxy(_self.onSignUpFlyout(data),_self)}});}else{var message="This email address is invalid";$('.result').text(message).addClass('error').removeClass('hidden');}}},onSignUpFlyout:function(rsp){var message="",isvalid=rsp.d.isValid,rdata=rsp.d.entityData,resbox=$('.result');if(isvalid){if(rdata=="AlreadyRegisteredMessage"){message='You already have a Harrods account. To sign up to receive Harrods e-newsletters please log in to your account.';resbox.addClass('error');}
else if(rdata=="AlreadySignedUpMessage"){message='You have already signed up to receive Harrods e-newsletters. Please check your junk or spam folders.';resbox.addClass('error');}
else{message='You have successfully subscribed to Harrods e-newsletters.';resbox.removeClass('error');}}
else{resbox.addClass('error');message='We were not able to add your email address to our mailing list, please try with a different email address.';}
resbox.text(message).removeClass('hidden');},sendEmail:function(evt){evt.preventDefault();var name=$('#NameBox').val(),phone=$('#PhoneBox').val(),email=$('#EmailBox').val(),enqType=$('#SubjectBox').val(),message=$('#MessageBox').val(),hasError=false,_self=this,cform=$('#contactUsForm'),erex=Harrods.Regex.email;cform.find('.error_message').addClass('hidden');cform.find('input, text-area').removeClass('error');if(name==''||name=='Name'){$('#NameBox').addClass('error');hasError=true;}
if(phone==''||phone=='Phone'){$('#PhoneBox').addClass('error');hasError=true;}
if(email==''||email=='Email'||!erex.test(email)){$('#EmailBox').addClass('error');hasError=true;}
if(enqType==''||enqType=='Subject'){$('#SubjectBox').addClass('error');hasError=true;}
if(message==''||message=='Your Message'){$('#MessageBox').addClass('error');hasError=true;}
if(!hasError){$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/PersonalisationService.svc/SendEmail",data:'{"email":"'+email+'", "enquireType": "'+enqType+'", "name":"'+name+'", "phone":"'+phone+'", "message": "'+message+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:function(data){$.proxy(_self.onSendEmail(data,evt),_self)}});}
else{cform.find('.error_message').removeClass('hidden');}},onSendEmail:function(rsp){var isvalid=rsp.d.IsValid
if(isvalid){$('.contactUsThanks').removeClass('hidden');}}}));Hrd.define('Harrods.Tools.fav',Hrd.extend({_currblk:$('#currentBlock'),init:function(config){Hrd.apply(this._config,config);var currblk=$('#currentBlock')
currblk.find('.nofavs, .hasfavs').hide();if(Harrods.isuser){this._currblk.find(".logout").hide();}
if(typeof sli_search_page!="undefined"){$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UIServices/ExternalService.svc/GetTop3FavouritesById",data:{id:sli_custid},success:this.onFavs});return false;}
else{$.ajax({type:"GET",cache:false,url:PROTOCOL+WEBROOT+"/UIServices/favourites/FavouritesService.svc/GetTop3Favourites",data:{},success:this.onFavs});}},onFavs:function(rsp){var $frag=document.createDocumentFragment(),isvalid=rsp.IsValid,$li=document.createElement('li'),currblk=$('#currentBlock');if(isvalid){var favs=rsp.entityData,favsno=favs.length,context=rsp.Context,contextno=context.length;for(var i in context){if(context[i].Key=="favCount"&&context[i].Value!="0"){$('.fav-number').text(context[i].Value).show();currblk.find('.hasfavs h3 span').text(context[i].Value);}}
if(favs.length>0){currblk.find('.hasfavs').show();currblk.find('.fav_pan_products').empty();for(var f=0;f<favs.length;f++){if(favs.hasOwnProperty(f)){if(f==2){$li.className="last";}
$li.innerHTML="<a href="+favs[f].DetailUrl+"><img src=\""+favs[f].ImageUrl+"\"/></a>";$frag.appendChild($li);currblk.find('.fav_pan_products').append($frag.cloneNode(true));}}}else{currblk.find('.nofavs').show();}}}}));Hrd.define('Harrods.Videos',Hrd.extend({init:function(config){Hrd.apply(this._config,config);if($('.video_page').length>0){$(window).on('resize',$.proxy(this.updateDimensions,this));$("#main").css({'background-color':'#000000'});this.updateDimensions();var url=$('#videos').attr('data-src');jwplayer("video-receipt").setup({flashplayer:"/public/jwplayer/player.swf",file:url,height:"100%",width:"100%",skin:'/public/jwplayer/harrods/harrods.xml'});}
if($('#b_videos').length>0){var img=$('#b_videos').attr('data-img'),file=$('#b_videos').attr('data-file'),w=$('#b_videos').width(),h=$('#b_videos').height()
jwplayer("b_video").setup({flashplayer:'/public/jwplayer/player.swf',skin:'/public/jwplayer/harrods/harrods.xml',image:img,height:h,width:w,levels:[{file:file+".mp4"},{file:file+".webm"},{file:file+".ogg"}]});}
if($('#plp_videos').length>0){var img=$('#plp_videos').attr('data-img'),file=$('#plp_videos').attr('data-file'),w=$('#plp_videos').width(),h=$('#plp_videos').height()
jwplayer("plp_video").setup({flashplayer:'/public/jwplayer/player.swf',skin:'/public/jwplayer/harrods/harrods.xml',image:img,height:h,width:w,levels:[{file:file+".mp4"},{file:file+".webm"},{file:file+".ogg"}]});}
if($('.audio_placeholder').length>0){$('.audio_placeholder').each(function(){var $this=$(this);var thisID=$this.attr('id');var thisAudio=$this.attr('data-audio');jwplayer(thisID).setup({'flashplayer':'/Public/jwplayer/player.swf','file':thisAudio,'backcolor':'000000','frontcolor':'FFFFFF','lightcolor':'FFFFFF','screencolor':'FF0000','controlbar':'bottom','width':'470','height':'24'});});}},updateDimensions:function(){var h=$(window).height()-($('header').height()+$('footer').height()+5);$('#videos').css({marginTop:$('header').height()});$('#videos').height(h);}}));var video=new Harrods.Videos();(function($){replyObj={},errorClass='',errors=[],fields={};Validation=function(){rules={string:function(value){var regex=new RegExp("[a-zA-Z0-9\s]","");return value.match(regex)?true:false;},url:function(value){var regex=new RegExp('(ftp|http|https)','ig');return value.match(regex)?true:false;},email:function(value){var regex=new RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])","");return value.match(regex)?true:false;}}
return{getRule:function(name){return rules[name];},addRule:function(name,rule){rules[name]=rule;}}}
Form=function(form){errors.length=0;form.find("[data-vtype]").each(function(){_this=$(this);name=_this.attr('name');fields[name]=new Field(_this);fields[name].validate();});}
Field=function(field){this.field=field;this.name=field.attr('name');this.type=field.attr('data-vtype');this.msg=field.attr('data-vmsg');this.value=field.val();this.valid=false;}
Field.prototype={validate:function(){var obj=this,field=obj.field,rule=$.Validation.getRule(obj.type);if(rule!=undefined){replyObj[obj.name]={};if(rule(obj.value)==false){field.addClass($.Validation.errorClass);replyObj[obj.name].valid=false;replyObj[obj.name].reply=obj.msg;errors.push('false');}else{field.removeClass($.Validation.errorClass);replyObj[obj.name].valid=true;replyObj[obj.name].reply=obj.value;}
if(errors.length!=0){replyObj.valid=false;}else{replyObj.valid=true;}}}}
$.extend($.fn,{validation:function(callback,opt){if(typeof opt==='object'){for(var key in opt){var obj=opt[key];if(key=='errorClass'){$.Validation.errorClass=obj;}else if(key=='target'){replyObj.target=obj;}else{$.Validation.addRule(key,obj);}}}
var form=new Form($(this));return callback(replyObj);}});$.Validation=new Validation();})(jQuery);Hrd.define('Harrods.Competition',Hrd.extend({_comp_entry:{},init:function(){this._self=this;this.loadCountries();$('body').on("click",'#comp_submit_bt',$.proxy(this.onFormSubmit,this));$("#btnFindAddress").on('click',$.proxy(this.findAddress,this));$('#txtCountryName').on('change',$.proxy(this.showHideFindAddress,this));$("[ID$='ddAddressList']").on('change',$.proxy(this.ddAddressListSelect,this));},onFormSubmit:function(e){e.preventDefault();$('.errorText').remove();$("#competitionForm").validation(this.onValid,{errorClass:'errorClass',target:this})},onValid:function(obj){var _self=obj.target;if(obj.valid==true){_self.enterComp();}else{for(var key in obj){var vObject=obj[key];if(vObject.valid==false){$("input[name='"+key+"']").parent().find('label').before('<p class="errorText">'+vObject.reply+'</p>');}}}},loadCountries:function(){var _self=this;$.ajax({cache:false,type:"get",url:PROTOCOL+WEBROOT+"/UIServices/ContentService.svc/GetCountries",success:function(data){_self.onLoadCountries(data,_self)}});},onLoadCountries:function(response){if(response.isValid){for(var i in response.entityData){var option=$('<option></option>');option.attr('value',response.entityData[i].Value).text(response.entityData[i].Key);if(response.entityData[i].Value=='GB'){option.attr('selected','true');}
$("#txtCountryName").append(option);}}
$("#txtCountryName").append(option);},enterComp:function(){var _self=this;this._comp_entry.CompetitionId=$('#competitionID').val();this._comp_entry.EmailAddress=$('#email').val();this._comp_entry.Title=$('#title').val();this._comp_entry.FirstName=$('#firstname').val();this._comp_entry.Surname=$('#surname').val();this._comp_entry.CompanyName='';this._comp_entry.AddressLine1=$('#txtInsightAddressLine1').val();this._comp_entry.AddressLine2=$('#txtInsightAddressLine2').val();this._comp_entry.City=$('#txtInsightCity').val();this._comp_entry.RegionName=$('#txtInsightCounty').val();this._comp_entry.Postcode=$('#postcode').val();this._comp_entry.CountryCode=$('#txtCountryName').val();this._comp_entry.OptInMarketing=$('#opt_in:checked').length==0;this._comp_entry.OptOutThirdParty=$('#third_party_opt_out:checked').length==0;$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/ContentService.svc/SaveCompetitionEntry",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({"competitionEntry":this._comp_entry}),success:function(data){_self.onSaveEntry(data,$('body'))}});},onSaveEntry:function(response){if(response.SaveCompetitionEntryResult.isValid){$('#openCompForm').hide();$('#thanks_div').show();}
window.scrollTo(0,0);},findAddress:function(evt){evt.preventDefault();var countryCode=$("[ID$='txtCountryName']").val();var houseNumber=$("[ID$='housenum']").val();var postCode=$("[ID$='postcode']").val().toLowerCase();var _self=this
$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/FindAddress",data:JSON.stringify({"countryCode":countryCode,"houseNumber":houseNumber,"postCode":postCode}),success:function(data){$.proxy(_self.onFindAddress(data),_self)}});},onFindAddress:function(response){var _self=this;if(response.d.isValid&&response.d.entityData!=null){$('.small_loader').remove();if(response.d.entityData.addressCount==1){this.onSelectAddress(response);}else{$("[ID$='ddAddressList']").append($('<option>Please select..</option>'));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='searchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$('#divFindAddress').slideDown("slow");}}else{$('.txtPostcode').before('<li class="error_c"><p class="error">'+response.d.errorMessage+'</p></li>').addClass('error');$('.small_loader').remove();}},onSelectAddress:function(response){if(response.d.isValid&&null!=response.d.entityData){$('.small_loader').remove();if(response.d.entityData.addressCount==1){$.each(response.d.entityData.addressMaster,function(key,value){if($("[ID$='txt"+key+"']")&&value!=null){$("[ID$='txtInsight"+key+"']").val(value);}});$("[ID$='Short'], #Options1, #Options3, [ID$='divFindAddress']").hide();}
else{$("[ID$='ddAddressList']").append($('<option>Please select..</option>'));$.each(response.d.entityData.items,function(key,item){$("[ID$='ddAddressList']").append($('<option></option>').html(item));});$("[ID$='searchStatus']").val(response.d.entityData.addressMaster.AddressLine1);$("[ID$='divFindAddress']").slideDown("slow");}}
else{$('#ErrorAddBill').append('<p class="error">'+response.d.errorMessage+'</p>').show();$('.small_loader').remove();}
if(response.d.isValid&&null!=response.d.entityData){}
else{$('#ErrorAddBill').html(response.d.errorMessage).show();}
return false;},showHideFindAddress:function(evt){var $this=$(evt.target);if($this.val()=='GB'){$("#btnFindAddress").show();$("#divHouseNum").show();}
else{$("#btnFindAddress").hide();$("#divHouseNum").hide();}},ddAddressListSelect:function(evt){if($("[ID$='ddAddressList']").is(":visible")){this.selectAddress();}},selectAddress:function(){var _self=this;var countryCode=$("[ID$='txtCountryName']").val();var searchStatus=$("[ID$='searchStatus']").val();var ambiguityId=$('#divFindAddress select')[0].selectedIndex-1;$("[ID$='ddAddressList']").children().remove();$("[ID$='divFindAddress']").slideUp("slow");$.ajax({type:"POST",url:PROTOCOL+WEBROOT+"/UIServices/Account/AddressService.svc/SelectAddress",data:JSON.stringify({"countryCode":countryCode,"searchStatus":searchStatus,"ambiguityId":ambiguityId}),success:function(data){$.proxy(_self.onSelectAddress(data),_self)}});}}));Hrd.define('Harrods.Boutiques',Hrd.extend({init:function(config){var _this=this;this.imgs=[];Hrd.apply(this._config,config);this.scrollToHash();if($('.wedding_boutique').length>0){$('.wedding_boutique .hero-content .slides').swipe({steps:1,auto:5000,continuous:true});}
if($('.main-carousel').length>0){$('.main-carousel img').each(function(){if($(this).attr("src")!=""){_this.imgs.push($(this));}});Hrd.preloader.queue(this.imgs);Hrd.preloader.preload(function(){$('.main-carousel .slides').each(function(){_this.enableCarousel($(this));});});}
if($('.new-form').length>0){$('.new-form').on('focusout','input',$.proxy(this.validateFormField,this));$('.new-form').on('focusout','select',$.proxy(this.validateFormField,this));$('.new-form').on('keyup','.message textarea',$.proxy(this.countChars,this));}
if($('.glass-cont').length>0){$('.glass-top').on({click:$.proxy(this.glassTopClick,this)});}
if($('.wine-region').length>0){$(".map-pointer").on({click:$.proxy(this.regionPopup,this)});$('.europe-hover').hover(function(){$('.europe').stop('true','true').animate({opacity:'1'});},function(){$('.europe').stop('true','true').animate({opacity:'0'});});$(".tooltip-action").hover(function(){var tooltop=($(this).offset().top-$(this).parent().offset().top),toolleft=$(this).offset().left-$(this).parent().offset().left+25,tooltip=$(this).data("tooltip");if($(this).parent('.europe-popup').length>0){tooltop+=18;toolleft+=160;}
if($(this).hasClass('europe-hover')){tooltop+=5;toolleft+=60;}
$('.tooltip').html(tooltip);$(".tooltip").stop('true','true').css({top:tooltop,left:toolleft}).fadeIn(200);},function(){$(".tooltip").stop('true','true').fadeOut(200);})
$(".europe-hover").on({click:$.proxy(this.europeShow,this)});$(".europe-hider, .europe-popup .close").on({click:$.proxy(this.europeHide,this)});}
if($('.food-pairing').length>0){if(navigator.userAgent.match(/iPad/i)){$('.pair-block').on({click:$.proxy(this.hoverTrigger,this)});}}
if($('.furniture-enquiries').length>0&&$('html.touch').length>0){$('body').on('click','.store-opening',$.proxy(this.showOpeningHours,this));$('body').on('click','.store-opening-close',$.proxy(this.hideOpeningHours,this));}
$('body').on('click','.lightbox-link',$.proxy(this.showLightbox,this));$("#lightbox-new .close").on("click",$.proxy(this.hideLightbox,this));$("#lightbox-overlay").on("click",$.proxy(this.hideLightbox,this));},showLightbox:function(e){var target=$(e.target);var i=target.attr('href');$('#main .boutiques').append('<div id="lightbox-overlay"></div><div id="lightbox-new"><a href="#" class="close">x</a></div>');$($(i)).appendTo('#lightbox-new');$('#lightbox-overlay').fadeIn(800);$('#lightbox-new').fadeIn(800);$("#lightbox-new .close").on("click",$.proxy(this.hideLightbox,this));$("#lightbox-overlay").on("click",$.proxy(this.hideLightbox,this));if(target.hasClass('scrollToTop')){var offset=134;if($('.use-promo').length){offset=167;}
$('html, body').animate({scrollTop:-offset},800);}},hideLightbox:function(e){$('#lightbox-overlay').fadeOut(800,function(){$(this).remove();});$('#lightbox-new').fadeOut(800,function(){$(this).find('.lightbox-content').appendTo('#main .boutiques');$(this).remove();});e.preventDefault();},validateFormField:function(evt){var target=evt.target,field=$(target).parents('.field'),errmsg=field.find('.error-message'),hasErrors=false;errmsg.each(function(){if($(this).css('display')=='block'||$(this).css('display')=='inline'){field.addClass('error');hasErrors=true;}});if(!hasErrors){field.removeClass('error');}},scrollToHash:function(){var h=window.location.hash;h=h.replace('-scroll','');var offset=134;if($('.use-promo').length){offset=167;}
if($(h).length>0){$('html, body').animate({scrollTop:($(h).offset().top)-offset},800);}},countChars:function(evt){var target=evt.target,msgLength=$(target).val().length,charsRemaining=$(target).parents('.field').find('.chars-remaining'),maxChars=charsRemaining.attr('data-maxchars'),charLeft=maxChars-msgLength;if(charLeft<6){charsRemaining.addClass('low');}else{charsRemaining.removeClass('low');}
if(charLeft>-1){charsRemaining.html(charLeft);}else{$(target).val($(target).val().slice(0,maxChars));}},europeShow:function(evt){$('.tooltip').hide();$('.europe-popup').fadeIn();$('.europe-hider').fadeIn();},europeHide:function(evt){$('.europe-popup').fadeOut();$('.europe-hider').fadeOut();},toolTipOn:function(evt){var $this=$(evt.target),tooltip=$this.data('tooltip');$this.prepend("<p>"+tooltip+"</p>");},hoverTrigger:function(evt){var $this=$(evt.target);$this.toggleClass('hovered');},glassTopClick:function(evt){var $this=$(evt.target),$url;if($this.hasClass('glass-top')){$url=$this.find('.product_name').attr('href')}else{$url=$this.parent().find('.product_name').attr('href')}
window.location=$url},regionPopup:function(evt){var $this=$(evt.target);evt.preventDefault();if(!$this.hasClass('inactive')){var contentId=$this.attr('id')+"Content",w_w=$(window).outerWidth(),w_h=$(window).outerHeight(),img_modal='<div class="img_modal" style="width:'+w_w+'px;height:'+w_h+'px"><div class="img_modal_bg" style="width:'
+w_w+'px;height:'+w_h+'px"></div><div class="wine-popup"><div class="close"><img src="/public/img/close.png" /></div>'
+'</div></div>';$('.img_modal').remove();$('body').append(img_modal);$('.wine-popup').append($('#'+contentId).clone());marginTop=Math.round((w_w-$('.wine-popup').height())/5+$('body').scrollTop())+'px';$('.wine-popup').css('marginTop',marginTop);$('.img_modal').fadeIn();}},enableCarousel:function($trg){var speed=(typeof $trg.data('speed')!=='undefined')?$trg.data('speed'):300;var auto=(typeof $trg.data('auto')!=='undefined')?$trg.data('auto'):0;var continuous=($trg.data('continuous')==='True')?true:false;var steps=(typeof $trg.data('steps')!=='undefined')?$trg.data('steps'):1;var pagination=($trg.data('pagination')==='True')?true:false;var paginationclass=(typeof $trg.data('paginationclass')!=='undefined')?$trg.data('paginationclass'):'default';var stoponhover=($trg.data('stoponhover')==='True')?true:false;$trg.swipe({auto:auto,continuous:continuous,speed:speed,steps:steps,hasPagination:pagination,paginationClass:paginationclass,stoponHover:stoponhover});},showOpeningHours:function(){$('.store-opening-popup').show();},hideOpeningHours:function(e){e.stopPropagation();$('.store-opening-popup').hide();}}));Hrd.define('Harrods.Search',Hrd.extend({init:function(){this.replaceTopNav();},replaceTopNav:function(){if(typeof sli_custid!="undefined"){var uId=sli_custid;$.ajax({type:"GET",cache:false,url:"/UIServices/ExternalService.svc/GetUserNav",data:{id:uId},contentType:"application/json; charset=utf-8",dataType:"json",success:$.proxy(this.onGetTopNav,this)});}},onGetTopNav:function(response){$('#top-nav-content').empty();$('#top-nav-content').append(response.entityData);}}));Hrd.define('Harrods.FashionWeek',Hrd.extend({init:function(config){Hrd.apply(this._config,config);if($('.fashion_week').length>0){$('.aw13-fade').hover(function(){$(this).find('img').animate({opacity:0});},function(){$(this).find('img').animate({opacity:1});});if($('.fashion_week').data('cmspage').indexOf('catwalk_reviews')!=-1){$('dt.tab5 span').trigger('click');}
if($('.fashion_week').data('cmspage').indexOf('womens_street_style')!=-1){$('dt.tab1 span').trigger('click');}
if($('.fashion_week').data('cmspage').indexOf('beauty_backstage')!=-1){$('dt.tab2 span').trigger('click');}
var currlocation=$('.fashion_week').data('location');$('.location').each(function(){var $this=$(this),location=$this.data('location').replace(/ /g,"_").toLowerCase();if(currlocation==location){$this.addClass('active');}});}}}));